{"version":3,"file":"langbot.http.js","sources":["utils/langbot.http.js"],"sourcesContent":["const DEFAULT_HTTP_OPTIONS = {\n  baseURL: '',\n  timeout: 10000,\n  getAuthToken: () => '',\n};\n\nlet httpOptions = { ...DEFAULT_HTTP_OPTIONS };\n\nexport function configureHttp(options = {}) {\n  httpOptions = { ...httpOptions, ...options };\n}\n\nexport function postJson(path, data = {}, extraHeaders = {}) {\n  return request('POST', path, data, extraHeaders);\n}\n\nexport function getJson(path, params = {}, extraHeaders = {}) {\n  return request('GET', path, params, extraHeaders);\n}\n\nfunction request(method, path, payload, extraHeaders = {}) {\n  const url = resolveURL(path);\n  const headers = buildHeaders(extraHeaders);\n\n  return new Promise((resolve, reject) => {\n    uni.request({\n      url,\n      method,\n      timeout: httpOptions.timeout,\n      data: payload,\n      header: headers,\n      success(res) {\n        if (res.statusCode >= 200 && res.statusCode < 300) {\n          resolve(res.data);\n        } else {\n          reject(\n            new Error(\n              `[langbot.http] Request failed: ${res.statusCode} ${JSON.stringify(res.data)}`\n            )\n          );\n        }\n      },\n      fail(err) {\n        reject(err);\n      },\n    });\n  });\n}\n\nfunction resolveURL(path) {\n  if (/^https?:\\/\\//.test(path)) {\n    return path;\n  }\n  const base = httpOptions.baseURL || '';\n  return `${base.replace(/\\/$/, '')}/${path.replace(/^\\//, '')}`;\n}\n\nfunction buildHeaders(extraHeaders = {}) {\n  const headers = {\n    'Content-Type': 'application/json',\n    ...extraHeaders,\n  };\n\n  const token =\n    typeof httpOptions.getAuthToken === 'function'\n      ? httpOptions.getAuthToken()\n      : httpOptions.getAuthToken;\n\n  if (token) {\n    headers.Authorization = `Bearer ${token}`;\n  }\n\n  return headers;\n}\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA,MAAM,uBAAuB;AAAA,EAC3B,SAAS;AAAA,EACT,SAAS;AAAA,EACT,cAAc,MAAM;AACtB;AAEA,IAAI,cAAc,mBAAK;AAEhB,SAAS,cAAc,UAAU,IAAI;AAC1C,gBAAc,kCAAK,cAAgB;AACrC;;"}