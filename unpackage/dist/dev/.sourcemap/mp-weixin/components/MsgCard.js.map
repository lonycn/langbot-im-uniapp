{"version":3,"file":"MsgCard.js","sources":["components/MsgCard.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/components/MsgCard.vue?type=component"],"sourcesContent":["<template>\n\t<view :class=\"['card-wrapper', from === 'me' ? 'from-me' : 'from-bot']\">\n\t\t<view class=\"card\">\n\t\t\t<view v-if=\"card?.title || card?.subtitle\" class=\"card-header\">\n\t\t\t\t<text v-if=\"card?.icon\" class=\"card-icon\">{{ card.icon }}</text>\n\t\t\t\t<view class=\"card-header-text\">\n\t\t\t\t\t<text v-if=\"card?.title\" class=\"card-title\">{{ card.title }}</text>\n\t\t\t\t\t<text v-if=\"card?.subtitle\" class=\"card-subtitle\">{{ card.subtitle }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<text v-if=\"card?.description\" class=\"card-description\">{{ card.description }}</text>\n\n\t\t\t<view v-if=\"hasFields\" class=\"card-section\">\n\t\t\t\t<view v-for=\"(value, key) in card.fields\" :key=\"key\" class=\"card-field\">\n\t\t\t\t\t<text class=\"field-key\">{{ key }}</text>\n\t\t\t\t\t<text class=\"field-value\">{{ value }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<template v-if=\"Array.isArray(card?.sections)\">\n\t\t\t\t<view v-for=\"(section, idx) in card.sections\" :key=\"`section-${idx}`\" class=\"card-section\">\n\t\t\t\t\t<view v-if=\"section?.title\" class=\"section-title\">{{ section.title }}</view>\n\t\t\t\t\t<template v-if=\"section?.layout === 'key-value'\">\n\t\t\t\t\t\t<view\n\t\t\t\t\t\t\tv-for=\"(item, itemIdx) in section.items || []\"\n\t\t\t\t\t\t\t:key=\"`kv-${idx}-${itemIdx}`\"\n\t\t\t\t\t\t\tclass=\"card-field\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<text class=\"field-key\">{{ item.label || item.key }}</text>\n\t\t\t\t\t\t\t<text class=\"field-value\">{{ item.value }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"section?.layout === 'list'\">\n\t\t\t\t\t\t<view\n\t\t\t\t\t\t\tv-for=\"(item, itemIdx) in section.items || []\"\n\t\t\t\t\t\t\t:key=\"`list-${idx}-${itemIdx}`\"\n\t\t\t\t\t\t\tclass=\"list-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<view class=\"list-item-header\">\n\t\t\t\t\t\t\t\t<text class=\"list-item-title\">{{ item.title }}</text>\n\t\t\t\t\t\t\t\t<text\n\t\t\t\t\t\t\t\t\tv-if=\"item.status\"\n\t\t\t\t\t\t\t\t\tclass=\"list-item-status\"\n\t\t\t\t\t\t\t\t\t:class=\"`status-${item.status}`\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{ renderStatusLabel(item.status) }}\n\t\t\t\t\t\t\t\t</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<text v-if=\"item.description\" class=\"list-item-desc\">{{ item.description }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<text class=\"section-placeholder\">暂不支持的布局：{{ section?.layout || 'unknown' }}</text>\n\t\t\t\t\t</template>\n\t\t\t\t</view>\n\t\t\t</template>\n\n\t\t\t<template v-if=\"cardType === 'timeline' && Array.isArray(card?.timeline)\">\n\t\t\t\t<view class=\"timeline\">\n\t\t\t\t\t<view v-for=\"(node, idx) in card.timeline\" :key=\"`timeline-${idx}`\" class=\"timeline-item\">\n\t\t\t\t\t\t<view class=\"timeline-dot\" :class=\"`status-${node.status || 'pending'}`\"></view>\n\t\t\t\t\t\t<view class=\"timeline-content\">\n\t\t\t\t\t\t\t<view class=\"timeline-header\">\n\t\t\t\t\t\t\t\t<text class=\"timeline-time\">{{ node.time }}</text>\n\t\t\t\t\t\t\t\t<text class=\"timeline-title\">{{ node.title }}</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<text v-if=\"node.description\" class=\"timeline-desc\">{{ node.description }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</template>\n\n\t\t\t<template v-if=\"cardType === 'form' && card?.form\">\n\t\t\t\t<view class=\"form-preview\">\n\t\t\t\t\t<view\n\t\t\t\t\t\tv-for=\"field in card.form.fields || []\"\n\t\t\t\t\t\t:key=\"field.field || field.label\"\n\t\t\t\t\t\tclass=\"form-field\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<text class=\"field-label\">{{ field.label || field.field }}</text>\n\t\t\t\t\t\t<text class=\"field-placeholder\">{{ renderFieldPlaceholder(field) }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</template>\n\n\t\t\t<template v-if=\"cardType === 'media' && cardMedia\">\n\t\t\t\t<MsgAudio\n\t\t\t\t\tv-if=\"cardMedia.type === 'audio'\"\n\t\t\t\t\t:audio=\"cardMedia\"\n\t\t\t\t\t:from=\"from\"\n\t\t\t\t\t@play=\"forwardMediaEvent('play', $event)\"\n\t\t\t\t\t@pause=\"forwardMediaEvent('pause', $event)\"\n\t\t\t\t\t@ended=\"forwardMediaEvent('ended', $event)\"\n\t\t\t\t/>\n\t\t\t\t<MsgVideo v-else-if=\"cardMedia.type === 'video'\" :video=\"cardMedia\" :from=\"from\" />\n\t\t\t\t<MsgFile\n\t\t\t\t\tv-else-if=\"cardMedia.type === 'file'\"\n\t\t\t\t\t:file=\"cardMedia\"\n\t\t\t\t\t:from=\"from\"\n\t\t\t\t\t@open=\"forwardMediaEvent('open', $event)\"\n\t\t\t\t/>\n\t\t\t\t<text v-else class=\"section-placeholder\">暂不支持的媒体类型：{{ cardMedia.type }}</text>\n\t\t\t</template>\n\n\t\t\t<view v-if=\"Array.isArray(card?.actions) && card.actions.length\" class=\"card-actions\">\n\t\t\t\t<button\n\t\t\t\t\tv-for=\"(action, idx) in card.actions\"\n\t\t\t\t\t:key=\"`action-${idx}`\"\n\t\t\t\t\tclass=\"card-action\"\n\t\t\t\t\tsize=\"mini\"\n\t\t\t\t\ttype=\"default\"\n\t\t\t\t\t@click=\"handleAction(action)\"\n\t\t\t\t>\n\t\t\t\t\t{{ action.text || renderActionLabel(action) }}\n\t\t\t\t</button>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { computed } from 'vue'\nimport MsgAudio from './MsgAudio.vue'\nimport MsgVideo from './MsgVideo.vue'\nimport MsgFile from './MsgFile.vue'\n\nconst props = defineProps({\n\tcard: {\n\t\ttype: Object,\n\t\tdefault: () => ({})\n\t},\n\tfrom: {\n\t\ttype: String,\n\t\tdefault: 'bot'\n\t}\n})\n\nconst emit = defineEmits(['action', 'media'])\n\nconst cardType = computed(() => props.card?.card_type || 'general')\n\nconst hasFields = computed(() => {\n\tconst fields = props.card?.fields\n\treturn fields && Object.keys(fields).length > 0\n})\n\nconst cardMedia = computed(() => props.card?.media || null)\n\nfunction handleAction(action) {\n\tif (!action) return\n\n\tif (action.confirm) {\n\t\tuni.showModal({\n\t\t\ttitle: '确认操作',\n\t\t\tcontent: action.confirm,\n\t\t\tsuccess: ({ confirm }) => {\n\t\t\t\tif (confirm) executeAction(action)\n\t\t\t}\n\t\t})\n\t\treturn\n\t}\n\n\texecuteAction(action)\n}\n\nfunction executeAction(action) {\n\tif (action.type === 'link' && action.url) {\n\t\t/* #ifdef H5 */\n\t\twindow.open(action.url, '_blank')\n\t\t/* #endif */\n\t\t/* #ifndef H5 */\n\t\ttry {\n\t\t\tconst target = `/uni_modules/uni-im/pages/common/webview/webview?url=${encodeURIComponent(action.url)}`\n\t\t\tuni.navigateTo({ url: target })\n\t\t} catch (error) {\n\t\t\tconsole.warn('[MsgCard] open link failed', error)\n\t\t}\n\t\t/* #endif */\n\t}\n\temit('action', action)\n}\n\nfunction forwardMediaEvent(type, payload) {\n\temit('media', { type, payload })\n}\n\nfunction renderStatusLabel(status) {\n\tswitch (status) {\n\t\tcase 'done':\n\t\t\treturn '已完成'\n\t\tcase 'processing':\n\t\t\treturn '进行中'\n\t\tcase 'warning':\n\t\t\treturn '需关注'\n\t\tdefault:\n\t\t\treturn '待处理'\n\t}\n}\n\nfunction renderFieldPlaceholder(field) {\n\tif (!field) return ''\n\tif (field.placeholder) return field.placeholder\n\tswitch (field.type) {\n\t\tcase 'select':\n\t\t\treturn '请选择'\n\t\tcase 'textarea':\n\t\t\treturn '请输入内容'\n\t\tcase 'image':\n\t\t\treturn `可上传 ${field.max_count || 3} 张图片`\n\t\tdefault:\n\t\t\treturn '填写内容'\n\t}\n}\n\nfunction renderActionLabel(action) {\n\tswitch (action?.type) {\n\t\tcase 'link':\n\t\t\treturn '查看链接'\n\t\tcase 'postback':\n\t\t\treturn '触发事件'\n\t\tcase 'submit_form':\n\t\t\treturn '提交'\n\t\tcase 'open_widget':\n\t\t\treturn '打开'\n\t\tcase 'interrupt':\n\t\t\treturn '打断'\n\t\tdefault:\n\t\t\treturn '操作'\n\t}\n}\n</script>\n\n<style scoped>\n.card-wrapper {\n\tmargin: 8px 0;\n\tdisplay: flex;\n}\n\n.card-wrapper.from-me {\n\tjustify-content: flex-end;\n}\n\n.card-wrapper.from-bot {\n\tjustify-content: flex-start;\n}\n\n.card {\n\tmax-width: 85%;\n\tpadding: 18rpx 22rpx;\n\tborder-radius: 18rpx;\n\tbackground-color: #ffffff;\n\tbox-shadow: 0 6rpx 16rpx rgba(0, 0, 0, 0.1);\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 16rpx;\n}\n\n.from-me .card {\n\tbackground-color: #4b7bec;\n\tcolor: #ffffff;\n}\n\n.card-header {\n\tdisplay: flex;\n\tgap: 12rpx;\n\talign-items: center;\n}\n\n.card-icon {\n\tfont-size: 36rpx;\n}\n\n.card-header-text {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.card-title {\n\tfont-size: 32rpx;\n\tfont-weight: 600;\n}\n\n.card-subtitle {\n\tfont-size: 26rpx;\n\topacity: 0.85;\n}\n\n.card-description {\n\tfont-size: 26rpx;\n\tline-height: 1.5;\n\topacity: 0.9;\n}\n\n.card-section {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12rpx;\n}\n\n.section-title {\n\tfont-size: 26rpx;\n\tfont-weight: 600;\n}\n\n.card-field {\n\tdisplay: flex;\n\tgap: 8rpx;\n\tfont-size: 26rpx;\n\tline-height: 1.4;\n}\n\n.field-key {\n\tfont-weight: 600;\n}\n\n.field-value {\n\tflex: 1;\n\topacity: 0.9;\n}\n\n.list-item {\n\tbackground-color: rgba(0, 0, 0, 0.05);\n\tborder-radius: 12rpx;\n\tpadding: 12rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 6rpx;\n}\n\n.from-me .list-item {\n\tbackground-color: rgba(255, 255, 255, 0.15);\n}\n\n.list-item-header {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n}\n\n.list-item-title {\n\tfont-size: 28rpx;\n\tfont-weight: 600;\n}\n\n.list-item-status {\n\tfont-size: 24rpx;\n\tpadding: 4rpx 12rpx;\n\tborder-radius: 999px;\n\tbackground-color: rgba(46, 213, 115, 0.15);\n\tcolor: #2ed573;\n}\n\n.status-warning {\n\tbackground-color: rgba(255, 159, 67, 0.18);\n\tcolor: #ff9f43;\n}\n\n.status-processing {\n\tbackground-color: rgba(74, 144, 226, 0.18);\n\tcolor: #4a90e2;\n}\n\n.status-pending {\n\tbackground-color: rgba(207, 216, 220, 0.18);\n\tcolor: #607d8b;\n}\n\n.timeline {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 16rpx;\n}\n\n.timeline-item {\n\tdisplay: flex;\n\tgap: 16rpx;\n}\n\n.timeline-dot {\n\twidth: 16rpx;\n\theight: 16rpx;\n\tborder-radius: 50%;\n\tmargin-top: 6rpx;\n\tbackground-color: #dfe4ea;\n}\n\n.timeline-content {\n\tflex: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 4rpx;\n}\n\n.timeline-header {\n\tdisplay: flex;\n\tgap: 12rpx;\n\talign-items: baseline;\n}\n\n.timeline-time {\n\tfont-size: 24rpx;\n\topacity: 0.7;\n}\n\n.timeline-title {\n\tfont-size: 28rpx;\n\tfont-weight: 600;\n}\n\n.timeline-desc {\n\tfont-size: 24rpx;\n\topacity: 0.85;\n}\n\n.form-preview {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12rpx;\n}\n\n.form-field {\n\tbackground-color: rgba(0, 0, 0, 0.05);\n\tborder-radius: 12rpx;\n\tpadding: 12rpx 16rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 6rpx;\n}\n\n.from-me .form-field {\n\tbackground-color: rgba(255, 255, 255, 0.15);\n}\n\n.field-label {\n\tfont-size: 26rpx;\n\tfont-weight: 600;\n}\n\n.field-placeholder {\n\tfont-size: 24rpx;\n\topacity: 0.7;\n}\n\n.card-actions {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tgap: 12rpx;\n}\n\n.card-action {\n\tborder-radius: 999px;\n\tpadding: 0 28rpx;\n\tbackground-color: rgba(0, 0, 0, 0.06);\n\tcolor: inherit;\n}\n\n.from-me .card-action {\n\tbackground-color: rgba(255, 255, 255, 0.2);\n\tcolor: #ffffff;\n}\n\n.section-placeholder {\n\tfont-size: 24rpx;\n\topacity: 0.7;\n}\n</style>\n","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/components/MsgCard.vue'\nwx.createComponent(Component)"],"names":["computed","uni"],"mappings":";;;;;AA0HA,MAAM,WAAW,MAAW;AAC5B,MAAM,WAAW,MAAW;AAC5B,MAAM,UAAU,MAAW;;;;;;;;;;;;;;;AAE3B,UAAM,QAAQ;AAWd,UAAM,OAAO;AAEb,UAAM,WAAWA,cAAQ,SAAC,MAAM;;AAAA,0BAAM,SAAN,mBAAY,cAAa;AAAA,KAAS;AAElE,UAAM,YAAYA,cAAQ,SAAC,MAAM;;AAChC,YAAM,UAAS,WAAM,SAAN,mBAAY;AAC3B,aAAO,UAAU,OAAO,KAAK,MAAM,EAAE,SAAS;AAAA,IAC/C,CAAC;AAED,UAAM,YAAYA,cAAQ,SAAC,MAAM;;AAAA,0BAAM,SAAN,mBAAY,UAAS;AAAA,KAAI;AAE1D,aAAS,aAAa,QAAQ;AAC7B,UAAI,CAAC;AAAQ;AAEb,UAAI,OAAO,SAAS;AACnBC,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,SAAS,OAAO;AAAA,UAChB,SAAS,CAAC,EAAE,cAAc;AACzB,gBAAI;AAAS,4BAAc,MAAM;AAAA,UACjC;AAAA,QACJ,CAAG;AACD;AAAA,MACA;AAED,oBAAc,MAAM;AAAA,IACrB;AAEA,aAAS,cAAc,QAAQ;AAC9B,UAAI,OAAO,SAAS,UAAU,OAAO,KAAK;AAKzC,YAAI;AACH,gBAAM,SAAS,wDAAwD,mBAAmB,OAAO,GAAG,CAAC;AACrGA,wBAAAA,MAAI,WAAW,EAAE,KAAK,OAAM,CAAE;AAAA,QAC9B,SAAQ,OAAO;AACfA,wBAAAA,MAAA,MAAA,QAAA,iCAAa,8BAA8B,KAAK;AAAA,QAChD;AAAA,MAED;AACD,WAAK,UAAU,MAAM;AAAA,IACtB;AAEA,aAAS,kBAAkB,MAAM,SAAS;AACzC,WAAK,SAAS,EAAE,MAAM,QAAO,CAAE;AAAA,IAChC;AAEA,aAAS,kBAAkB,QAAQ;AAClC,cAAQ,QAAM;AAAA,QACb,KAAK;AACJ,iBAAO;AAAA,QACR,KAAK;AACJ,iBAAO;AAAA,QACR,KAAK;AACJ,iBAAO;AAAA,QACR;AACC,iBAAO;AAAA,MACR;AAAA,IACF;AAEA,aAAS,uBAAuB,OAAO;AACtC,UAAI,CAAC;AAAO,eAAO;AACnB,UAAI,MAAM;AAAa,eAAO,MAAM;AACpC,cAAQ,MAAM,MAAI;AAAA,QACjB,KAAK;AACJ,iBAAO;AAAA,QACR,KAAK;AACJ,iBAAO;AAAA,QACR,KAAK;AACJ,iBAAO,OAAO,MAAM,aAAa,CAAC;AAAA,QACnC;AACC,iBAAO;AAAA,MACR;AAAA,IACF;AAEA,aAAS,kBAAkB,QAAQ;AAClC,cAAQ,iCAAQ,MAAI;AAAA,QACnB,KAAK;AACJ,iBAAO;AAAA,QACR,KAAK;AACJ,iBAAO;AAAA,QACR,KAAK;AACJ,iBAAO;AAAA,QACR,KAAK;AACJ,iBAAO;AAAA,QACR,KAAK;AACJ,iBAAO;AAAA,QACR;AACC,iBAAO;AAAA,MACR;AAAA,IACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpOA,GAAG,gBAAgB,SAAS;"}