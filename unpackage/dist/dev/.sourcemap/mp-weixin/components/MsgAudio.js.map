{"version":3,"file":"MsgAudio.js","sources":["components/MsgAudio.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/components/MsgAudio.vue?type=component"],"sourcesContent":["<template>\n\t<view :class=\"['media-bubble', from === 'me' ? 'from-me' : 'from-bot']\">\n\t\t<view class=\"audio-body\">\n\t\t\t<view class=\"audio-info\">\n\t\t\t\t<text class=\"audio-title\">{{ audioTitle }}</text>\n\t\t\t\t<text v-if=\"durationLabel\" class=\"audio-duration\">{{ durationLabel }}</text>\n\t\t\t</view>\n\t\t\t<view class=\"audio-player\">\n\t\t\t\t<!-- #ifdef H5 -->\n\t\t\t\t<audio\n\t\t\t\t\tref=\"audioEl\"\n\t\t\t\t\tclass=\"native-audio\"\n\t\t\t\t\t:src=\"source\"\n\t\t\t\t\t:controls=\"true\"\n\t\t\t\t\t:preload=\"'metadata'\"\n\t\t\t\t\t@ended=\"handleEnded\"\n\t\t\t\t></audio>\n\t\t\t\t<!-- #endif -->\n\t\t\t\t<!-- #ifndef H5 -->\n\t\t\t\t<button size=\"mini\" type=\"default\" @click=\"togglePlay\">{{ playing ? '暂停' : '播放  ' }}</button>\n\t\t\t\t<!-- #endif -->\n\t\t\t</view>\n\t\t\t<text v-if=\"audio?.transcript\" class=\"audio-transcript\">{{ audio.transcript }}</text>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { computed, onMounted, onBeforeUnmount, ref } from 'vue'\n\nconst props = defineProps({\n\taudio: {\n\t\ttype: Object,\n\t\tdefault: () => ({})\n\t},\n\tfrom: {\n\t\ttype: String,\n\t\tdefault: 'bot'\n\t}\n})\n\nconst emit = defineEmits(['play', 'pause', 'ended'])\n\nconst audioEl = ref(null)\nconst innerAudio = ref(null)\nconst playing = ref(false)\n\nconst source = computed(() => props.audio?.url || '')\n\nconst durationLabel = computed(() => {\n\tconst duration = props.audio?.duration\n\tif (!duration && duration !== 0) return ''\n\tconst seconds = Math.round(duration)\n\tconst mm = Math.floor(seconds / 60)\n\tconst ss = seconds % 60\n\treturn `${mm}:${ss.toString().padStart(2, '0')}`\n})\n\nconst audioTitle = computed(() => props.audio?.title || '语音消息')\n\nfunction handleEnded() {\n\tplaying.value = false\n\temit('ended', props.audio)\n}\n\nfunction stopPlayback() {\n\tplaying.value = false\n\t/* #ifdef H5 */\n\tif (audioEl.value) {\n\t\taudioEl.value.pause()\n\t\taudioEl.value.currentTime = 0\n\t}\n\t/* #endif */\n\t/* #ifndef H5 */\n\tif (innerAudio.value) {\n\t\tinnerAudio.value.stop()\n\t}\n\t/* #endif */\n}\n\nfunction togglePlay() {\n\tif (!source.value) return\n\n\tif (playing.value) {\n\t\tstopPlayback()\n\t\temit('pause', props.audio)\n\t\treturn\n\t}\n\n\tplaying.value = true\n\temit('play', props.audio)\n\n\t/* #ifdef H5 */\n\tif (audioEl.value) {\n\t\taudioEl.value.currentTime = 0\n\t\taudioEl.value.play().catch((err) => {\n\t\t\tconsole.warn('[MsgAudio] play failed', err)\n\t\t\tplaying.value = false\n\t\t})\n\t}\n\t/* #endif */\n\t/* #ifndef H5 */\n\tif (!innerAudio.value) {\n\t\tconst ctx = uni.createInnerAudioContext()\n\t\tctx.autoplay = false\n\t\tctx.obeyMuteSwitch = false\n\t\tctx.src = source.value\n\t\tctx.onEnded(() => {\n\t\t\tplaying.value = false\n\t\t\temit('ended', props.audio)\n\t\t})\n\t\tctx.onError((err) => {\n\t\t\tconsole.warn('[MsgAudio] play failed', err)\n\t\t\tplaying.value = false\n\t\t})\n\t\tinnerAudio.value = ctx\n\t} else {\n\t\tinnerAudio.value.stop()\n\t\tinnerAudio.value.src = source.value\n\t}\n\tinnerAudio.value.play()\n\t/* #endif */\n}\n\nonMounted(() => {\n\t/* #ifndef H5 */\n\treturn () => {}\n\t/* #endif */\n})\n\nonBeforeUnmount(() => {\n\t/* #ifndef H5 */\n\tif (innerAudio.value) {\n\t\tinnerAudio.value.stop()\n\t\tinnerAudio.value.destroy()\n\t\tinnerAudio.value = null\n\t}\n\t/* #endif */\n})\n</script>\n\n<style scoped>\n.media-bubble {\n\tmax-width: 80%;\n\tmargin: 8px 0;\n\tdisplay: flex;\n}\n\n.media-bubble.from-me {\n\tjustify-content: flex-end;\n}\n\n.media-bubble.from-bot {\n\tjustify-content: flex-start;\n}\n\n.audio-body {\n\tmin-width: 220rpx;\n\tpadding: 16rpx;\n\tborder-radius: 16rpx;\n\tbackground-color: #ffffff;\n\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.08);\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12rpx;\n}\n\n.from-me .audio-body {\n\tbackground-color: #4b7bec;\n\tcolor: #ffffff;\n}\n\n.audio-info {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n\n.audio-title {\n\tfont-weight: 600;\n\tfont-size: 28rpx;\n}\n\n.audio-duration {\n\tfont-size: 24rpx;\n\topacity: 0.8;\n}\n\n.audio-player {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.native-audio {\n\twidth: 100%;\n}\n\n.audio-transcript {\n\tfont-size: 26rpx;\n\tline-height: 1.4;\n\topacity: 0.85;\n}\n</style>\n","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/components/MsgAudio.vue'\nwx.createComponent(Component)"],"names":["ref","computed","uni","onMounted","onBeforeUnmount"],"mappings":";;;;;;;;;;;;;;;;AA8BA,UAAM,QAAQ;AAWd,UAAM,OAAO;AAEGA,kBAAG,IAAC,IAAI;AACxB,UAAM,aAAaA,cAAG,IAAC,IAAI;AAC3B,UAAM,UAAUA,cAAG,IAAC,KAAK;AAEzB,UAAM,SAASC,cAAQ,SAAC,MAAM;;AAAA,0BAAM,UAAN,mBAAa,QAAO;AAAA,KAAE;AAEpD,UAAM,gBAAgBA,cAAQ,SAAC,MAAM;;AACpC,YAAM,YAAW,WAAM,UAAN,mBAAa;AAC9B,UAAI,CAAC,YAAY,aAAa;AAAG,eAAO;AACxC,YAAM,UAAU,KAAK,MAAM,QAAQ;AACnC,YAAM,KAAK,KAAK,MAAM,UAAU,EAAE;AAClC,YAAM,KAAK,UAAU;AACrB,aAAO,GAAG,EAAE,IAAI,GAAG,SAAU,EAAC,SAAS,GAAG,GAAG,CAAC;AAAA,IAC/C,CAAC;AAED,UAAM,aAAaA,cAAQ,SAAC,MAAM;;AAAA,0BAAM,UAAN,mBAAa,UAAS;AAAA,KAAM;AAO9D,aAAS,eAAe;AACvB,cAAQ,QAAQ;AAQhB,UAAI,WAAW,OAAO;AACrB,mBAAW,MAAM,KAAM;AAAA,MACvB;AAAA,IAEF;AAEA,aAAS,aAAa;AACrB,UAAI,CAAC,OAAO;AAAO;AAEnB,UAAI,QAAQ,OAAO;AAClB,qBAAc;AACd,aAAK,SAAS,MAAM,KAAK;AACzB;AAAA,MACA;AAED,cAAQ,QAAQ;AAChB,WAAK,QAAQ,MAAM,KAAK;AAYxB,UAAI,CAAC,WAAW,OAAO;AACtB,cAAM,MAAMC,cAAG,MAAC,wBAAyB;AACzC,YAAI,WAAW;AACf,YAAI,iBAAiB;AACrB,YAAI,MAAM,OAAO;AACjB,YAAI,QAAQ,MAAM;AACjB,kBAAQ,QAAQ;AAChB,eAAK,SAAS,MAAM,KAAK;AAAA,QAC5B,CAAG;AACD,YAAI,QAAQ,CAAC,QAAQ;AACpBA,wBAAAA,MAAa,MAAA,QAAA,kCAAA,0BAA0B,GAAG;AAC1C,kBAAQ,QAAQ;AAAA,QACnB,CAAG;AACD,mBAAW,QAAQ;AAAA,MACrB,OAAQ;AACN,mBAAW,MAAM,KAAM;AACvB,mBAAW,MAAM,MAAM,OAAO;AAAA,MAC9B;AACD,iBAAW,MAAM,KAAM;AAAA,IAExB;AAEAC,kBAAAA,UAAU,MAAM;AAEf,aAAO,MAAM;AAAA,MAAE;AAAA,IAEhB,CAAC;AAEDC,kBAAAA,gBAAgB,MAAM;AAErB,UAAI,WAAW,OAAO;AACrB,mBAAW,MAAM,KAAM;AACvB,mBAAW,MAAM,QAAS;AAC1B,mBAAW,QAAQ;AAAA,MACnB;AAAA,IAEF,CAAC;;;;;;;;;;;;;;;;;;;;;ACzID,GAAG,gBAAgB,SAAS;"}