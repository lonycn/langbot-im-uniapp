{"version":3,"file":"toFriendlyTime.js","sources":["uni_modules/uni-im/sdk/utils/toFriendlyTime.js"],"sourcesContent":["// 以下代码来源openai创作后修改\r\nexport default function toFriendlyTime(timestamp, h12 = false) {\r\n  const now = new Date()\r\n  const date = new Date(timestamp)\r\n\r\n  // 在未来（允许 30 秒的误差）\r\n  if (date > now + 1000 * 30) {\r\n    return '未来'\r\n  }\r\n\r\n  const todayBegin = new Date().setHours(0, 0, 0, 0)\r\n\r\n  // 上午还是下午、中午\r\n  const ampm = h12 ? (date.getHours() >= 12 ? '下午 ' : '上午 ') : ''\r\n  const hour = h12 ? (date.getHours() % 12) : date.getHours()\r\n  const minute = date.getMinutes().toString().padStart(2, '0')\r\n\r\n  // 在今天\r\n  if (timestamp >= todayBegin) {\r\n    const secondsAgo = Math.floor((now - date) / 1000)\r\n\r\n    // 小于1分钟，显示刚刚\r\n    if (secondsAgo < 60) {\r\n      return '刚刚'\r\n    }\r\n\r\n    // 小于60分钟，显示具体几分钟前\r\n    if (secondsAgo < 60 * 60) {\r\n      const minutes = Math.floor(secondsAgo / 60)\r\n      return `${minutes}分钟前`\r\n    }\r\n\r\n    // 小于2小时，显示具体几小时+分钟前\r\n    if (secondsAgo < 60 * 60 * 2) {\r\n      const hours = Math.floor(secondsAgo / (60 * 60))\r\n      const minutes = Math.floor((secondsAgo - hours * 60 * 60) / 60)\r\n      if (minutes) {\r\n        return `${hours}小时 ${minutes}分钟前`\r\n      } else {\r\n        return `${hours}小时前`\r\n      }\r\n    }\r\n\r\n    return `${ampm}${hour}:${minute}`\r\n  }\r\n\r\n  // 在昨天\r\n  if (timestamp >= todayBegin - 1000 * 60 * 60 * 24) {\r\n    return `昨天 ${ampm}${hour}:${minute}`\r\n  }\r\n\r\n  // 在前天\r\n  if (timestamp >= todayBegin - 1000 * 60 * 60 * 48) {\r\n    return `前天 ${ampm}${hour}:${minute}`\r\n  }\r\n\r\n  const year = date.getFullYear();\r\n  const month = (date.getMonth() + 1).toString().padStart(2, '0');\r\n  const day = date.getDate().toString().padStart(2, '0');\r\n  const yearBegin = new Date().setMonth(0, 0) // 可能存在不超过一天的误差\r\n\r\n  // 在同一年\r\n  if (timestamp >= yearBegin) {\r\n    // 在同一周\r\n    const firstDayOfWeek = new Date()\r\n    firstDayOfWeek.setDate(firstDayOfWeek.getDate() - firstDayOfWeek.getDay())\r\n    const weekBegin = firstDayOfWeek.setHours(0, 0, 0, 0)\r\n    if (timestamp >= weekBegin) {\r\n      const days = ['周日', '周一', '周二', '周三', '周四', '周五', '周六']\r\n      return `${days[date.getDay()]} ${ampm}${hour}:${minute}`\r\n    }\r\n\r\n    return `${month}/${day} ${ampm}${hour}:${minute}`\r\n  }\r\n\r\n  // 不在同一年\r\n  return `${year}/${month}/${day} ${ampm}${hour}:${minute}`\r\n}\r\n\r\n// let now = Date.now()\r\n// let times = [\r\n//   now,\r\n//   now - 1000 * 59,\r\n//   now - 1000 * 60,\r\n//   now - 1000 * 60 * 29,\r\n//   now - 1000 * 60 * 59,\r\n//   now - 1000 * 60 * 60,\r\n//   now - 1000 * 60 * 60 * 3,\r\n//   now - 1000 * 60 * 60 * 12,\r\n//   now - 1000 * 60 * 60 * 23,\r\n//   now - 1000 * 60 * 60 * 24,\r\n//   now - 1000 * 60 * 60 * 30,\r\n//   now - 1000 * 60 * 60 * 47,\r\n//   now - 1000 * 60 * 60 * 48,\r\n//   now - 1000 * 60 * 60 * 24 * 3,\r\n//   now - 1000 * 60 * 60 * 24 * 4,\r\n//   now - 1000 * 60 * 60 * 24 * 5,\r\n//   now - 1000 * 60 * 60 * 24 * 6,\r\n//   now - 1000 * 60 * 60 * 24 * 7,\r\n//   now - 1000 * 60 * 60 * 24 * 8,\r\n//   now - 1000 * 60 * 60 * 24 * 12,\r\n//   now - 1000 * 60 * 60 * 24 * 36,\r\n//   now - 1000 * 60 * 60 * 24 * 48,\r\n//   now - 1000 * 60 * 60 * 24 * 100,\r\n//   now - 1000 * 60 * 60 * 24 * 400,\r\n// ]\r\n// times.forEach(ts => {\r\n//   console.log(`${new Date(ts)} - ${toFriendlyTime(ts)}`)\r\n// })\r\n"],"names":[],"mappings":";AACe,SAAS,eAAe,WAAW,MAAM,OAAO;AAC7D,QAAM,MAAM,oBAAI,KAAM;AACtB,QAAM,OAAO,IAAI,KAAK,SAAS;AAG/B,MAAI,OAAO,MAAM,MAAO,IAAI;AAC1B,WAAO;AAAA,EACR;AAED,QAAM,cAAa,oBAAI,QAAO,SAAS,GAAG,GAAG,GAAG,CAAC;AAGjD,QAAM,OAAO,MAAO,KAAK,SAAU,KAAI,KAAK,QAAQ,QAAS;AAC7D,QAAM,OAAO,MAAO,KAAK,SAAQ,IAAK,KAAM,KAAK,SAAU;AAC3D,QAAM,SAAS,KAAK,WAAY,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AAG3D,MAAI,aAAa,YAAY;AAC3B,UAAM,aAAa,KAAK,OAAO,MAAM,QAAQ,GAAI;AAGjD,QAAI,aAAa,IAAI;AACnB,aAAO;AAAA,IACR;AAGD,QAAI,aAAa,KAAK,IAAI;AACxB,YAAM,UAAU,KAAK,MAAM,aAAa,EAAE;AAC1C,aAAO,GAAG,OAAO;AAAA,IAClB;AAGD,QAAI,aAAa,KAAK,KAAK,GAAG;AAC5B,YAAM,QAAQ,KAAK,MAAM,cAAc,KAAK,GAAG;AAC/C,YAAM,UAAU,KAAK,OAAO,aAAa,QAAQ,KAAK,MAAM,EAAE;AAC9D,UAAI,SAAS;AACX,eAAO,GAAG,KAAK,MAAM,OAAO;AAAA,MACpC,OAAa;AACL,eAAO,GAAG,KAAK;AAAA,MAChB;AAAA,IACF;AAED,WAAO,GAAG,IAAI,GAAG,IAAI,IAAI,MAAM;AAAA,EAChC;AAGD,MAAI,aAAa,aAAa,MAAO,KAAK,KAAK,IAAI;AACjD,WAAO,MAAM,IAAI,GAAG,IAAI,IAAI,MAAM;AAAA,EACnC;AAGD,MAAI,aAAa,aAAa,MAAO,KAAK,KAAK,IAAI;AACjD,WAAO,MAAM,IAAI,GAAG,IAAI,IAAI,MAAM;AAAA,EACnC;AAED,QAAM,OAAO,KAAK;AAClB,QAAM,SAAS,KAAK,aAAa,GAAG,SAAQ,EAAG,SAAS,GAAG,GAAG;AAC9D,QAAM,MAAM,KAAK,QAAS,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AACrD,QAAM,aAAY,oBAAI,KAAI,GAAG,SAAS,GAAG,CAAC;AAG1C,MAAI,aAAa,WAAW;AAE1B,UAAM,iBAAiB,oBAAI,KAAM;AACjC,mBAAe,QAAQ,eAAe,QAAO,IAAK,eAAe,QAAQ;AACzE,UAAM,YAAY,eAAe,SAAS,GAAG,GAAG,GAAG,CAAC;AACpD,QAAI,aAAa,WAAW;AAC1B,YAAM,OAAO,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,IAAI;AACtD,aAAO,GAAG,KAAK,KAAK,OAAM,CAAE,CAAC,IAAI,IAAI,GAAG,IAAI,IAAI,MAAM;AAAA,IACvD;AAED,WAAO,GAAG,KAAK,IAAI,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,MAAM;AAAA,EAChD;AAGD,SAAO,GAAG,IAAI,IAAI,KAAK,IAAI,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,MAAM;AACzD;;"}