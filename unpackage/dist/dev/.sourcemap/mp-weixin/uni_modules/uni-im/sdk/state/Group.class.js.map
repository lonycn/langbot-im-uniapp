{"version":3,"file":"Group.class.js","sources":["uni_modules/uni-im/sdk/state/Group.class.js"],"sourcesContent":["import CloudData from '@/uni_modules/uni-im/sdk/ext/CloudData.class.js'\nimport GroupItem from './GroupItem.class.js'\nimport $users from '@/uni_modules/uni-im/sdk/methods/users.js';\n\nconst dbJQL = uniCloud.databaseForJQL()\nconst dbJQLCommand = dbJQL.command\nconst $ = dbJQL.command.aggregate\n\nexport default class Group extends CloudData {\n  constructor() {\n    super()\n  }\n  __beforeAdd(groupList) {\n    if(!Array.isArray(groupList)){\n      groupList = [groupList]\n    }\n    return groupList.map(data => new GroupItem(data))\n  }\n  async __get(param = {}) {\n    // console.error('pull Group Data param',param);\n    const {group_id} = param\n    let whereString = '\"user_id\" == $cloudEnv_uid && \"is_delete\" != true'\n    if(!this.min_create_time){\n      this.min_create_time = Date.now()\n    }\n    whereString += `&& \"create_time\" < ${this.min_create_time}`\n    if (group_id) {\n      whereString += `&& \"group_id\" == \"${group_id}\"`\n    }\n    // console.log('this.min_create_time',this.min_create_time)\n    // console.log('whereString',whereString)\n    const res = await dbJQL.collection(\n        dbJQL.collection('uni-im-group-member')\n          .where(whereString)\n          .orderBy('create_time', 'desc')\n          .getTemp(),\n        dbJQL.collection('uni-im-group').getTemp()\n      )\n      .limit(this.loadLimit)\n      .get()\n    let groupList = res.data\n    const length = groupList.length\n    if(length){\n      this.min_create_time = groupList[length - 1].create_time\n    }\n    groupList = groupList.map(item => item.group_id[0])\n    return groupList\n  }\n}"],"names":["uniCloud","CloudData","GroupItem"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAIA,MAAM,QAAQA,cAAQ,GAAC,eAAgB;AAClB,MAAM;AACjB,MAAM,QAAQ;AAET,MAAM,cAAcC,0CAAAA,UAAU;AAAA,EAC3C,cAAc;AACZ,UAAO;AAAA,EACR;AAAA,EACD,YAAY,WAAW;AACrB,QAAG,CAAC,MAAM,QAAQ,SAAS,GAAE;AAC3B,kBAAY,CAAC,SAAS;AAAA,IACvB;AACD,WAAO,UAAU,IAAI,UAAQ,IAAIC,4CAAS,UAAC,IAAI,CAAC;AAAA,EACjD;AAAA,EACK,QAAkB;AAAA,+CAAZ,QAAQ,IAAI;AAEtB,YAAM,EAAC,SAAQ,IAAI;AACnB,UAAI,cAAc;AAClB,UAAG,CAAC,KAAK,iBAAgB;AACvB,aAAK,kBAAkB,KAAK,IAAK;AAAA,MAClC;AACD,qBAAe,sBAAsB,KAAK,eAAe;AACzD,UAAI,UAAU;AACZ,uBAAe,qBAAqB,QAAQ;AAAA,MAC7C;AAGD,YAAM,MAAM,MAAM,MAAM;AAAA,QACpB,MAAM,WAAW,qBAAqB,EACnC,MAAM,WAAW,EACjB,QAAQ,eAAe,MAAM,EAC7B,QAAS;AAAA,QACZ,MAAM,WAAW,cAAc,EAAE,QAAS;AAAA,MAC3C,EACA,MAAM,KAAK,SAAS,EACpB,IAAK;AACR,UAAI,YAAY,IAAI;AACpB,YAAM,SAAS,UAAU;AACzB,UAAG,QAAO;AACR,aAAK,kBAAkB,UAAU,SAAS,CAAC,EAAE;AAAA,MAC9C;AACD,kBAAY,UAAU,IAAI,UAAQ,KAAK,SAAS,CAAC,CAAC;AAClD,aAAO;AAAA,IACR;AAAA;AACH;;"}