{"version":3,"file":"Friend.class.js","sources":["uni_modules/uni-im/sdk/state/Friend.class.js"],"sourcesContent":["import CloudData from '@/uni_modules/uni-im/sdk/ext/CloudData.class.js'\nimport $state from '../state/index.js';\nconst dbJQL = uniCloud.databaseForJQL()\nconst dbJQLCommand = dbJQL.command\nconst $ = dbJQL.command.aggregate\nexport default class Friend extends CloudData {\n  __beforeAdd(friendList) {\n    // 将好友信息存储到users中\n    friendList.forEach(item => $state.users[item._id] = item)\n    return friendList\n  }\n  async __get(param = {}) {\n    const {friend_uid} = param\n    const limit = this.loadLimit\n    let whereString = '\"user_id\" == $cloudEnv_uid'\n    if (friend_uid) {\n      whereString += `&& \"friend_uid\" == \"${friend_uid}\"`\n      // console.log('whereString',whereString);\n    }\n    let res = await dbJQL.collection(\n        dbJQL.collection('uni-im-friend').where(whereString).field('friend_uid,mark,class_name')\n        .getTemp(),\n        dbJQL.collection('uni-id-users').field('_id,nickname,avatar_file,realname_auth').getTemp()\n      )\n      .limit(limit)\n      .get()\n    const usersList = res.data.map(item => item.friend_uid[0])\n    $state.users.merge(usersList.reduce((obj, item) => {\n      obj[item._id] = item\n      return obj\n    }, {}))\n    return usersList \n  }\n  remove(friend_uid) {\n    let friendList = $state.friend.dataList\n    let index = friendList.findIndex(i => i._id == friend_uid)\n    friendList.splice(index, 1)\n  }\n}"],"names":["uniCloud","CloudData","$state"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAEA,MAAM,QAAQA,cAAQ,GAAC,eAAgB;AAClB,MAAM;AACjB,MAAM,QAAQ;AACT,MAAM,eAAeC,0CAAAA,UAAU;AAAA,EAC5C,YAAY,YAAY;AAEtB,eAAW,QAAQ,UAAQC,kCAAM,MAAC,MAAM,KAAK,GAAG,IAAI,IAAI;AACxD,WAAO;AAAA,EACR;AAAA,EACK,QAAkB;AAAA,+CAAZ,QAAQ,IAAI;AACtB,YAAM,EAAC,WAAU,IAAI;AACrB,YAAM,QAAQ,KAAK;AACnB,UAAI,cAAc;AAClB,UAAI,YAAY;AACd,uBAAe,uBAAuB,UAAU;AAAA,MAEjD;AACD,UAAI,MAAM,MAAM,MAAM;AAAA,QAClB,MAAM,WAAW,eAAe,EAAE,MAAM,WAAW,EAAE,MAAM,4BAA4B,EACtF,QAAS;AAAA,QACV,MAAM,WAAW,cAAc,EAAE,MAAM,wCAAwC,EAAE,QAAS;AAAA,MAC3F,EACA,MAAM,KAAK,EACX,IAAK;AACR,YAAM,YAAY,IAAI,KAAK,IAAI,UAAQ,KAAK,WAAW,CAAC,CAAC;AACzDA,wCAAM,MAAC,MAAM,MAAM,UAAU,OAAO,CAAC,KAAK,SAAS;AACjD,YAAI,KAAK,GAAG,IAAI;AAChB,eAAO;AAAA,MACR,GAAE,CAAE,CAAA,CAAC;AACN,aAAO;AAAA,IACR;AAAA;AAAA,EACD,OAAO,YAAY;AACjB,QAAI,aAAaA,wCAAO,OAAO;AAC/B,QAAI,QAAQ,WAAW,UAAU,OAAK,EAAE,OAAO,UAAU;AACzD,eAAW,OAAO,OAAO,CAAC;AAAA,EAC3B;AACH;;"}