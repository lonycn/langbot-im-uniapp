{"version":3,"file":"MsgItem.class.js","sources":["uni_modules/uni-im/sdk/state/MsgItem.class.js"],"sourcesContent":["import md5 from '@/uni_modules/uni-im/sdk/utils/md5.min.js'\nimport $state from '@/uni_modules/uni-im/sdk/state/index.js'\nconst __updateAfterTimer = {}\nexport default class MsgItem{\n  constructor(msgData) {\n    for (let key in msgData) {\n      this[key] = msgData[key]\n    }\n    const {create_time,client_create_time} = msgData\n    this.unique_id = \"u\" + (create_time || client_create_time).toString(36) + md5( JSON.stringify(msgData))\n  }\n  __updateAfter(){\n    // 防抖 100ms\n    if(__updateAfterTimer[this.unique_id]){\n      clearTimeout(__updateAfterTimer[this.unique_id])\n    }\n    __updateAfterTimer[this.unique_id] = setTimeout(()=>{\n      const {conversation_id,_id} = this\n      if(_id){\n\t\t\t\tconst conversation = $state.conversation.find({conversation_id})\n\t\t\t\tif (conversation) {\n\t\t\t\t\tconversation.msg.dataMap.set(_id,this)\n\t\t\t\t}\n      }\n      // #ifndef H5\n      return // 仅H5环境下更新本地数据库\n      // #endif\n      const msg = JSON.parse(JSON.stringify(this))\n      // console.error('MsgItem __updateAfter',msg)\n      let request = $state.indexDB.transaction(['uni-im-msg'], 'readwrite')\n        .objectStore(\"uni-im-msg\")\n        .put(msg)\n      request.onsuccess = function(event) {\n        // console.log('event---更新本地数据库记录成功',event);\n      }\n      request.onerror = function(event) {\n        console.error(event);\n      };\n    },100)\n    \n  }\n}"],"names":["md5","$state"],"mappings":";;;;AAEA,MAAM,qBAAqB,CAAE;AACd,MAAM,QAAO;AAAA,EAC1B,YAAY,SAAS;AACnB,aAAS,OAAO,SAAS;AACvB,WAAK,GAAG,IAAI,QAAQ,GAAG;AAAA,IACxB;AACD,UAAM,EAAC,aAAY,mBAAkB,IAAI;AACzC,SAAK,YAAY,OAAO,eAAe,oBAAoB,SAAS,EAAE,IAAIA,oCAAAA,IAAK,KAAK,UAAU,OAAO,CAAC;AAAA,EACvG;AAAA,EACD,gBAAe;AAEb,QAAG,mBAAmB,KAAK,SAAS,GAAE;AACpC,mBAAa,mBAAmB,KAAK,SAAS,CAAC;AAAA,IAChD;AACD,uBAAmB,KAAK,SAAS,IAAI,WAAW,MAAI;AAClD,YAAM,EAAC,iBAAgB,IAAG,IAAI;AAC9B,UAAG,KAAI;AACT,cAAM,eAAeC,kCAAAA,MAAO,aAAa,KAAK,EAAC,gBAAe,CAAC;AAC/D,YAAI,cAAc;AACjB,uBAAa,IAAI,QAAQ,IAAI,KAAI,IAAI;AAAA,QACrC;AAAA,MACE;AAED;AAAA,IAaD,GAAC,GAAG;AAAA,EAEN;AACH;;"}