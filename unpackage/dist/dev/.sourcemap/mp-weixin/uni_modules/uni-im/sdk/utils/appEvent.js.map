{"version":3,"file":"appEvent.js","sources":["uni_modules/uni-im/sdk/utils/appEvent.js"],"sourcesContent":["// #ifdef VUE3\r\nimport {\r\n\tonShow\r\n} from '@dcloudio/uni-app'\r\nimport {\r\n\tonHide\r\n} from '@dcloudio/uni-app'\r\n// #endif\r\n\r\nfunction implEvent(name) {\r\n  let cbs = `_callbacks_${name}`\r\n  return {\r\n    [cbs]: [],\r\n    [`on${name}`]: function(callback) {\r\n      this[cbs].push(callback)\r\n    },\r\n    [`off${name}`]: function(callback) {\r\n      this[cbs] = this[cbs].filter(cb => cb !== callback)\r\n    },\r\n    [`emit${name}`]: function(...args) {\r\n      for (let cb of this[cbs]) {\r\n        cb.call(null, ...args)\r\n      }\r\n    },\r\n  }\r\n}\r\n\r\nconst appEvent = {\r\n  ...implEvent('AppActivate'),\r\n  ...implEvent('AppDeactivate'),\r\n\r\n  callbacks_KeyDown: [],\r\n  onKeyDown(callback, { order = 0, match = {} } = {}) {\r\n    this['callbacks_KeyDown'].push({\r\n      callback,\r\n      order,\r\n      match,\r\n    })\r\n    this['callbacks_KeyDown'].sort((a, b) => a.order - b.order)\r\n  },\r\n  offKeyDown(callback) {\r\n    this.callbacks_KeyDown = this.callbacks_KeyDown.filter(v => v.callback !== callback)\r\n  },\r\n  emitKeyDown(evt) {\r\n    for (let v of this.callbacks_KeyDown) {\r\n      let matched = Object.keys(v.match).reduce((matched, name) => {\r\n        return matched && evt[name] === v.match[name]\r\n      }, true)\r\n      if (!matched) continue\r\n      let res = v.callback.call(null, evt)\r\n      if (res === true) break\r\n    }\r\n  },\r\n}\r\n\r\n// 监听应用生命周期\r\nsetTimeout(() => {\r\n\t// #ifdef APP\r\n\t// #ifdef VUE2\r\n\tgetApp().$vm.$on('hook:onShow', function() {\r\n\t\tappEvent.emitAppActivate()\r\n\t})\r\n\tgetApp().$vm.$on('hook:onHide', function() {\r\n\t\tappEvent.emitAppDeactivate()\r\n\t})\r\n\t// #endif\r\n\r\n\t// #ifdef VUE3\r\n\tonShow(function() {\r\n\t\tappEvent.emitAppActivate()\r\n\t}, getApp().$vm.$)\r\n\tonHide(function() {\r\n\t\tappEvent.emitAppDeactivate()\r\n\t}, getApp().$vm.$)\r\n\t// #endif\r\n\t// #endif\r\n\r\n\t// #ifdef H5\r\n\twindow.addEventListener(\"focus\", () => {\r\n\t\tappEvent.emitAppActivate()\r\n\t})\r\n\twindow.addEventListener(\"blur\", () => {\r\n\t\tappEvent.emitAppDeactivate()\r\n\t})\r\n\twindow.addEventListener(\"keydown\", (evt) => {\r\n\t\tappEvent.emitKeyDown(evt)\r\n\t})\r\n\t// #endif\r\n\r\n\t// #ifdef MP\r\n\tuni.onAppShow(function() {\r\n\t\tappEvent.emitAppActivate()\r\n\t})\r\n\tuni.onAppHide(function() {\r\n\t\tappEvent.emitAppDeactivate()\r\n\t})\r\n\t// #endif\r\n\r\n}, 0)\r\n\r\nexport default appEvent\n"],"names":["matched","uni"],"mappings":";;;;;;;;;;;;;;;;;;;;;AASA,SAAS,UAAU,MAAM;AACvB,MAAI,MAAM,cAAc,IAAI;AAC5B,SAAO;AAAA,IACL,CAAC,GAAG,GAAG,CAAE;AAAA,IACT,CAAC,KAAK,IAAI,EAAE,GAAG,SAAS,UAAU;AAChC,WAAK,GAAG,EAAE,KAAK,QAAQ;AAAA,IACxB;AAAA,IACD,CAAC,MAAM,IAAI,EAAE,GAAG,SAAS,UAAU;AACjC,WAAK,GAAG,IAAI,KAAK,GAAG,EAAE,OAAO,QAAM,OAAO,QAAQ;AAAA,IACnD;AAAA,IACD,CAAC,OAAO,IAAI,EAAE,GAAG,YAAY,MAAM;AACjC,eAAS,MAAM,KAAK,GAAG,GAAG;AACxB,WAAG,KAAK,MAAM,GAAG,IAAI;AAAA,MACtB;AAAA,IACF;AAAA,EACF;AACH;AAEK,MAAC,WAAW,gDACZ,UAAU,aAAa,IACvB,UAAU,eAAe,IAFb;AAAA,EAIf,mBAAmB,CAAE;AAAA,EACrB,UAAU,UAAU,EAAE,QAAQ,GAAG,QAAQ,CAAA,EAAI,IAAG,IAAI;AAClD,SAAK,mBAAmB,EAAE,KAAK;AAAA,MAC7B;AAAA,MACA;AAAA,MACA;AAAA,IACN,CAAK;AACD,SAAK,mBAAmB,EAAE,KAAK,CAAC,GAAG,MAAM,EAAE,QAAQ,EAAE,KAAK;AAAA,EAC3D;AAAA,EACD,WAAW,UAAU;AACnB,SAAK,oBAAoB,KAAK,kBAAkB,OAAO,OAAK,EAAE,aAAa,QAAQ;AAAA,EACpF;AAAA,EACD,YAAY,KAAK;AACf,aAAS,KAAK,KAAK,mBAAmB;AACpC,UAAI,UAAU,OAAO,KAAK,EAAE,KAAK,EAAE,OAAO,CAACA,UAAS,SAAS;AAC3D,eAAOA,YAAW,IAAI,IAAI,MAAM,EAAE,MAAM,IAAI;AAAA,MAC7C,GAAE,IAAI;AACP,UAAI,CAAC;AAAS;AACd,UAAI,MAAM,EAAE,SAAS,KAAK,MAAM,GAAG;AACnC,UAAI,QAAQ;AAAM;AAAA,IACnB;AAAA,EACF;AACH;AAGA,WAAW,MAAM;AAkChBC,gBAAG,MAAC,UAAU,WAAW;AACxB,aAAS,gBAAiB;AAAA,EAC5B,CAAE;AACDA,gBAAG,MAAC,UAAU,WAAW;AACxB,aAAS,kBAAmB;AAAA,EAC9B,CAAE;AAGF,GAAG,CAAC;;"}