{"version":3,"file":"list.js","sources":["uni_modules/uni-im/pages/group/notice/list.vue","uni_modules/uni-im/pages/group/notice/list.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"group-notice-list\">\n\t\t<view v-if=\"isWidescreen\" class=\"navigator\">\n\t\t\t<text class=\"title\">群公告列表</text>\n\t\t\t<uni-icons @click=\"$emit('close')\" type=\"clear\" size=\"20\" color=\"#BBB\"></uni-icons>\n\t\t</view>\n\t\t<scroll-view class=\"group-notice-content\" :scroll-y=\"true\">\n\t\t\t<unicloud-db v-slot:default=\"{data, loading, error, options}\" collection=\"uni-im-group-notice\" ref=\"udb\" loadtime=\"manual\" :where=\"where\" orderby=\"create_time desc\">\n\t\t\t\t<view v-for=\"(item,index) in data\" :key=\"index\" class=\"notice-item\">\n\t\t\t\t\t<uni-im-msg :msg=\"{...item.content,'from_uid':item.user_id,'create_time':item.create_time}\" preview ></uni-im-msg>\n\t\t\t\t\t<view v-if=\"isAdmin\" class=\"btns-box\">\n\t\t\t\t\t\t<button class=\"btn\" type=\"warn\" plain @click=\"remove(item)\">删除</button>\n\t\t\t\t\t\t<button class=\"btn\" type=\"primary\" @click=\"toEdit(item._id)\">编辑</button>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<uni-im-load-state :status=\"loading ? 'loading' : ''\" :contentText='{\n\t\t\t\t\t\"contentrefresh\": \"加载中...\",\n\t\t\t\t\t\"contentnomore\": data.length ? \"没有更多了\" : \"暂无数据\"\n\t\t\t\t}'/>\n\t\t\t\t<view v-if=\"error\">{{error.message}}</view>\n\t\t\t</unicloud-db>\n\t\t</scroll-view>\n\t\t<uni-fab v-if=\"isAdmin\" @click=\"toEdit(false)\" horizontal=\"right\"></uni-fab>\n\t\t<uni-popup ref=\"notice-edit-pop\" type=\"center\">\n\t\t\t<notice-edit ref=\"notice-edit\" @back=\"$refs['notice-edit-pop'].close()\"></notice-edit>\n\t\t</uni-popup>\n\t</view>\n</template>\n\n<script>\n\timport uniIm from '@/uni_modules/uni-im/sdk/index.js';\n\timport msgRichText from '@/uni_modules/uni-im/components/uni-im-msg/types/rich-text.vue'\n\timport noticeEdit from '@/uni_modules/uni-im/pages/group/notice/edit.vue';\n\texport default {\n\t\temits: ['close'],\n\t\tcomputed: {\n\t\t\t...uniIm.mapState(['isWidescreen'])\n\t\t},\n\t\tcomponents: {\n\t\t\tmsgRichText,\n\t\t\tnoticeEdit\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\twhere: {},\n\t\t\t\tisAdmin: false\n\t\t\t}\n\t\t},\n\t\tonLoad(param) {\n\t\t\tthis.$nextTick(()=>{\n\t\t\t\tthis.load(param)\n\t\t\t})\n\t\t},\n\t\tmethods: {\n\t\t\tasync remove(item){\n\t\t\t\tuni.showModal({\n\t\t\t\t\tcontent: '确认删除该公告？',\n\t\t\t\t\tsuccess: async (res) => {\n\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\tuni.showLoading({\n\t\t\t\t\t\t\t\tmask: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t// 为了适配触发器的权限验证，必须传_id + group_id\n\t\t\t\t\t\t\tconst {_id,group_id} = item\n\t\t\t\t\t\t\tconst dbJQL = uniCloud.databaseForJQL()\n\t\t\t\t\t\t\tawait dbJQL.collection('uni-im-group-notice')\n\t\t\t\t\t\t\t.where({_id,group_id})\n\t\t\t\t\t\t\t.remove()\n\t\t\t\t\t\t\t.then(res=>{\n\t\t\t\t\t\t\t\tthis.$refs.udb.dataList = this.$refs.udb.dataList.filter(it=>it._id !== item._id)\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(err=>{\n\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\ttitle: '删除失败',\n\t\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.finally(()=>{\n\t\t\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tload({group_id}){\n\t\t\t\t// console.log('group_id',group_id)\n\t\t\t\tthis.where.group_id = group_id\n\t\t\t\tthis.$refs.udb.loadData()\n\t\t\t\tconst groupObj = uniIm.group.find(group_id)\n\t\t\t\t// console.log('groupObj',groupObj)\n\t\t\t\tthis.isAdmin = groupObj?.member.find(uniIm.currentUser._id)?.role.includes('admin')\n\t\t\t\t// console.log('isAdmin',this.isAdmin)\n\t\t\t},\n\t\t\ttoEdit(_id){\n\t\t\t\tconst dataList = this.$refs.udb.dataList\n\t\t\t\tconst events = {\n\t\t\t\t\tupdate(value){\n\t\t\t\t\t\tconsole.log('events update',value)\n\t\t\t\t\t\tdataList.forEach(item=>{\n\t\t\t\t\t\t\tif(item._id === value._id){\n\t\t\t\t\t\t\t\tObject.assign(item,value)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t\tadd(value){\n\t\t\t\t\t\tconsole.log('events add',value)\n\t\t\t\t\t\tdataList.unshift(value)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(uniIm.isWidescreen){\n\t\t\t\t\tthis.$refs['notice-edit-pop'].open()\n\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\tthis.$refs['notice-edit'].load({\n\t\t\t\t\t\t\t_id,\n\t\t\t\t\t\t\tgroup_id: this.where.group_id\n\t\t\t\t\t\t},events)\n\t\t\t\t\t},0)\n\t\t\t\t} else {\n\t\t\t\t\tlet url = '/uni_modules/uni-im/pages/group/notice/edit?group_id=' + this.where.group_id\n\t\t\t\t\tif(_id){\n\t\t\t\t\t\turl += '&_id=' + _id\n\t\t\t\t\t}\n\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\turl,\n\t\t\t\t\t\tevents\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n@import \"@/uni_modules/uni-im/common/baseStyle.scss\";\npage {\n\tbackground-color: #FAFAFA;\n\tflex: 1;\n\theight: 100%;\n}\n.group-notice-list {\n\theight: 100%;\n\tflex: 1;\n\t.group-notice-content {\n\t\theight: 0;\n\t\tflex: 1;\n\t}\n\t.navigator {\n\t\tflex-direction: row;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\twidth: 100%;\n\t\theight: 50px;\n\t\tbackground-color: #f5f5f5;\n\t\t.title {\n\t\t\tfont-size: 16px;\n\t\t\ttext-align: center;\n\t\t}\n\t\t::v-deep .uni-icons {\n\t\t\tposition: absolute;\n\t\t\tright: 10px;\n\t\t\t/* #ifdef H5 */\n\t\t\tcursor: pointer;\n\t\t\t/* #endif */\n\t\t}\n\t}\n\t.notice-item {\n\t\tpadding: 10px 0;\n\t\tbackground-color: #fff;\n\t\tmargin-bottom: 10px;\n\t\t.btns-box {\n\t\t\tflex-direction: row;\n\t\t\tmargin-top: 10px;\n\t\t\tjustify-content: flex-end;\n\t\t\t.btn {\n\t\t\t\tmargin-right: 10px;\n\t\t\t\tfont-size: 12px;\n\t\t\t}\n\t\t}\n\t}\n\t::v-deep {\n\t\t.uni-fab__circle {\n\t\t\tposition: absolute;\n\t\t\tbottom: 10px;\n\t\t}\n\t\t.group-notice-edit {\n\t\t\tborder-radius: 10px;\n\t\t\twidth: 600px;\n\t\t}\n\t}\n}\n</style>\n","import MiniProgramPage from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/pages/group/notice/list.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniIm","uni","uniCloud","res"],"mappings":"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"}