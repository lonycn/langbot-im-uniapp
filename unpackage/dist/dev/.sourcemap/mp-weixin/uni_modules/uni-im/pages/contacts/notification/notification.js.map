{"version":3,"file":"notification.js","sources":["uni_modules/uni-im/pages/contacts/notification/notification.vue","uni_modules/uni-im/pages/contacts/notification/notification.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"notification-box\">\n\t\t<text class=\"tips\" v-if=\"tips\">{{tips}}</text>\n\t\t<uni-list :border=\"false\">\n\t\t\t<template v-if=\"notificationDatas && notificationDatas.length\">\n\t\t\t\t<uni-im-info-card v-for=\"(item,index) in notificationDatas\" :key=\"item.id\" :avatarCircle=\"true\"\n\t\t\t\t\t:clickable=\"true\" :badge=\"item.is_read?'':'dot'\" badgePositon=\"left\"\n\t\t\t\t\t:title=\"item.payload.title || item.title\" :note=\"item.payload.content||item.content||'无'\"\n\t\t\t\t\t:avatar=\"item.payload?.avatar_file?.url || '/uni_modules/uni-im/static/noticeIcon/notification2.png'\"\n\t\t\t\t\t@click.native=\"clickHandle(index,item)\" direction=\"column\" :time=\"friendlyTime(item.create_time)\">\n\t\t\t\t\t<view class=\"handle-box\">\n\t\t\t\t\t\t<template v-if=\"item.payload.state\">\n\t\t\t\t\t\t\t<text class=\"handle done\">\n\t\t\t\t\t\t\t\t{{'已'+(item.payload.state == 'confirm'?item.payload.confirmText:item.payload.cancelText)}}\n\t\t\t\t\t\t\t</text>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<text class=\"handle\" @click.stop=\"doAction(index,0)\"\n\t\t\t\t\t\t\t\tv-if=\"item.payload.cancelText\">{{item.payload.cancelText}}</text>\n\t\t\t\t\t\t\t<text class=\"handle\" @click.stop=\"doAction(index,1)\"\n\t\t\t\t\t\t\t\tv-if=\"item.payload.confirmText\">{{item.payload.confirmText}}</text>\n\t\t\t\t\t\t\t<uni-icons v-if=\"!item.payload.cancelText && !item.payload.confirmText && item.path\" type=\"right\"\n\t\t\t\t\t\t\t\tcolor=\"#cccccc\"></uni-icons>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</view>\n\t\t\t\t</uni-im-info-card>\n\t\t\t</template>\n\t\t\t<uni-list-item v-else class=\"load-more\">\n\t\t\t\t<template v-slot:body>\n\t\t\t\t\t<uni-im-load-state :contentText=\"contentText\" class=\"tip\" :status=\"hasMore?'loading':'noMore'\"></uni-im-load-state>\n\t\t\t\t</template>\n\t\t\t</uni-list-item>\n\t\t</uni-list>\n\t</view>\n</template>\n\n<script>\n\timport uniIm from '@/uni_modules/uni-im/sdk/index.js';\n\timport action from './action.js';\n\tconst db = uniCloud.database();\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tcontentText: {\n\t\t\t\t\t\"contentrefresh\": \"加载中...\",\n\t\t\t\t\t\"contentnomore\": \"- 暂无相关数据 -\"\n\t\t\t\t},\n\t\t\t\tfilterNotice: {},\n\t\t\t\ttips: \"\",\n\t\t\t\thasMore: true\n\t\t\t\t// notificationDatas:[]\n\t\t\t}\n\t\t},\n\t\tasync onLoad({\n\t\t\tparam\n\t\t}) {\n\t\t\t// console.log(param,decodeURIComponent(param))\n\t\t\tparam = JSON.parse(decodeURIComponent(param))\n\t\t\t// console.log(param)\n\t\t\tthis.setParam(param)\n\t\t},\n\t\tcomputed: {\n\t\t\t//是否为pc宽屏（width>960px）\n\t\t\tisWidescreen() {\n\t\t\t\treturn uniIm.isWidescreen\n\t\t\t},\n\t\t\tnotificationDatas() {\n\t\t\t\tlet notificationDatas = uniIm.notification.get(this.filterNotice)\n\t\t\t\tif (notificationDatas.length == 0) {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.hasMore = false\n\t\t\t\t\t}, 100);\n\t\t\t\t}\n\t\t\t\treturn notificationDatas\n\t\t\t}\n\t\t},\n\t\tmounted() {\n\t\t\tthis.hasMore = uniIm.notification.hasMore\n\t\t},\n\t\tmethods: {\n\t\t\tsetParam({\n\t\t\t\tfilterNotice,\n\t\t\t\ttitle\n\t\t\t}) {\n\t\t\t\tif (typeof filterNotice == 'string') {\n\t\t\t\t\tfilterNotice = JSON.parse(decodeURIComponent(filterNotice))\n\t\t\t\t}\n\t\t\t\tthis.filterNotice = filterNotice\n\t\t\t\tconsole.log('filterNotice', filterNotice)\n\t\t\t\tuni.setNavigationBarTitle({\n\t\t\t\t\ttitle\n\t\t\t\t})\n\n\t\t\t\tif (title == '新朋友' && !this.isWidescreen) {\n\t\t\t\t\tthis.tips = '好友请求通知'\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync setItem({\n\t\t\t\t_id\n\t\t\t}, param) {\n\t\t\t\tconst datas = uniIm.notification.get(this.filterNotice)\n\t\t\t\tfor (let i = 0; i < datas.length; i++) {\n\t\t\t\t\tif (datas[i]._id == _id) {\n\t\t\t\t\t\tdatas[i] = deepAssign(datas[i], param)\n\t\t\t\t\t\tuniIm.notificationDatas = datas\n\t\t\t\t\t\tconsole.log('uniIm.notificationDatas', uniIm.notificationDatas)\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet ares = await db.collection('uni-im-notification')\n\t\t\t\t\t.where(`\"_id\" == \"${_id}\" && \"user_id\" == $cloudEnv_uid`)\n\t\t\t\t\t.get()\n\t\t\t\t// console.log(13231,ares);\n\t\t\t\tlet res = await db.collection('uni-im-notification')\n\t\t\t\t\t.where(`\"_id\" == \"${_id}\" && \"user_id\" == $cloudEnv_uid`)\n\t\t\t\t\t.update(param)\n\t\t\t\t// console.log('res---66666',param,res.result.updated);\n\n\t\t\t\t/**\n\t\t\t\t *判断对象是否是一个纯粹的对象\n\t\t\t\t */\n\t\t\t\tfunction isPlainObject(obj) {\n\t\t\t\t\treturn typeof obj === 'object' && Object.prototype.toString.call(obj) === '[object Object]'\n\t\t\t\t}\n\t\t\t\t/**\n\t\t\t\t *深度合并多个对象的方法\n\t\t\t\t */\n\t\t\t\tfunction deepAssign() {\n\t\t\t\t\tlet len = arguments.length,\n\t\t\t\t\t\ttarget = arguments[0]\n\t\t\t\t\tif (!isPlainObject(target)) {\n\t\t\t\t\t\ttarget = {}\n\t\t\t\t\t}\n\t\t\t\t\tfor (let i = 1; i < len; i++) {\n\t\t\t\t\t\tlet source = arguments[i]\n\t\t\t\t\t\tif (isPlainObject(source)) {\n\t\t\t\t\t\t\tfor (let s in source) {\n\t\t\t\t\t\t\t\tif (s === '__proto__' || target === source[s]) {\n\t\t\t\t\t\t\t\t\tcontinue\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (isPlainObject(source[s])) {\n\t\t\t\t\t\t\t\t\ttarget[s] = deepAssign(target[s], source[s])\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttarget[s] = source[s]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn target\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync clickHandle(index, item) {\n\t\t\t\t// console.log('index',index,item);\n\t\t\t\t//如果未读，设置为已读\n\t\t\t\tif (!item.is_read) {\n\t\t\t\t\tthis.setItem(item, {\n\t\t\t\t\t\tis_read: true\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\t//存在链接就跳转\n\t\t\t\tlet path = item.path || item.payload.path\n\t\t\t\tif (path) {\n\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\turl: path,\n\t\t\t\t\t\tfail: (e) => {\n\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\t// let item = this.notificationDatas[index]\n\t\t\t\t// item.data.is_read = true\n\t\t\t\t// this.notificationDatas[index] = Object.assign({},item)\n\t\t\t\t// console.log(this.notificationDatas);\n\t\t\t},\n\t\t\tdoAction(index, type) {\n\t\t\t\tlet item = this.notificationDatas[index]\n\t\t\t\tlet e = {\n\t\t\t\t\tsubType: item.payload.subType,\n\t\t\t\t\tconfirm: type === 1,\n\t\t\t\t\tcancel: type === 0,\n\t\t\t\t\titem\n\t\t\t\t}\n\t\t\t\taction(e, data => {\n\t\t\t\t\tconsole.log('doAction', data)\n\t\t\t\t\tthis.setItem(item, {\n\t\t\t\t\t\tis_read: true,\n\t\t\t\t\t\tpayload: {\n\t\t\t\t\t\t\tstate: type === 1 ? 'confirm' : 'cancel'\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\t// console.log(index);\n\t\t\t},\n\t\t\tfriendlyTime(timestamp) {\n\t\t\t\treturn uniIm.utils.toFriendlyTime(timestamp)\n\t\t\t},\n\t\t\thandleText(state) {\n\t\t\t\tswitch (state) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\treturn '同意'\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 100:\n\t\t\t\t\t\treturn '已同意'\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase -100:\n\t\t\t\t\t\treturn '已拒绝'\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn '其他'\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n  @import \"@/uni_modules/uni-im/common/baseStyle.scss\";\n\t.notification-box {\n\t\theight: 100vh;\n\t\tbackground-color: #f5f5f5;\n    .tips {\n    \theight: 40px;\n    \tline-height: 40px;\n    \tpadding-left: 20rpx;\n    \tfont-size: 26rpx;\n    \tcolor: #666;\n    }\n    \n    .handle-box {\n    \tflex-direction: row;\n    \theight: 40px;\n    \talign-items: center;\n    }\n    \n    .handle {\n    \twidth: 50px;\n    \ttext-align: center;\n    \theight: 25px;\n    \tline-height: 25px;\n    \tbackground-color: #efefef;\n    \tborder-radius: 50px;\n    \tfont-size: 12px;\n    \tmargin: 0 5px;\n    \t/* #ifdef H5 */\n    \tcursor: pointer;\n    \t/* #endif */\n    }\n    \n    .done {\n    \twidth: 50px;\n    \tbackground-color: #FFF;\n    \tcolor: #aaa;\n    \t/* #ifdef H5 */\n    \tcursor: default;\n    \t/* #endif */\n    }\n    \n    .load-more {\n    \tbackground-color: #f5f5f5 !important;\n    \tjustify-content: center;\n    }\n    \n    .tip {\n    \tposition: relative;\n    \tleft: -15px;\n    \twidth: 750rpx;\n    \t/* pc宽屏时需要使用100vw */\n    \twidth: 100%;\n    }\n    \n    /* #ifdef MP-WEIXIN */\n    .load-more ::v-deep .uni-list-item {\n    \tbackground-color: #f5f5f5 !important;\n    }\n    \n    /* #endif */\n\t}\n</style>","import MiniProgramPage from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/pages/contacts/notification/notification.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uniIm","uni","action"],"mappings":"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"}