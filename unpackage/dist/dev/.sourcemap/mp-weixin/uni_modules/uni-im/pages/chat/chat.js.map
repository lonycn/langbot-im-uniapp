{"version":3,"file":"chat.js","sources":["uni_modules/uni-im/pages/chat/chat.vue","uni_modules/uni-im/pages/chat/chat.vue?type=page"],"sourcesContent":["<template>\n  <view id=\"uni-im-chat\" class=\"uni-im-chat\" :class=\"{'pc':isWidescreen}\">\n    <!-- #ifdef H5 -->\n    <!-- web-pc端会话标题 -->\n    <view v-if=\"isWidescreen\" id=\"web-pc-chat-title\">\n      <text :selectable=\"true\">{{navTitle}}</text>\n      <template v-for=\"(item,index) in extChatTitle\" :key=\"index\">\n        <component :is=\"item.component\" v-bind=\"item.props\"></component>\n      </template>\n    </view>\n    <!-- H5端 左上角显示未读消息数 ，app端使用setTitleNViewButtonBadge设置，小程序端暂未支持-->\n    <view @click=\"tapUnreadCount\" class=\"unread_count\" v-if=\"unread_count != 0\">\n      {{ unread_count > 99 ? '99+' : unread_count }}\n    </view>\n    <!-- #endif -->\n\n    <!-- 消息列表 -->\n    <uni-im-msg-list :conversationId=\"conversation.id\" ref=\"msg-list\" \n      @showControl=\"showControl\" @longpressMsgAvatar=\"onLongpressMsgAvatar\"\n      @retriesSendMsg=\"retriesSendMsg\" class=\"msg-list\"\n      @putChatInputContent=\"putChatInputContent\" :chooseMore=\"chooseMoreMsg\"\n      :checkedMsgList.sync=\"checkedMsgList\"\n      @showMenberList=\"showMenberList\"\n\t\t\t@touchstart=\"onclickMsgList\"\n    ></uni-im-msg-list>\n    \n    <!-- 聊天数据输入框 键盘弹出后要抬高底部内边距 全面屏的安全距离 -->\n    <text v-if=\"conversation.leave\" class=\"disable-chat-foot\">- 你不是此群成员 -</text>\n    <text v-else-if=\"conversation.isMuteAllMembers\" class=\"disable-chat-foot\">-  全群禁言禁止输入 -</text>\n    <view v-else class=\"chat-foot\" @touchmove.prevent>\n      <uni-im-chat-input\n        ref=\"chat-input\"\n        v-model=\"chatInputContent\"\n        :keyboardMaxHeight=\"keyboardMaxHeight\"\n        :keyboardHeight=\"keyboardHeight\"\n        @confirm=\"chatInputConfirm\"\n        @input=\"onInput\"\n        @sendSoundMsg=\"sendSoundMsg\"\n        @sendCodeMsg=\"beforeSendMsg\"\n        @showMenberList=\"showMenberList\"\n      >\n        <template #about-msg>\n          <view class=\"answer-msg\" v-if=\"answerMsg !== false\">\n            <text class=\"answer-msg-text\">{{answerMsgNickname}}：{{answerMsgNote}}</text>\n            <uni-icons class=\"close-icon\" @click=\"answerMsg = false\" type=\"clear\" color=\"#ccc\" size=\"18px\"></uni-icons>\n          </view>\n        </template>\n      </uni-im-chat-input>\n      \n      <toolbar v-model=\"chooseMoreMsg\" @shareMsg=\"shareMsg(checkedMsgList,$event)\"></toolbar>\n    </view>\n\n    <msg-popup-control ref=\"msg-popup-control\" @answer=\"setAnswerMsg\" @intoTopic=\"intoTopic\" @share=\"shareMsg\" @chooseMore=\"chooseMoreMsg = true;checkedMsgList = $event\"></msg-popup-control>\n\n    \n    <uni-im-member-list ref=\"member-list\" :conversationId=\"conversation.id\"></uni-im-member-list>\n\n    <!-- #ifdef H5 -->\n    <uni-im-share-msg v-if=\"isWidescreen\" id=\"uni-im-share-msg\" ref=\"share-msg\"></uni-im-share-msg>\n    <!-- #endif -->\n    \n    <view style=\"position: fixed;top: 200px;left: 0;background-color: #FFFFFF;z-index: 9999;\">\n      <!-- keyboardMaxHeight:{{keyboardMaxHeight}}\n\t\t\tconversation.leave:{{conversation.leave}}\n      chatInputContent:{{chatInputContent}}\n\t\t\tkeyboardHeight:{{keyboardHeight}}\n\t\t\tsystemInfo.osName:{{systemInfo.osName}}\n      chooseMoreMsg:{{chooseMoreMsg}}\n      checkedMsgList:{{checkedMsgList}} -->\n\t\t</view>\n  </view>\n</template>\n\n<script>\n  import uniIm from '@/uni_modules/uni-im/sdk/index.js';\n  import msgPopupControl from '@/uni_modules/uni-im/components/uni-im-msg/popup-control.vue';\n  import toolbar from './toolbar.vue';\n  import {markRaw} from \"vue\";\n  // #ifdef H5\n  import uniImShareMsg from '@/uni_modules/uni-im/pages/share-msg/share-msg.vue';\n  // #endif\n  \n\n/**\n * chat 组件，渲染一个完整的会话，包括头部、消息列表、输入区。\n * \n * @module\n * \n * @see 用于渲染消息列表的组件 {@link module:uni-im-msg-list}\n */\n  export default {\n    components: {\n      // #ifdef H5\n      uniImShareMsg,\n      // #endif\n      msgPopupControl,\n      toolbar\n    },\n    data() {\n      return {\n        // 当前会话对象\n        conversation: {\n          id: false,\n          leave:false,\n          title: ''\n        },\n        navTitle:\"\",//导航栏标题\n        keyboardHeight: 0,\n        keyboardMaxHeight: 0,\n        answerMsg: false,\n        chooseMoreMsg: false,\n        checkedMsgList: [],\n        // 聊天输入框内容\n        chatInputContent: '',\n      };\n    },\n    props: {\n      // #ifdef VUE3\n      conversation_id: {\n        default: ''\n      }\n      // #endif\n    },\n    computed: {\n      ...uniIm.mapState(['currentConversationId', 'isWidescreen', 'systemInfo']),\n      unread_count() {\n        // 所有会话的未读消息数\n        const unreadCount = uniIm.conversation.unreadCount()\n\n        // #ifdef APP-PLUS\n        // 给标题栏返回按钮添加数字角标，表示有几条其他会话的未读消息数\n        plus.webview.currentWebview().setTitleNViewButtonBadge({\n          index: 0,\n          text: unreadCount\n        })\n        // #endif\n\n        return unreadCount\n      },\n      //当前用户自己的uid\n      current_uid() {\n        return uniIm.currentUser._id;\n      },\n      extChatTitle(){\n        if(this.conversation){\n          return uniIm.extensions\n            .invokeExts(\"chat-title\",this.conversation)\n            .filter((result) => result && result.component)\n            .map((result) => {\n              return {\n                component: markRaw(result.component),\n                props: result.props||{}\n              };\n            });\n        }else{\n          return []\n        }\n      },\n      answerMsgNote() {\n        return uniIm.utils.getMsgNote(this.answerMsg)\n      },\n      answerMsgNickname() {\n        // 兼容旧版本，消息中未包含用户最新的昵称，需要通过用户id获取\n        return this.answerMsg.nickname || uniIm.users.getNickname(this.answerMsg.from_uid)\n      }\n    },\n    created() {\n      // console.log('chat created',this.systemInfo)\n      // 监听推送消息\n      this.onImMsg = (res) => {\n        if(uniIm.isDisabled){\n          return console.log('uniIm isDisabled')\n        }\n        //获取透传内容\n        const { data } = res.data.payload;\n        //判断消息类型是否为im，且为当前页面对应会话消息\n        if (\n          data.conversation_id == this.currentConversationId \n          && data.from_uid != this.current_uid \n          && uniIm.utils.isReadableMsg(data)\n        ) {\n          // 已经打开相应会话时，收到消息，则设置此会话为已读。注意无需判断，本地会话未读数是否为0，因为云端可能不为0\n          this.conversation.clearUnreadCount();\n          console.log('聊天页面-收到消息: ', JSON.stringify(res));\n          // 需要重新设置滚动条的高，以至于用户可以立即看到（即：滚动到最后一条消息）\n          // console.log(66666);\n\n          // 注：为兼容web-PC端这里必须使用setTimeout 0\n          setTimeout(() => {\n            this.$refs['msg-list']?.notifyNewMsg()\n          }, 0);\n        }\n      }\n      uniIm.onMsg(this.onImMsg);\n      \n      // 优化 提前拿到键盘高度，防止第一次在会话点击输入框时，输入框抬起慢。（缺省值300，是为了解决模拟器调试没有键盘高度而设置）\n      this.keyboardMaxHeight = uniIm.keyboardMaxHeight || 300\n      this.onKeyboardHeightChange = ({\n        height\n      }) => {\n        this.keyboardHeight = height\n        // console.log('height',height)\n        if (height > this.keyboardMaxHeight) {\n          this.keyboardMaxHeight = height\n        }\n        this.$nextTick(() => {\n          this.showLast();\n        });\n      }\n      // #ifdef H5\n      const oldWindowHeight = window.innerHeight;\n      window.onresize = ()=>{\n        this.onKeyboardHeightChange({\"height\": oldWindowHeight - window.innerHeight})\n      }\n      // #endif\n      // #ifndef H5\n      // 监听键盘高度变化显示最后一条消息\n      uni.onKeyboardHeightChange(this.onKeyboardHeightChange);\n      // #endif\n    },\n    mounted() {\n      // #ifdef H5\n      if(this.isWidescreen){\n        // 以下为实现拖拽或粘贴图片至聊天页面，直接发送的逻辑\n        const chatBodyDom = document.getElementById(\"uni-im-chat\")\n        // 阻止默认事件\n        chatBodyDom.addEventListener(\n          'dragover',\n          function(event) {\n            event.preventDefault();\n          },\n          false\n        );\n        // 拖拽结束时触发\n        chatBodyDom.addEventListener(\n          'drop',\n          e => {\n            //取消默认浏览器拖拽效果\n            e.preventDefault();\n            //获取文件对象\n            let fileList = e.dataTransfer.files;\n            if (fileList.length == 0) {\n              return false;\n            }\n            const [file] = fileList\n            let fileType = file.type.split('/')[0] || 'file'\n            if (fileType === 'image') {\n              let blobUrl = window.URL.createObjectURL(file);\n              if(this.chatInputContent === ''){\n                this.$refs[\"chat-input\"].setContent({html:`<img src=\"${blobUrl}\" />`})\n              }else{\n                this.$refs[\"chat-input\"].addHtmlToCursor(`<img src=\"${blobUrl}\" />`)\n              }\n              return false; // 拖拽图片内容进入输入框先不发送\n            }\n            // 其他文件类型，直接发送\n            let {\n              name,\n              size\n            } = file\n            // console.log(78979798,fileList);\n            const blobUrl = window.URL.createObjectURL(file);\n            this.uploadFileAndSendMsg({\n                tempFiles:[{\n                  size,\n                  name,\n                  path:blobUrl,\n                  fileType\n                }]\n            })\n          },\n          false\n        );\n        const chatInput = document.querySelector('.pc .uni-im-editor');\n        chatInput.addEventListener('keydown',async e => {\n          this.$refs['member-list'].onChatInputKeydown(e)\n        })\n      }\n      // #endif\n    },\n    onShow() {\n      // TODO:解决 previewImage 误触发onShow的问题\n      if(uniIm.ext._previewImageIsOpen){\n        return\n      }\n      if (this.conversation.id) {\n        // 用于打开会话窗口后，切换到后台，再切回时设置当前会话id。\n        uniIm.currentConversationId = this.conversation.id\n        // 用于从后台切到前台时，设置当前会话为已读\n        this.clearUnreadCount();\n        this.updateNavTitle()\n      }\n    },\n    onUnload() {\n      // console.log('onUnload');\n      \n      // 关闭监听消息推送事件\n      uniIm.offMsg(this.onImMsg);\n      \n      // #ifndef H5\n      uni.offKeyboardHeightChange(this.onKeyboardHeightChange)\n      // #endif\n      \n      //页面销毁之前销毁 全局变量 正在聊天的用户的id\n      uniIm.currentConversationId = ''\n      // console.log('beforeDestroy');\n      // 关闭sound播放\n      uniIm.audioContext.stop()\n    },\n    beforeDestroy() {\n      //页面销毁之前销毁 全局变量 正在聊天的用户的id\n      uniIm.currentConversationId = ''\n      // console.log('beforeDestroy');\n      // 关闭sound播放\n      uniIm.audioContext.stop()\n    },\n    onHide() {\n      // TODO:解决 previewImage 误触发onHide的问题\n      if(uniIm.ext._previewImageIsOpen){\n        return\n      }\n      uniIm.currentConversationId = ''\n      // 关闭sound播放\n      uniIm.audioContext.stop()\n    },\n    onLoad(param) {\n      for (const key in param) {\n        try{\n          param[key] = JSON.parse(param[key])\n        }catch(_){}\n      }\n      //调用load方法，因为pc宽屏时本页面是以组件形式展示。如$refs.chatView.loadconversation_id()执行\n      this.load(param)\n    },\n    onBackPress(e) {\n      // console.log('onBackPress',e);\n      const memberListRef = this.$refs['member-list']\n      if(memberListRef.isShow){\n        memberListRef.hide()\n        return true\n      }\n    },\n    watch: {\n      // 监听群昵称变化\n      'conversation.title'(){\n        this.updateNavTitle()\n      },\n      // 监听群成员数变化\n      'conversation.group.member_count'(){\n        this.updateNavTitle()\n      }\n    },\n    methods: {\n      async load(param) {\n\t\t\t\tawait Promise.all(uniIm.extensions.invokeExts('chat-load-before-extra', param))\n        this.answerMsg = false\n        if(this.conversation.id){\n          // 设置上一个会话的chatInputContent 实现多个会话之间的草稿功能\n          this.conversation.chatInputContent = this.chatInputContent\n        }\n\n        this.conversation = await uniIm.conversation.get(param)\n        // 初始化会话的chatInputContent\n        this.chatInputContent = this.conversation.chatInputContent\n        // this.conversation.remind_msg_ids = []\n        // console.log('this.conversation',this.conversation)\n        \n\n        //设置全局的app当前正在聊天的会话id（注：本页面可能是直达页）\n        uniIm.currentConversationId = this.conversation.id\n        setTimeout(() => {\n          this.$refs['msg-list'].init()\n        }, 0);\n\n        // console.log('this.conversation',this.conversation);\n        \n        //debug用模拟一次性自动发送100条数据\n        // for (var i = 0; i < 20; i++) {\n        // \tthis.chatInputContent = '这是第'+i+'条消息'\n        // \tthis.beforeSendMsg()\n        // }*/\n        \n        // 清除当前会话未读数\n        this.clearUnreadCount();\n        \n        // #ifdef H5\n        if(this.isWidescreen){\n          // 切换到新的会话后把输入焦点设置到输入框（考虑到可能有草稿文字，需延迟设置）\n          setTimeout(() => {\n            this.$refs[\"chat-input\"]?.focus()\n          }, 100)\n        }else{\n          const {is_temp,friend_uid} = this.conversation\n          if(is_temp && friend_uid){\n            // 为了避免在web端刷新页面之后，本地单聊临时会话丢失，将地址栏中的会话id参数替换为好友的uid，以此来确保在刷新页面之后，本地能够再次创建临时会话。\n            const {route:path,options} = getCurrentPages().pop()\n            delete options.conversation_id\n            options.user_id = friend_uid\n            let paramSrt\n            for (const key in options) {\n              paramSrt = `${key}=${options[key]}`\n            }\n            history.replaceState(null, '', `/#/${path}?${paramSrt}`)\n          }\n        }\n        // #endif\n      },\n      onclickMsgList(){\n\t\t\t\t// console.log('onclickMsgList');\n        this.$refs[\"chat-input\"]?.retract()\n        uni.hideKeyboard()\n      },\n      putChatInputContent(value){\n        this.$refs[\"chat-input\"]?.setContent(value)\n      },\n      uploadFileAndSendMsg({tempFiles}){\n        // console.log(res, 'image');\n        // console.log('this.uploadFileAndSendMsg res',res);\n        tempFiles.forEach(async tempFile => {\n          // console.log('tempFile~',tempFile);\n          const {\n            path:url,\n            name,\n            size\n          } = tempFile;\n          let {fileType} = tempFile\n          if (!['image', 'video'].includes(fileType)) {\n            fileType = 'file'\n          }\n          // console.log('fileType===>', fileType);\n          // console.error('tempFile~~~~~~~~~', tempFile,size/1000/1024+'mb');\n          const sizeMB = size/1000/1024\n          if(fileType == 'image' && sizeMB > 2){\n            return uni.showToast({\n              title: '图片大小不能超过2mb',\n              icon: 'none'\n            });\n          } else if(sizeMB > 100){\n            return uni.showToast({\n              title: '文件大小不能超过100mb',\n              icon: 'none'\n            });\n          }\n          \n          const data = {};\n          const fileInfo = {\n            url,\n            size,\n            name\n          };\n          if(fileType == 'image'){\n            const {width,height} = await uni.getImageInfo({src:url});\n            fileInfo.width = width\n            fileInfo.height = height\n          }\n          data[fileType] = fileInfo\n          let msg = await this.beforeSendMsg(data,false)\n          // console.log('~~~beforeSendMsg',msg);\n          const uploadFileFn = async ()=>{\n            const result = await uniCloud.uploadFile({\n              filePath: tempFile.path,\n              cloudPath: Date.now() + this.current_uid + '.' + name.split('.').pop(),\n            });\n            // console.log('result.fileID',result.fileID);\n            msg.body.url = result.fileID\n          }\n          try{\n            await uploadFileFn()\n            this.sendMsg(msg)\n          }catch(e){\n            console.error('uploadFile error:',e)\n            // 重发之前增加先上传图片的逻辑\n            msg.__beforeRetriesAction = uploadFileFn\n            msg.state = -200\n          }\n        });\n      },\n      async chooseFileSendMsg(type,_config={}) {\n        // console.log('type',type);\n        //先创建发送消息的\n        let objFn = {\n          'image':()=>{\n            uni.chooseImage({\n            \t// count:9,\n            \t// sourceType,\n            \t// extension,\n            \tsuccess:res=> beforeUploadFileAndSendMsg(res,'image'),\n            \t\"fail\":alertFail\n            });\n          },\n          'video':()=>{\n            uni.chooseVideo({\n              sourceType: ['camera', 'album'],\n              success:res=> beforeUploadFileAndSendMsg(res,'video'),\n              \"fail\":alertFail\n            });\n          },\n          'all':()=>{\n            let chooseFile = uni.chooseFile;\n            // #ifdef MP-WEIXIN\n            chooseFile = wx.chooseMedia;\n            // #endif\n            chooseFile({\n            \ttype: 'all',\n            \t// count:10,\n              sourceType:['album','camera'],\n            \t\"success\":this.uploadFileAndSendMsg,\n            \t\"fail\":alertFail\n            })\n          }\n        };\n        objFn[type]();\n        \n        const _this = this;\n        function beforeUploadFileAndSendMsg(res,fileType){\n          // console.log(111,res)\n          // 视频只能选择单文件，为了参数统一，这里转成数组\n          if(fileType == 'video'){\n            // #ifndef H5\n            res.tempFile = {\n              size: res.size,\n              width: res.width,\n              height: res.height\n            }\n            // #endif\n            res.tempFile.path = res.tempFilePath\n            res.tempFiles = [res.tempFile]\n          }\n          res.tempFiles.forEach(item=>{\n            //如果没有type，默认为：用户选择的类型\n            if(!item.fileType){\n              item.fileType = fileType\n            }\n            // 如果没有name，默认为：用户id+随机数+时间戳生成一个\n            if(!item.name){\n             item.name = _this.current_uid + Math.random().toString(36).substr(2) + Date.now()\n            }\n          })\n          // console.log(222,res)\n          _this.uploadFileAndSendMsg(res)\n        }\n        function alertFail(res){\n          console.error('res',res);\n          // uni.showModal({\n          //   content: JSON.stringify(res),\n          //   showCancel: false\n          // });\n        }\n        \n      },\n      sendSoundMsg(sound){\n        this.beforeSendMsg({sound})\n      },\n      onInput(e) {\n        // console.log('onInput',e.data);\n        // #ifndef MP\n        if(this.conversation.group_id && e.data == \"@\"){\n          // 非小程序的群聊才支持@功能\n          uni.hideKeyboard()\n          this.showMenberList({\n            confirm:userId=> {\n              this.setCallAboutUid(userId)\n            },\n            filter:member=>!this.getCallUid().includes(member.users._id)\n          })\n        }\n        // #endif\n        // 成员列表内实现：在被显示时，监听输入框的输入，以实现搜索功能等\n        this.$refs['member-list'].onChatInput(e)\n      },\n      intoTopic(msgId){\n        this.$refs['msg-list'].intoTopic(msgId)\n      },\n      async setAnswerMsg(msgId) {\n        this.answerMsg = this.conversation.msg.find(msgId)\n        this.$refs[\"chat-input\"]?.focus()\n        const {from_uid} = this.answerMsg\n        if (this.conversation.group && from_uid != this.current_uid) {\n          this.setCallAboutUid(from_uid,false)\n        }\n      },\n      async chatInputConfirm() {\n        const $mr = this.$refs['member-list']\n        if($mr.isShow && $mr.memberList.length){\n          console.log('正在执行选中要@的人，不发送数据')\n          return\n        }\n        if (typeof this.chatInputContent == 'object'){\n          // 富文本（图文混排、@某人）消息\n          const {data: htmlArray,uploadImg} = this.chatInputContent.getHtmlArray()\n          // 先插到消息列表\n          let msg = await this.beforeSendMsg({\n            \"rich-text\": htmlArray\n          },false)\n\t\t\t\t\t// 定义上传htmlArray中的图片的方法\n\t\t\t\t\tconst uploadHtmlArrayImgFn = async ()=> await uploadImg(msg.body)\n          try{\n            await uploadHtmlArrayImgFn()\n            // 执行发送\n            this.sendMsg(msg)\n          }catch(e){\n\t\t\t\t\t\tconsole.error('uploadImg error:',e)\n            // 重发之前增加先上传图片的逻辑\n            msg.__beforeRetriesAction = uploadHtmlArrayImgFn\n            msg.state = -200\n          }\n          \n        }else{\n          // 把this.chatInputContent中的&nbsp;变成空格，再把头尾的空格去掉\n          this.chatInputContent = this.chatInputContent.replace(/&nbsp;/g, ' ').trim()\n          // 普通消息\n          await this.beforeSendMsg()\n        }\n      },\n      showMenberList(){\n        this.$refs['member-list'].show(arguments[0])\n      },\n      async beforeSendMsg(param = {},_continue = true) {\n        console.log('beforeSendMsg',{param});\n        let msg = {\n          type: 'text',\n          to_uid: this.conversation.friend_uid,\n          conversation_id: this.conversation.id,\n          group_id: this.conversation.group_id,\n          client_create_time: Date.now(),\n          from_uid: this.current_uid,\n          state: 0,\n          body: this.chatInputContent,\n          // 接收消息的appId，默认为当前应用的appId。如果你是2个不同appId的应用相互发，请修改此值为相对的appId\n          appId: this.systemInfo.appId\n        }\n        // 根据传入的参数设置消息类型和内容\n        for (let key in param) {\n          if (param[key]) {\n            msg.type = key\n            msg.body = JSON.parse(JSON.stringify(param[key]))\n          }\n        }\n        // 如果是文本类型需要做一些处理\n        if (msg.type === 'text') {\n          //清除空格\n          msg.body = msg.body.trim();\n          // 阻止发送空消息\n          if (!msg.body.length) {\n            this.resetChatInput()\n            return uni.showToast({\n              title: '不能发送空消息',\n              icon: 'none'\n            });\n          }\n        }\n\n        //如果是回复某一条消息，需要带上相关id\n        if (this.answerMsg !== false) {\n          msg.about_msg_id = this.answerMsg._id\n        }\n\n        // 消息列表追加此消息。此时消息状态值为0，表示发送中\n        msg = this.conversation.msg.add(msg)\n        \n        // 代码在，弹出的代码输入框，无需清空消息输入框内容\n        if(msg.type !== 'code'){\n          this.resetChatInput()\n        }\n\n        this.$nextTick(() => {\n          this.showLast()\n        })\n        // console.error('sendMsg-sendMsg-sendMsg', msg);\n        // 存到本地数据库\n        // await this.conversation.msgManager.localMsg.add(msg)\n        // console.log('msg被localMsg.add引用 会新增一个unique_id',msg)\n        if(_continue){\n          this.sendMsg(msg);\n        }else{\n          return msg;\n        }\n      },\n      resetChatInput() {\n        this.chatInputContent = ''\n        // 关闭引用的消息\n        this.answerMsg = false\n      },\n      getCallUid(){\n        return this.chatInputContent?.aboutUserIds || []\n      },\n      sendMsg(msg, callback) {\n        \n        if(this.conversation.source){\n          msg.chat_source = this.conversation.source\n        }\n        \n        // console.log('sendMsg-sendMsg-sendMsg', msg);\n        const uniImCo = uniCloud.importObject('uni-im-co', {\n          customUI: true\n        });\n        \n        // 检查内容不是包含 个推 两个字，有则 改成 个 + 零宽字符 + 推\n        let tmpBody = JSON.stringify(msg.body)\n        if(tmpBody.includes('个推')){\n          msg.body = JSON.parse(tmpBody.replace(/个推/g,'个\\u200b推'))\n        }\n        \n        uniImCo.sendMsg(msg)\n          .then(async e => {\n            // console.log('uniImCo.sendMsg',{e,msg});\n            msg.state = e.errCode === 0 ? 100 : -100\n            msg.create_time = e.data.create_time\n            msg._id = e.data._id\n          })\n          .catch(async e => {\n            uni.showModal({\n              content: e.message,\n              showCancel: false,\n              confirmText: '关闭',\n            });\n            console.error('uniImCo.sendMsg error:', e.errCode, e.message);\n            // todo:必须要有create_time的值，否则indexDB通过创建时间索引找不到数据。后续会优化这个问题\n            msg.state = -200,\n            msg.create_time = Date.now()\n          })\n          .finally(e => {\n            if (callback) {\n              callback(e);\n            }\n          });\n      },\n      async retriesSendMsg(msg) {\n        uni.showLoading({\n          mask: true\n        });\n         msg.state = 0\n        // 检查文件是否上传成功\n        if(msg.__beforeRetriesAction){\n          await msg.__beforeRetriesAction()\n        }\n        delete msg.__beforeRetriesAction\n        // console.log('retriesSendMsg', msg);\n        msg.isRetries = true\n        this.sendMsg(msg, e => {\n          uni.hideLoading();\n        });\n      },\n      showLast(duration = 300) {\n        let msgListRef = this.$refs['msg-list']\n        if (msgListRef) {\n          msgListRef.showLast(duration)\n        }\n      },\n      onLongpressMsgAvatar(user_id){\n        // 当前输入框已经@了的用户id 要过滤掉\n        let callUidList = this.getCallUid()\n        if(callUidList.includes(user_id)){\n          console.log('此用户id已经@过');\n          uni.showToast({\n            title: '此用户已经@过',\n            icon: 'none'\n          });\n        }else{\n          this.$refs['chat-input'].raiseEditor = true\n          this.$nextTick(()=>{\n            this.setCallAboutUid(user_id,false)\n          })\n        }\n      },\n      setCallAboutUid(user_id,needDeleteLeftART = true) {\n        // 拿到@之后为搜索用户的关键字长度，以便插入@的用户后删除关键字 (移动端搜索的关键词并不在消息输入栏)\n        const keywordLength = this.isWidescreen ? this.$refs['member-list'].keyword.length : 0\n        this.$refs['chat-input'].addCallUser({\n          user_id,\n          nickname: user_id == '__ALL' ? '所有人' : uniIm.users[user_id]?.nickname || '未知用户'\n        },needDeleteLeftART,keywordLength)\n      },\n      async showControl({\n        msgId,\n        msgContentDomInfo\n      }) {\n        const msg = this.conversation.msg.find(msgId)\n        let isSelf = msg.from_uid == this.current_uid\n        this.$refs['msg-popup-control'].show({isSelf,msg,msgContentDomInfo})\n      },\n      shareMsg(msgList,merge = false) {\n        console.error('msgList',msgList)\n        if (this.isWidescreen) {\n          this.$refs['share-msg'].open(msgList,merge)\n        } else {\n          uni.navigateTo({\n            url: '/uni_modules/uni-im/pages/share-msg/share-msg',\n            success: res => {\n              res.eventChannel.emit('shareMsg', [msgList,merge])\n            }\n          })\n        }\n        this.chooseMoreMsg = false\n      },\n      tapUnreadCount() {\n        //点击未读消息文字按钮事件\n        uni.navigateBack();\n      },\n      updateNavTitle(){\n        this.navTitle = this.conversation.title\n        const group_id = this.conversation?.group_id\n        if (group_id && group_id?.indexOf('__tmp') != 0) {\n          this.navTitle += `（${this.conversation.group.member_count}）`\n        }\n        if(this.navTitle && !this.isWidescreen){\n          uni.setNavigationBarTitle({\n          \ttitle: this.navTitle\n          });\n        }\n      },\n      clearUnreadCount(){\n        if ( this.conversation.unread_count > 0) {\n          this.conversation.clearUnreadCount();\n        }\n      }\n    },\n    onNavigationBarButtonTap(e) {\n      if (e.index === 0) {\n        if (this.conversation.group_id) {\n          uni.navigateTo({\n            url: \"/uni_modules/uni-im/pages/group/info?conversation_id=\" + this.conversation.id\n          })\n        } else {\n          // console.log(this.conversation,6565);\n          uni.navigateTo({\n            url: `/uni_modules/uni-im/pages/chat/info?user_id=${this.conversation.friend_uid}&conversation_id=${this.conversation.id}`\n          })\n          // uni.showToast({\n          // \ttitle: '仅群里可见，详细信息',\n          // \ticon: 'none'\n          // });\n        }\n      }\n      // uni.navigateBack();\n    }\n  };\n</script>\n\n<style lang=\"scss\">\n@import \"@/uni_modules/uni-im/common/baseStyle.scss\";\npage {\n  height: 100%;\n}\n.uni-im-chat {\n  position: relative;\n  height: 100%;\n  width: 100%;\n  flex: 1;\n  background-color: #efefef;\n  .msg-list {\n    /* height: 1px; 覆盖掉 组件内的height：100%，使得flex-grow: 1作用在容器内被撑开*/\n    height: 1px !important;\n    flex-grow: 1;\n  }\n  \n  .chat-foot,.disable-chat-foot{\n    position: relative;\n    flex-direction: column;\n    border-top: 1rpx solid #BBBBBB;\n    background-color: #F7F7F7;\n  }\n  \n  .disable-chat-foot{\n    padding: 20px;\n    text-align: center;\n    justify-content: center;\n    color: #777777;\n  }\n  \n  .answer-msg {\n    padding: 2px 10px;\n    background-color: #eee;\n    border-radius: 3px;\n    margin-bottom: 10px;\n    flex-direction: row;\n    align-items: center;\n    ::v-deep .uni-icons {\n      margin-left: 5px;\n    }\n    /* #ifdef H5 */\n    .close-icon{\n      cursor: pointer;\n    }\n    @media screen and (min-device-width:960px){\n      margin: 5px;\n      margin-bottom: -18px;\n      top: 0;\n    }\n    /* #endif */\n    .answer-msg-text {\n      width: 100%;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n      font-size: 12px;\n      color: #333;\n    }\n  }\n  \n  /* #ifdef H5 */\n  .vue-codemirror {\n    position: fixed;\n    top: 100px;\n    left: 50%;\n    width: 500px;\n  }\n  \n  /* #endif */\n  \n  /* #ifdef H5 */\n  .chat-foot {\n    border: none;\n  }\n  /* #endif */\n  \n  /* #ifdef H5 */\n  .unread_count {\n    position: absolute;\n    top: -30px;\n    left: 70rpx;\n    z-index: 10;\n    background-color: #dfe2e9;\n    padding: 0 14rpx;\n    height: 14px;\n    line-height: 14px;\n    border-radius: 9px;\n    color: #0c1013;\n    font-size: 12px;\n    margin-top: 3px;\n  }\n  /* #endif */\n}\n</style>","import MiniProgramPage from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/pages/chat/chat.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniIm","markRaw","uni","uniCloud","wx"],"mappings":"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"}