{"version":3,"file":"contacts.js","sources":["uni_modules/uni-im/pages/contacts/contacts.vue","uni_modules/uni-im/pages/contacts/contacts.vue?type=page"],"sourcesContent":["<template>\n\t<view @click=\"hiddenDeleteBtn\" class=\"contacts-pages\">\n\t\t<uni-list :border=\"false\" class=\"menu-list-box\" v-if=\"showMenu\">\n\t\t\t<uni-list-item v-for=\"(menu,menuIndex) in menuList\" :key=\"menuIndex\" :title=\"menu.title\" link\n\t\t\t\t@click=\"openPages(menu)\" :showBadge=\"true\" :class=\"{activeMenu:isOpenItemTitle === menu.title}\">\n\t\t\t\t<template v-slot:header>\n\t\t\t\t\t<view class=\"slot-icon-box green\">\n\t\t\t\t\t\t<image class=\"slot-icon\" :src=\"'/uni_modules/uni-im/static/noticeIcon/' + menu.srcName + '.png'\"\n\t\t\t\t\t\t\tmode=\"widthFix\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t</template>\n\t\t\t</uni-list-item>\n\t\t\t<uni-list-item v-for=\"(item,index) in noticeList\" :key=\"item.id\" :title=\"item.title\" :showBadge=\"true\"\n\t\t\t\t:badgeText=\"item.badge\" :badgeStyle=\"item.badgeStyle\" link @click=\"openPages(item)\" :border=\"false\"\n\t\t\t\t:class=\"{activeMenu:isOpenItemTitle === item.title}\">\n\t\t\t\t<template v-slot:header>\n\t\t\t\t\t<view class=\"slot-icon-box blue\">\n\t\t\t\t\t\t<image class=\"slot-icon\" :src=\"item.icon\" mode=\"widthFix\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t</template>\n\t\t\t</uni-list-item>\n\t\t</uni-list>\n\n\t\t<text class=\"title\">好友列表</text>\n\t\t<uni-list v-if=\"showUser\" :border=\"false\" class=\"user-list-box\" :scroll-y=\"true\">\n\t\t\t<uni-list-item v-for=\"(item, index) in friendList\" :key=\"item._id\" :customStyle=\"{padding:0}\"\n\t\t\t\tclass=\"user-list-item\">\n\t\t\t\t<template v-slot:body>\n\t\t\t\t\t<scroll-view scroll-x=\"true\" @scroll=\"scroll\" :scroll-left=\"activeIndex === index ?'':scrollLeft[index]\"\n\t\t\t\t\t\t:show-scrollbar=\"false\" :scroll-with-animation=\"true\" class=\"user-list-item-scroll-view\">\n\t\t\t\t\t\t<view class=\"user-list-item-scroll-view-item\" @click=\"toChat(item)\"\n\t\t\t\t\t\t\t@touchstart.passive=\"activeIndex = index\">\n\t\t\t\t\t\t\t<image class=\"avatar\"\n\t\t\t\t\t\t\t\t:src=\"item.avatar_file&&item.avatar_file.url ? item.avatar_file.url : '/uni_modules/uni-im/static/avatarUrl.png'\"\n\t\t\t\t\t\t\t\tmode=\"widthFix\"></image>\n\t\t\t\t\t\t\t<text class=\"username\">{{item.nickname}}</text>\n\t\t\t\t\t\t\t<button @click.stop=\"deleteItem(item,index,$event)\" class=\"delete-btn\" size=\"mini\"\n\t\t\t\t\t\t\t\ttype=\"warn\">删除</button>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</scroll-view>\n\t\t\t\t</template>\n\t\t\t</uni-list-item>\n\t\t\t<uni-list-item :customStyle=\"{padding:0,backgroundColor:'#FFFFFF'}\">\n\t\t\t\t<template v-slot:body>\n\t\t\t\t\t<uni-im-load-state :status=\"friendHasMore?'loading':'noMore'\"></uni-im-load-state>\n\t\t\t\t</template>\n\t\t\t</uni-list-item>\n\t\t</uni-list>\n\t</view>\n</template>\n\n<script>\n\timport uniIm from '@/uni_modules/uni-im/sdk/index.js';\n\tconst db = uniCloud.database()\n\texport default {\n\t\temits: ['clickMenu'],\n\t\tprops: {\n\t\t\t// pc端时会控制隐藏\n\t\t\tshowMenu: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: true\n\t\t\t},\n\t\t\t// pc端时会控制隐藏\n\t\t\tshowUser: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: true\n\t\t\t},\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tisOpenItemTitle: '',\n\t\t\t\tscrollLeft: {\n\t\t\t\t\t0: 0,\n\t\t\t\t\t1: 1\n\t\t\t\t},\n\t\t\t\tactiveIndex: false,\n\t\t\t\tmenuList: [{\n\t\t\t\t\t\ttitle: '加人/加群',\n\t\t\t\t\t\tpath: './addPeopleGroups/addPeopleGroups',\n\t\t\t\t\t\tsrcName: 'search'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: '群聊列表',\n\t\t\t\t\t\tpath: './groupList/groupList',\n\t\t\t\t\t\tsrcName: 'group'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: '创建群聊',\n\t\t\t\t\t\tpath: './createGroup/createGroup',\n\t\t\t\t\t\tsrcName: 'createGroup'\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\t//是否为pc宽屏（width>960px）\n\t\t\tisWidescreen() {\n\t\t\t\treturn uniIm.isWidescreen\n\t\t\t},\n\t\t\tfriendList() {\n\t\t\t\treturn uniIm.friend.dataList\n\t\t\t},\n\t\t\tfriendHasMore() {\n\t\t\t\treturn uniIm.friend.hasMore\n\t\t\t},\n\t\t\tnoticeList() {\n\t\t\t\treturn [{\n\t\t\t\t\t\ttitle: \"新朋友\",\n\t\t\t\t\t\tparam: {\n\t\t\t\t\t\t\ttype: ['uni-im-friend-invite']\n\t\t\t\t\t\t},\n\t\t\t\t\t\ticon: \"/uni_modules/uni-im/static/noticeIcon/newFriend.png\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: \"群通知\",\n\t\t\t\t\t\tparam: {\n\t\t\t\t\t\t\ttype: ['uni-im-group-join-request']\n\t\t\t\t\t\t},\n\t\t\t\t\t\ticon: \"/uni_modules/uni-im/static/noticeIcon/groupNotice.png\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: \"系统通知\",\n\t\t\t\t\t\tparam: {\n\t\t\t\t\t\t\texcludeType: ['uni-im-group-join-request', 'uni-im-friend-invite']\n\t\t\t\t\t\t},\n\t\t\t\t\t\ticon: \"/uni_modules/uni-im/static/noticeIcon/notification.png\"\n\t\t\t\t\t}\n\t\t\t\t].reduce((sum, item, index) => {\n\t\t\t\t\tlet {\n\t\t\t\t\t\tparam: filterNotice,\n\t\t\t\t\t\ttitle\n\t\t\t\t\t} = item,\n\t\t\t\t\tparam = {\n\t\t\t\t\t\tfilterNotice,\n\t\t\t\t\t\ttitle\n\t\t\t\t\t}\n\t\t\t\t\t// console.log('param----',param);\n\t\t\t\t\tsum.push({\n\t\t\t\t\t\ttitle: item.title,\n\t\t\t\t\t\tbadge: this.getUnreadCount(item.param),\n\t\t\t\t\t\tbadgeStyle: {\n\t\t\t\t\t\t\tbackgroundColor: '#d60000'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpath: \"./notification/notification?param=\" + encodeURIComponent(JSON.stringify(param)),\n\t\t\t\t\t\tparam,\n\t\t\t\t\t\ticon: item.icon,\n\t\t\t\t\t\tid: Date.now() + '-' + index\n\t\t\t\t\t})\n\t\t\t\t\treturn sum\n\t\t\t\t}, [])\n\t\t\t}\n\t\t},\n\t\tonPullDownRefresh() {\n\t\t\tthis.$refs.udb.loadData({\n\t\t\t\tclear: true\n\t\t\t}, () => {\n\t\t\t\tuni.stopPullDownRefresh()\n\t\t\t})\n\t\t},\n\t\tonReachBottom() {\n\t\t\t// this.$refs.udb.loadMore()\n\t\t},\n\t\tmounted() {},\n\t\tmethods: {\n\t\t\topenPages(item) {\n\t\t\t\tthis.isOpenItemTitle = item.title\n\t\t\t\t// #ifdef H5\n\t\t\t\tif (this.isWidescreen) {\n\t\t\t\t\tlet componentName = 'uni-im-' + item.path.split('/')[1],\n\t\t\t\t\t\tparam = item.param\n\t\t\t\t\treturn this.$emit('clickMenu', {\n\t\t\t\t\t\tcomponentName,\n\t\t\t\t\t\tparam,\n\t\t\t\t\t\ttitle: item.title\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\t// #endif\n\t\t\t\t// console.log('item',item);\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: item.path,\n\t\t\t\t\tfail: (e) => {\n\t\t\t\t\t\tconsole.error(e, item.path);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tgetUnreadCount(param) {\n\t\t\t\treturn uniIm.notification.unreadCount(param)\n\t\t\t},\n\t\t\ttoChat(item) {\n        uniIm.toChat({user_id: item._id})\n\t\t\t},\n\t\t\thiddenDeleteBtn() {\n\t\t\t\tthis.activeIndex = false\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tfor (let i in this.scrollLeft) {\n\t\t\t\t\t\tthis.$set(this.scrollLeft, i, 0)\n\t\t\t\t\t\t// this.scrollLeft[i] = 0\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tasync deleteItem(item, index, event) {\n\t\t\t\tuni.showModal({\n\t\t\t\t\ttitle: '确认要删除好友吗',\n\t\t\t\t\tcontent: '此操作不可撤销',\n\t\t\t\t\tshowCancel: true,\n\t\t\t\t\tcancelText: '取消',\n\t\t\t\t\tconfirmText: '确认',\n\t\t\t\t\tcomplete: async (e) => {\n\t\t\t\t\t\tif (e.confirm) {\n\t\t\t\t\t\t\tuni.showLoading({\n\t\t\t\t\t\t\t\tmask: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tawait db.collection('uni-im-friend').where({\n\t\t\t\t\t\t\t\tfriend_uid: item._id,\n\t\t\t\t\t\t\t\tuser_id: uniIm.currentUser._id\n\t\t\t\t\t\t\t}).remove()\n\t\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t\t// 收到push消息后会自动，将此用户从列表中移除\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.hiddenDeleteBtn()\n\t\t\t\tevent.stopPropagation()\n\t\t\t\tevent.preventDefault()\n\t\t\t},\n\t\t\tscroll(e) {\n\t\t\t\t// console.log(this.inMove);\n\t\t\t\tthis.$set(this.scrollLeft, this.activeIndex, e.detail.scrollLeft)\n\t\t\t\t// this.scrollLeft[this.activeIndex] = e.detail.scrollLeft\n\t\t\t\tfor (let i in this.scrollLeft) {\n\t\t\t\t\tif (i != this.activeIndex) {\n\t\t\t\t\t\tthis.$set(this.scrollLeft, i, 0)\n\t\t\t\t\t\t// this.scrollLeft[i] = 0\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\thandleItemClick(id) {\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: './detail?id=' + id\n\t\t\t\t})\n\t\t\t},\n\t\t\tfabClick() {\n\t\t\t\t// 打开新增页面\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: './add',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t// 监听新增数据成功后, 刷新当前页面数据\n\t\t\t\t\t\trefreshData: () => {\n\t\t\t\t\t\t\tthis.$refs.udb.loadData({\n\t\t\t\t\t\t\t\tclear: true\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n@import \"@/uni_modules/uni-im/common/baseStyle.scss\";\n.contacts-pages {\n  height: 100%;\n  background-color: #FFF;\n  position: relative;\n  \n  .menu-list-box {\n    .uni-list-item {\n      cursor: pointer;\n      &:hover {\n        background-color: #FBFBFB !important;\n      }\n    }\n  }\n  \n  .title {\n    padding: 8px;\n    font-size: 14px;\n  }\n  \n  .user-list-box {\n    flex: 1;\n  }\n  \n  .user-list-item {\n    padding: 0;\n  }\n  \n  .user-list-item-scroll-view {\n    width: 750rpx;\n    background-color: #ffffff;\n  }\n  \n  .user-list-item-scroll-view-item {\n    width: 880rpx;\n    position: relative;\n    height: 60px;\n    align-items: center;\n    padding: 8px 15px;\n    flex-direction: row;\n    border-bottom: 1px solid #f0f0f0;\n  }\n  \n  .avatar {\n    background-color: #fefefe;\n    width: 40px;\n    height: 40px;\n    border-radius: 5px;\n  }\n  \n  .username {\n    line-height: 30px;\n    margin-left: 30rpx;\n    font-size: 16px;\n  }\n  \n  .delete-btn {\n    border-radius: 0;\n    position: absolute;\n    right: 0;\n    top: 0;\n    height: 60px;\n    line-height: 60px;\n    width: 130rpx;\n    font-size: 26rpx;\n    padding: 0;\n  }\n  \n  .slot-icon-box {\n    width: 45px;\n    height: 45px;\n    align-items: center;\n    justify-content: center;\n    border-radius: 10rpx;\n    margin-right: 20rpx;\n  }\n  \n  .slot-icon {\n    width: 25px;\n    height: 25px;\n  }\n  \n  .warn {\n    background-color: #FA9E3B;\n  }\n  \n  .green {\n    background-color: #08C060;\n  }\n  \n  .blue {\n    background-color: #5DBAFF;\n  }\n}\n</style>","import MiniProgramPage from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/pages/contacts/contacts.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uniIm","uni"],"mappings":"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"}