{"version":3,"file":"uni-im-member-list.js","sources":["uni_modules/uni-im/components/uni-im-member-list/uni-im-member-list.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-member-list/uni-im-member-list.vue?type=component"],"sourcesContent":["<template>\n  <view v-if=\"isShow && ((isWidescreen && !forceShowSearch) ? memberList.length != 0 : 1)\" class=\"member-list-box\">\n    <view class=\"member-list-mark\" @click.stop=\"hide()\"></view>\n    <view class=\"content\">\n      <view class=\"head\">\n        <view class=\"close\">\n          <uni-icons @click=\"hide()\" type=\"back\" color=\"#000\" size=\"12px\"></uni-icons>\n        </view>\n        <text class=\"title\">{{title}}</text>\n      </view>\n      <uni-search-bar v-if=\"!isWidescreen || forceShowSearch\" v-model=\"keyword\" :focus=\"true\" placeholder=\"搜索\" cancelButton=\"none\" class=\"search\" />\n      <scroll-view class=\"member-list\" :scroll-y=\"true\" :scroll-top=\"scrollTop\" :show-scrollbar=\"true\">\n        <view v-for=\"(item,index) in memberList\" :key=\"item._id\" class=\"member-list-item\"\n          :class=\"{'member-list-item-active':activeUid == item.users._id}\" @mouseover=\"activeUid = item.users._id\"\n          @click=\"confirm(item.users._id)\" :id=\"'a'+item.users._id\">\n          <text class=\"nickname\">{{item.users.nickname}}</text>\n          <text class=\"real_name\">{{item.users.real_name}}</text>\n        </view>\n        <view class=\"null-about-menber-tip\" v-if=\"memberList.length === 0\">没有与\"{{keyword}}\"相关成员</view>\n      </scroll-view>\n    </view>\n  </view>\n</template>\n\n<script>\n  import uniIm from '@/uni_modules/uni-im/sdk/index.js';\n  let confirmFunc = () => {}\n  export default {\n    props: {\n      conversationId: {\n        default: ''\n      },\n      memberListData: {\n        type: [Array,null],\n        default: null\n      }\n    },\n    computed: {\n      ...uniIm.mapState(['isWidescreen']),\n      memberList() {\n        let memberList = []\n        if(this.memberListData){\n          memberList = this.memberListData\n        }else{\n          memberList = uniIm.conversation.find(this.conversationId)?.group?.member.dataList || []\n        }\n        if (this.mapFn) {\n          memberList = memberList.map(this.mapFn)\n        }\n        if (this.filterFn) {\n          memberList = memberList.filter(this.filterFn)\n        }\n        if (this.keyword) {\n          memberList = memberList.filter(item => item.users.nickname.toLowerCase().includes(this.keyword.toLowerCase()))\n        }\n        // 按昵称排序\n        memberList.sort((a, b) => {\n          return a.users.nickname.localeCompare(b.users.nickname)\n        })\n        this.activeUid = memberList[0]?.users._id\n        return memberList\n      },\n    },\n    data() {\n      return {\n        isShow: false,\n        scrollTop: 0,\n        activeUid: '',\n        filterFn: null,\n        mapFn: null,\n        title: '',\n        keyword: '',\n        forceShowSearch: false\n      }\n    },\n    methods: {\n      confirm(uid) {\n        confirmFunc(uid)\n        this.hide()\n      },\n      onChatInput(e){\n        const enterText = e.data\n        if (!this.isShow) return\n        // console.log('enterText',enterText)\n        if(enterText == null){\n          // 敲了删除键\n          this.keyword = this.keyword.slice(0,-1)\n        }\n        else if(enterText == '@'){\n          this.keyword = \"\"\n        }else{\n          setTimeout(()=>{\n            // 输入法正在输入中\n            let isComposing = false\n            // #ifdef H5\n            isComposing = this.isWidescreen ? document.querySelector('.uni-im-editor').isComposing : e.isComposing\n            // #endif\n            if (isComposing) {\n              console.log('输入法正在输入中')\n            }else{\n              // console.log('enterText')\n              this.keyword += enterText\n            }\n          },0)\n        }\n      },\n      onChatInputKeydown(e) {\n        if (!this.isShow) return\n        if(e.key == 'Enter'){\n          if(this.memberList.length){\n            // console.log('选中要@的人')\n            this.confirm(this.activeUid)\n          }\n        }else if([\"ArrowUp\", \"ArrowDown\"].includes(e.key)){\n          // console.log('上下箭头选择@谁')\n          let index = this.memberList.findIndex(i => i.users._id == this.activeUid)\n          // console.log('index',index);\n          if (e.key == \"ArrowUp\") {\n            index--\n          } else {\n            index++\n          }\n          if (index < 0 || index > this.memberList.length - 1) {\n            index = 0\n          }\n          this.activeUid = this.memberList[index].users._id\n          // 防止选中的成员看不到，触发滚动\n          this.scrollTop = (index - 3) * 45\n          // console.log('this.scrollTop',this.scrollTop);\n          e.preventDefault();\n        }else if([\"ArrowLeft\", \"ArrowRight\"].includes(e.key)){\n          this.hide()\n        }else if(e.key == 'Backspace'){\n          setTimeout(() => {\n            // 获取e.target 元素内不包含在标签内的文字内容\n            let newValue = e.target.innerText\n            // console.log('删除键',newValue,this.oldChatInputValue);\n            // 拿到newValue 和 this.oldChatInputValue 中 包含的@字符的个数\n            let newAtN = newValue.replace(/[^@]/g, \"\").length\n            let oldAtN = this.oldChatInputValue?.replace(/[^@]/g, \"\")?.length || 0\n            if(newAtN === 0 || newAtN < oldAtN){\n              // console.log('删除了@成员的昵称');\n              this.hide()\n            }\n            this.oldChatInputValue = newValue\n          }, 0);\n        }\n      },\n      show({confirm,...param}) {\n        if(this.isShow){\n          return console.log('已经显示了')\n        }\n        // console.log('show',param, confirm)\n        // 默认选中第一个\n        // console.log('this.memberList[0]',this.memberList[0])\n        this.isShow = true\n        if (confirm) {\n          confirmFunc = confirm\n        }\n        this.keyword = ''\n        this.filterFn = param.filter\n        this.mapFn = param.map\n        this.title = param.title || '选择提醒的人'\n        this.forceShowSearch = param.forceShowSearch\n      },\n      hide() {\n        this.keyword = ''\n        this.isShow = false\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\">\n.member-list-box {\n  .content {\n    position: fixed;\n    width: 750rpx;\n    height: 80vh;\n    bottom: 0;\n    z-index: 999;\n    background-color: #ffffff;\n    border-radius: 15px 15px 0 0;\n    box-shadow: 0 0 100px rgba(0, 0, 0, 0.2);\n    /* #ifdef H5 */\n    @media screen and (min-device-width:960px){\n      border-radius: 15px;\n      max-height: 300px;\n      width: unset;\n      min-width: 260px;\n      left: auto;\n      right: calc(50vw - 300px);\n      bottom: 300px;\n    }\n    /* #endif */\n    .head{\n      flex-direction: row;\n      position: relative;\n      .close {\n        position: absolute;\n        left: 5px;\n        background-color: #eee;\n        height: 18px;\n        width: 18px;\n        margin: 12px;\n        transform: rotate(270deg);\n        border-radius: 50%;\n        justify-content: center;\n        align-items: center;\n        /* #ifdef H5 */\n        cursor: pointer;\n        z-index: 1;\n        /* #endif */\n      }\n      .title {\n        flex: 1;\n        text-align: center;\n        margin-top: 10px;\n        font-size: 14px;\n        color: #000;\n      }\n    }\n    .search {\n       ::v-deep .uni-searchbar__box {\n        margin: 0;\n        height: 30px;\n        .uni-searchbar__box-icon-search {\n          padding: 0 5px;\n        }\n        .uni-searchbar__text-placeholder {\n          // font-size: 12px;\n        }\n      }\n    }\n    .member-list {\n      height: 0;\n      flex-grow: 1;\n      padding: 10px;\n      .member-list-item {\n        overflow: hidden;\n        height: 40px;\n        width: 100%;\n        font-size: 14px;\n        line-height: 40px;\n        padding:0 15px;\n        border-radius: 10px;\n        margin-bottom: 10px;\n        text-align: left;\n        flex-direction: row;\n        /* #ifdef H5 */\n        @media screen and (min-device-width:960px){\n          margin:0;\n          margin-bottom: 5px;\n          cursor: pointer;\n        }\n        /* #endif */\n        .real_name {\n          margin-left: 10px;\n          font-size: 12px;\n          color: #666;\n        }\n      }\n      .member-list-item-active {\n        background-color: #efefef;\n      }\n      .null-about-menber-tip {\n        color: #666;\n        font-size: 12px;\n        align-items: center;\n        justify-content: center;\n        height: 100px;\n      }\n    }\n  }\n  .member-list-mark {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 750rpx;\n    flex: 1;\n    width: 100vw;\n    height: 100vh;\n    z-index: 999;\n  }\n}\n</style>\n","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-member-list/uni-im-member-list.vue'\nwx.createComponent(Component)"],"names":["uniIm","uni"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BE,IAAI,cAAc,MAAM;AAAC;AACzB,MAAK,YAAU;AAAA,EACb,OAAO;AAAA,IACL,gBAAgB;AAAA,MACd,SAAS;AAAA,IACV;AAAA,IACD,gBAAgB;AAAA,MACd,MAAM,CAAC,OAAM,IAAI;AAAA,MACjB,SAAS;AAAA,IACX;AAAA,EACD;AAAA,EACD,UAAU,iCACLA,kCAAM,SAAS,CAAC,cAAc,CAAC,IAD1B;AAAA,IAER,aAAa;;AACX,UAAI,aAAa,CAAC;AAClB,UAAG,KAAK,gBAAe;AACrB,qBAAa,KAAK;AAAA,aACf;AACH,uBAAaA,uCAAAA,MAAM,aAAa,KAAK,KAAK,cAAc,MAA3CA,mBAA8C,UAA9CA,mBAAqD,OAAO,aAAY,CAAC;AAAA,MACxF;AACA,UAAI,KAAK,OAAO;AACd,qBAAa,WAAW,IAAI,KAAK,KAAK;AAAA,MACxC;AACA,UAAI,KAAK,UAAU;AACjB,qBAAa,WAAW,OAAO,KAAK,QAAQ;AAAA,MAC9C;AACA,UAAI,KAAK,SAAS;AAChB,qBAAa,WAAW,OAAO,UAAQ,KAAK,MAAM,SAAS,YAAW,EAAG,SAAS,KAAK,QAAQ,YAAa,CAAA,CAAC;AAAA,MAC/G;AAEA,iBAAW,KAAK,CAAC,GAAG,MAAM;AACxB,eAAO,EAAE,MAAM,SAAS,cAAc,EAAE,MAAM,QAAQ;AAAA,OACvD;AACD,WAAK,aAAY,gBAAW,CAAC,MAAZ,mBAAe,MAAM;AACtC,aAAO;AAAA,IACR;AAAA,EACF;AAAA,EACD,OAAO;AACL,WAAO;AAAA,MACL,QAAQ;AAAA,MACR,WAAW;AAAA,MACX,WAAW;AAAA,MACX,UAAU;AAAA,MACV,OAAO;AAAA,MACP,OAAO;AAAA,MACP,SAAS;AAAA,MACT,iBAAiB;AAAA,IACnB;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACP,QAAQ,KAAK;AACX,kBAAY,GAAG;AACf,WAAK,KAAK;AAAA,IACX;AAAA,IACD,YAAY,GAAE;AACZ,YAAM,YAAY,EAAE;AACpB,UAAI,CAAC,KAAK;AAAQ;AAElB,UAAG,aAAa,MAAK;AAEnB,aAAK,UAAU,KAAK,QAAQ,MAAM,GAAE,EAAE;AAAA,MACxC,WACQ,aAAa,KAAI;AACvB,aAAK,UAAU;AAAA,aACZ;AACH,mBAAW,MAAI;AAQR;AAEH,iBAAK,WAAW;AAAA,UAClB;AAAA,QACD,GAAC,CAAC;AAAA,MACL;AAAA,IACD;AAAA,IACD,mBAAmB,GAAG;AACpB,UAAI,CAAC,KAAK;AAAQ;AAClB,UAAG,EAAE,OAAO,SAAQ;AAClB,YAAG,KAAK,WAAW,QAAO;AAExB,eAAK,QAAQ,KAAK,SAAS;AAAA,QAC7B;AAAA,iBACO,CAAC,WAAW,WAAW,EAAE,SAAS,EAAE,GAAG,GAAE;AAEhD,YAAI,QAAQ,KAAK,WAAW,UAAU,OAAK,EAAE,MAAM,OAAO,KAAK,SAAS;AAExE,YAAI,EAAE,OAAO,WAAW;AACtB;AAAA,eACK;AACL;AAAA,QACF;AACA,YAAI,QAAQ,KAAK,QAAQ,KAAK,WAAW,SAAS,GAAG;AACnD,kBAAQ;AAAA,QACV;AACA,aAAK,YAAY,KAAK,WAAW,KAAK,EAAE,MAAM;AAE9C,aAAK,aAAa,QAAQ,KAAK;AAE/B,UAAE,eAAc;AAAA,iBACT,CAAC,aAAa,YAAY,EAAE,SAAS,EAAE,GAAG,GAAE;AACnD,aAAK,KAAK;AAAA,iBACH,EAAE,OAAO,aAAY;AAC5B,mBAAW,MAAM;;AAEf,cAAI,WAAW,EAAE,OAAO;AAGxB,cAAI,SAAS,SAAS,QAAQ,SAAS,EAAE,EAAE;AAC3C,cAAI,WAAS,gBAAK,sBAAL,mBAAwB,QAAQ,SAAS,QAAzC,mBAA8C,WAAU;AACrE,cAAG,WAAW,KAAK,SAAS,QAAO;AAEjC,iBAAK,KAAK;AAAA,UACZ;AACA,eAAK,oBAAoB;AAAA,QAC1B,GAAE,CAAC;AAAA,MACN;AAAA,IACD;AAAA,IACD,KAAK,IAAoB;AAApB,mBAAC,cAAD,IAAY,kBAAZ,IAAY,CAAX;AACJ,UAAG,KAAK,QAAO;AACb,eAAOC,cAAA,MAAA,MAAA,OAAA,kFAAY,OAAO;AAAA,MAC5B;AAIA,WAAK,SAAS;AACd,UAAI,SAAS;AACX,sBAAc;AAAA,MAChB;AACA,WAAK,UAAU;AACf,WAAK,WAAW,MAAM;AACtB,WAAK,QAAQ,MAAM;AACnB,WAAK,QAAQ,MAAM,SAAS;AAC5B,WAAK,kBAAkB,MAAM;AAAA,IAC9B;AAAA,IACD,OAAO;AACL,WAAK,UAAU;AACf,WAAK,SAAS;AAAA,IAChB;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzKF,GAAG,gBAAgB,SAAS;"}