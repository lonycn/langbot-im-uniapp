{"version":3,"file":"order.js","sources":["uni_modules/uni-im/components/uni-im-msg/types/order.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg/types/order.vue?type=component"],"sourcesContent":["<template>\n  <view class=\"msg-order\">\n    <text class=\"title\">订单信息</text>\n    <view class=\"item\">\n      <text class=\"title\">订单编号：</text>\n      <text :selectable=\"true\" class=\"value\">{{orderInfo.order_id}}</text>\n    </view>\n    <view class=\"item\">\n      <text class=\"title\">产品/服务名称：</text>\n      <text class=\"value\">{{orderInfo.product.name}}</text>\n    </view>\n    <view class=\"item\">\n      <text class=\"title\">订单价格：</text>\n      <text class=\"value\">{{orderInfo.product.price}}元</text>\n    </view>\n    <view class=\"item\">\n      <text class=\"title\">所属用户：</text>\n      <text class=\"value\">{{nickName}}</text>\n    </view>\n    \n    <view class=\"item\">\n      <text class=\"title\">订单状态：</text>\n      <text class=\"value\">{{status}}</text>\n    </view>\n    <template v-if=\"orderInfo.status === 1\">\n      <view class=\"item\">\n        <text class=\"title\">支付时间：</text>\n        <text class=\"value\">{{new Date(orderInfo.pay_time).toLocaleString()}}</text>\n      </view>\n      <view class=\"item\">\n        <text class=\"title\">支付渠道：</text>\n        <text class=\"value\">{{orderInfo.pay_channel}}</text>\n      </view>\n    </template>\n\t\t<view class=\"btns\" v-else-if=\"isMineOrder && (!isExpired || !isExpired2)\">\n\t\t\t<button class=\"btn\" type=\"primary\" @click=\"toPay\" :disabled=\"isExpired\">在线支付</button>\n\t\t\t<text class=\"tip\">在线支付，需在 {{new Date(orderInfo.expire_time).toLocaleString()}} 前完成</text>\n\t\t\t\n\t\t\t<button class=\"btn\" type=\"primary\" @click=\"toPay\" :disabled=\"isExpired2\">对公打款</button>\n\t\t\t<text class=\"tip\">对公打款，需在 {{new Date(msg.create_time + 3600 * 24 * 7 * 1000).toLocaleString()}} 前完成</text>\n\t\t</view>\n  </view>\n</template>\n\n<script>\n  import uniIm from '@/uni_modules/uni-im/sdk/index.js';\n  export default {\n    props: {\n      msg: {\n        type: Object,\n        default: () => {\n          return {}\n        }\n      }\n    },\n    computed: {\n      orderInfo() {\n        return this.msg.body\n      },\n      nickName() {\n        return uniIm.users.find(this.orderInfo.user_id)[0]?.nickname || '未知'\n      },\n      isExpired() {\n        let now = Date.now() + uniIm.heartbeat * 0\n        return now > this.orderInfo.expire_time\n      },\n\t\t\t// 对公打款，是否过期\n\t\t\tisExpired2() {\n\t\t\t\tlet now = Date.now() + uniIm.heartbeat * 0\n\t\t\t\treturn now > this.msg.create_time + 3600 * 24 * 7 * 1000\n\t\t\t},\n      isMineOrder() {\n        // console.log('isMineOrder',this.orderInfo.user_id,uniIm.currentUser._id)\n        return this.orderInfo.user_id == uniIm.currentUser._id\n      },\n      status() {\n        if(this.orderInfo.status == 1) {\n          return '已支付'\n        }\n        if(this.isExpired && this.isExpired2) {\n          return '已过期'\n        }\n        if(this.orderInfo.status == 0) {\n          return '待支付'\n        }\n        return '待支付'\n      }\n    },\n    data() {\n      return {\n        \n      }\n    },\n    methods: {\n      async toPay() {\n        const uniIdSpaceConfig = {\n          provider: 'private',\n          spaceName: 'uni-id-server',\n          spaceId: 'uni-id-server',\n          clientSecret: 'ba461799-fde8-429f-8cc4-4b6d306e2339',\n          endpoint: 'https://account.dcloud.net.cn'\n        }\n        const uniIdCenterEnv = uniCloud.init(uniIdSpaceConfig)\n        const uniIdCenterObj = uniIdCenterEnv.importObject('uni-id-co')\n        \n        let oauthToken;\n        try {\n          let res = await uniIdCenterObj.getOauthToken()\n          console.log('getOauthToken',res)\n          oauthToken = res.data.access_token\n        } catch (e) {\n          return uni.showModal({\n            content: JSON.stringify(e),\n            showCancel: false\n          });\n        }\n          \n        const url = `https://dev.dcloud.net.cn/pages/common/pay?return_url=`\n        + encodeURIComponent('/uni_modules/uni-trade/pages/order-payment/order-payment?order_id='+this.orderInfo.order_id)\n        + '&oauthToken=' + oauthToken\n        console.log('url',url)\n        uniIm.utils.openURL(url)\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\">\n.msg-order {\n  background-color: #FFF;\n  border-radius: 10px;\n  padding: 25px;\n  max-width:100%;\n  & > .title {\n    font-size: 18px;\n    font-weight: bold;\n  }\n  .item {\n    flex-direction: row;\n    justify-content: start;\n    margin-top: 10px;\n    .title {\n      color: #666;\n      // 不换行\n      white-space: nowrap;\n    }\n    .value {\n      color: #333;\n      font-size: 14px;\n      // 换行\n      white-space: pre-wrap;\n      word-break: break-all;\n    }\n  }\n  .tip {\n    font-size: 14px;\n    color: #666;\n    margin-top: 10px;\n  }\n  .btn {\n    margin-top: 20px;\n    height: 36px;\n    line-height: 36px;\n    padding: 0;\n  }\n}\n</style>\n","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg/types/order.vue'\nwx.createComponent(Component)"],"names":["uniIm","uniCloud","uni"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AA8CE,MAAK,YAAU;AAAA,EACb,OAAO;AAAA,IACL,KAAK;AAAA,MACH,MAAM;AAAA,MACN,SAAS,MAAM;AACb,eAAO,CAAC;AAAA,MACV;AAAA,IACF;AAAA,EACD;AAAA,EACD,UAAU;AAAA,IACR,YAAY;AACV,aAAO,KAAK,IAAI;AAAA,IACjB;AAAA,IACD,WAAW;;AACT,eAAOA,iCAAK,MAAC,MAAM,KAAK,KAAK,UAAU,OAAO,EAAE,CAAC,MAA1CA,mBAA6C,aAAY;AAAA,IACjE;AAAA,IACD,YAAY;AACV,UAAI,MAAM,KAAK,IAAI,IAAIA,4BAAK,MAAC,YAAY;AACzC,aAAO,MAAM,KAAK,UAAU;AAAA,IAC7B;AAAA;AAAA,IAEJ,aAAa;AACZ,UAAI,MAAM,KAAK,IAAI,IAAIA,4BAAK,MAAC,YAAY;AACzC,aAAO,MAAM,KAAK,IAAI,cAAc,OAAO,KAAK,IAAI;AAAA,IACpD;AAAA,IACE,cAAc;AAEZ,aAAO,KAAK,UAAU,WAAWA,4BAAK,MAAC,YAAY;AAAA,IACpD;AAAA,IACD,SAAS;AACP,UAAG,KAAK,UAAU,UAAU,GAAG;AAC7B,eAAO;AAAA,MACT;AACA,UAAG,KAAK,aAAa,KAAK,YAAY;AACpC,eAAO;AAAA,MACT;AACA,UAAG,KAAK,UAAU,UAAU,GAAG;AAC7B,eAAO;AAAA,MACT;AACA,aAAO;AAAA,IACT;AAAA,EACD;AAAA,EACD,OAAO;AACL,WAAO,CAEP;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACD,QAAQ;AAAA;AACZ,cAAM,mBAAmB;AAAA,UACvB,UAAU;AAAA,UACV,WAAW;AAAA,UACX,SAAS;AAAA,UACT,cAAc;AAAA,UACd,UAAU;AAAA,QACZ;AACA,cAAM,iBAAiBC,cAAAA,GAAS,KAAK,gBAAgB;AACrD,cAAM,iBAAiB,eAAe,aAAa,WAAW;AAE9D,YAAI;AACJ,YAAI;AACF,cAAI,MAAM,MAAM,eAAe,cAAc;AAC7CC,wBAAAA,MAAA,MAAA,OAAA,mEAAY,iBAAgB,GAAG;AAC/B,uBAAa,IAAI,KAAK;AAAA,QACxB,SAAS,GAAG;AACV,iBAAOA,cAAAA,MAAI,UAAU;AAAA,YACnB,SAAS,KAAK,UAAU,CAAC;AAAA,YACzB,YAAY;AAAA,UACd,CAAC;AAAA,QACH;AAEA,cAAM,MAAM,2DACV,mBAAmB,uEAAqE,KAAK,UAAU,QAAQ,IAC/G,iBAAiB;AACnBA,sBAAAA,MAAA,MAAA,OAAA,mEAAY,OAAM,GAAG;AACrBF,0CAAM,MAAM,QAAQ,GAAG;AAAA,MACzB;AAAA;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;AC3HF,GAAG,gBAAgB,SAAS;"}