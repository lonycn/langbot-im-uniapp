{"version":3,"file":"video.js","sources":["uni_modules/uni-im/components/uni-im-msg/types/video.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg/types/video.vue?type=component"],"sourcesContent":["<template>\r\n  <view class=\"video-box\" @click=\"playVideo\">\n    <image class=\"video-img\" mode=\"aspectFill\" :src=\"videoPoster\" />\n    <view class=\"video-box-mark\" />\r\n    <uni-im-icons code=\"e650\" size=\"35\" color=\"#FFF\" class=\"play-video-icon\" />\r\n  </view>\r\n</template>\r\n\r\n<script>\n  import uniIm from '@/uni_modules/uni-im/sdk/index.js';\n  import config from '@/uni_modules/uni-im/common/config.js';\n  export default {\n    props: {\n      msg: {\n        type: Object,\n        default () {\n          return {\n            body: \"\"\n          }\n        }\n      },\n    },\r\n    data() {\r\n      return {\r\n        videoPoster: '', //视频封面\n        videoUrl: '', //视频地址\r\n      }\r\n    },\n    watch: {\n      'msg.body': {\n        async handler(msgBody) {\n          this.videoUrl = await uniIm.utils.getTempFileURL(this.msg.body.url)\n          //设置videoPoster\n          if (this.videoUrl.indexOf('blob:') === 0) {\n            // #ifdef H5\n            try {\n              let videoEl = document.createElement(\"video\");\n              videoEl.src = this.videoUrl\n              videoEl.currentTime = 1\n              let canvasEl = document.createElement(\"canvas\");\n              let context = canvasEl.getContext(\"2d\");\n              // console.log('videoEl',videoEl);\n              videoEl.addEventListener('loadeddata', () => {\n                canvasEl.width = videoEl.videoWidth;\n                canvasEl.height = videoEl.videoHeight;\n                context.drawImage(videoEl, 0, 0, canvasEl.width, canvasEl.height);\n                let firstFrameUrl = canvasEl.toDataURL();\n                // console.log('firstFrameUrl',firstFrameUrl);\n                this.videoPoster = firstFrameUrl\n              });\n            } catch (e) {\n              console.error('浏览器环境，获取本地视频封面失败。将使用默认图片', e)\n              this.videoPoster = '/uni_modules/uni-im/static/msg/video-uploading.gif'\n            }\n            // #endif\n             \n            // #ifndef H5\n            this.videoPoster = '/uni_modules/uni-im/static/msg/video-uploading.gif'\n            // #endif\n          }else{\n            // 如果链接带?号则加&否则加?\n            this.videoPoster = this.videoUrl + (this.videoUrl.indexOf('?') > -1 ? '&' : '?')\n            // 根据文件存储的服务商，传不同的参数获取视频封面\n            const paramObj = {\n              aliyun: 'x-oss-process=video/snapshot,t_0,f_jpg,w_200,m_fast,ar_auto',\n              tencent: 'imageView2/0/w/200',\n              qiniu: 'vframe/jpg/offset/0/w/200'\n            }\n            this.videoPoster += paramObj[config.cloudFile.provider]\n            // console.log('this.videoPoster',this.videoPoster);\n          }\n        },\n        deep: true,\n        immediate: true\n      }\n    },\n    mounted() {\n    },\r\n    methods: {\r\n      async playVideo() {\n        let url = await uniIm.utils.getTempFileURL(this.msg.body.url)\n        if (uniIm.isWidescreen) {\n          uni.$emit('uni-im-playVideo', url)\n        } else {\n          uni.navigateTo({\n            url: \"/uni_modules/uni-im/pages/common/video/video?url=\" + url,\n            animationDuration: 300,\n            animationType: \"fade-in\"\n          })\n        }\n      },\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n  .video-box {\r\n    /* #ifdef H5 */\n    cursor: pointer;\n    /* #endif */\n    width: 200rpx;\n    height: 200rpx;\n    position: relative;\n    .video-img {\n      width: 200rpx;\n      height: 200rpx;\n    }\n    .video-box-mark {\n      position: absolute;\n      top: 0;\n      left: 0;\n      background-color: rgba(0, 0, 0, 0.1);\n    }\n    .play-video-icon {\n      position: absolute;\n      top: calc(50% - 17.5px);\n      left: calc(50% - 17.5px);\n      width: 35px;\n      height: 35px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      border-radius: 50%;\n      border: 2px solid #FFF;\n      background-color: rgba(0, 0, 0, 0.2);\n      box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.2);\n    }\r\n  }\n</style>","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg/types/video.vue'\nwx.createComponent(Component)"],"names":["uniIm","config","uni"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAWE,MAAK,YAAU;AAAA,EACb,OAAO;AAAA,IACL,KAAK;AAAA,MACH,MAAM;AAAA,MACN,UAAW;AACT,eAAO;AAAA,UACL,MAAM;AAAA,QACR;AAAA,MACF;AAAA,IACD;AAAA,EACF;AAAA,EACD,OAAO;AACL,WAAO;AAAA,MACL,aAAa;AAAA;AAAA,MACb,UAAU;AAAA;AAAA,IACZ;AAAA,EACD;AAAA,EACD,OAAO;AAAA,IACL,YAAY;AAAA,MACJ,QAAQ,SAAS;AAAA;AACrB,eAAK,WAAW,MAAMA,4BAAAA,MAAM,MAAM,eAAe,KAAK,IAAI,KAAK,GAAG;AAElE,cAAI,KAAK,SAAS,QAAQ,OAAO,MAAM,GAAG;AAwBxC,iBAAK,cAAc;AAAA,iBAEhB;AAEH,iBAAK,cAAc,KAAK,YAAY,KAAK,SAAS,QAAQ,GAAG,IAAI,KAAK,MAAM;AAE5E,kBAAM,WAAW;AAAA,cACf,QAAQ;AAAA,cACR,SAAS;AAAA,cACT,OAAO;AAAA,YACT;AACA,iBAAK,eAAe,SAASC,gCAAAA,OAAO,UAAU,QAAQ;AAAA,UAExD;AAAA,QACD;AAAA;AAAA,MACD,MAAM;AAAA,MACN,WAAW;AAAA,IACb;AAAA,EACD;AAAA,EACD,UAAU;AAAA,EACT;AAAA,EACD,SAAS;AAAA,IACD,YAAY;AAAA;AAChB,YAAI,MAAM,MAAMD,4BAAAA,MAAM,MAAM,eAAe,KAAK,IAAI,KAAK,GAAG;AAC5D,YAAIA,4BAAAA,MAAM,cAAc;AACtBE,8BAAI,MAAM,oBAAoB,GAAG;AAAA,eAC5B;AACLA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK,sDAAsD;AAAA,YAC3D,mBAAmB;AAAA,YACnB,eAAe;AAAA,WAChB;AAAA,QACH;AAAA,MACD;AAAA;AAAA,EACH;AACF;;;;;;;;;;;;;;;;;;;;;AC3FF,GAAG,gBAAgB,SAAS;"}