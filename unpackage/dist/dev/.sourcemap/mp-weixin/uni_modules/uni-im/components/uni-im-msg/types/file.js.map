{"version":3,"file":"file.js","sources":["uni_modules/uni-im/components/uni-im-msg/types/file.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg/types/file.vue?type=component"],"sourcesContent":["<template>\r\n  <view class=\"msg-content file-msg-box\" @click=\"downLoadFile\" ref=\"msg-content\">\n    <view class=\"file-msg-info\" :class=\"{downloading}\">\n\t\t\t<view class=\"progress\" v-if=\"downloading\">\n\t\t\t\t下载中：{{downloadProgress}}%\n\t\t\t</view>\r\n      <text class=\"name\">{{fileName}}</text>\r\n      <text class=\"size\">{{fileSize}}</text>\r\n    </view>\r\n    <uni-im-icons code=\"e7d0\" size=\"50\" color=\"#EEEEEE\" class=\"file-icon\" />\r\n  </view>\r\n</template>\r\n\r\n<script>\n  import uniIm from '@/uni_modules/uni-im/sdk/index.js';\r\n  export default {\r\n    props: {\r\n      msg: {\r\n        type: Object,\r\n        default () {\r\n          return {\r\n            body: \"\"\r\n          }\r\n        }\r\n      },\r\n    },\r\n    computed: {\n\t\t\tdownloading() {\n\t\t\t\treturn this.downloadProgress != 0 && this.downloadProgress != 100\n\t\t\t},\r\n      fileSize() {\r\n        if (this.msg.type == 'file') {\r\n          let size = this.msg.body.size\r\n          if (size < Math.pow(1024, 1)) {\r\n            return parseInt(size * 10) / 10 + 'B'\r\n          } else if (size < Math.pow(1024, 2)) {\r\n            return parseInt(size / Math.pow(1024, 1) * 10) / 10 + 'KB'\r\n          } else if (size < Math.pow(1024, 3)) {\r\n            return parseInt(size / Math.pow(1024, 2) * 10) / 10 + 'MB'\r\n          } else {\r\n            return 'err'\r\n          }\r\n        }\r\n        return 'err'\r\n      },\r\n      fileName() {\r\n        if (this.msg.type == 'file') {\r\n          let name = this.msg.body.name\r\n          if (name.length < 30) {\r\n            return name\r\n          } else {\r\n            return name.slice(0, 15) + '...' + name.slice(-15)\r\n          }\r\n        }\r\n        return ''\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n\t\t\t\tdownloadProgress: 0\r\n      }\r\n    },\r\n    methods: {\r\n      async downLoadFile() {\n        const url = await uniIm.utils.getTempFileURL(this.msg.body.url)\r\n        const downloadTask = uni.downloadFile({\r\n          url,\r\n          success: (res) => {\r\n            if (res.statusCode === 200) {\r\n              // console.log('下载成功');\r\n              // console.log(res.tempFilePath);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// #ifdef H5\n\t\t\t\t\t\t\t// 触发下载\n\t\t\t\t\t\t\tconst a = document.createElement('a');\n\t\t\t\t\t\t\ta.style.display = 'none';\n\t\t\t\t\t\t\ta.href = res.tempFilePath;\n\t\t\t\t\t\t\ta.download = this.msg.body.name || 'file';\n\t\t\t\t\t\t\ta.target = '_blank';\n\t\t\t\t\t\t\tdocument.body.appendChild(a);\n\t\t\t\t\t\t\ta.click();\n\t\t\t\t\t\t\tdocument.body.removeChild(a);\n\t\t\t\t\t\t\t// #endif\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// #ifndef H5\r\n              uni.saveFile({\r\n                tempFilePath: res.tempFilePath,\r\n                success: (res) => {\r\n                  // console.log('res',res);\r\n                  uni.openDocument({\r\n                    filePath: res.savedFilePath\r\n                  })\r\n                }\r\n              });\n\t\t\t\t\t\t\t// #endif\r\n            }\r\n          }\r\n        });\n\t\t\t\t\n\t\t\t\tdownloadTask.onProgressUpdate((res) => {\n\t\t\t\t\tconsole.log('下载进度' + res.progress);\n\t\t\t\t\tconsole.log('已经下载的数据长度' + res.totalBytesWritten);\n\t\t\t\t\tconsole.log('预期需要下载的数据总长度' + res.totalBytesExpectedToWrite);\n\t\t\t\t\tthis.downloadProgress = parseInt(res.totalBytesWritten / this.msg.body.size * 100)\n\t\t\t\t})\n\t\t\t\t\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n  .file-msg-box.msg-content {\n    background-color: #FFFFFF;\r\n    width: 500rpx;\n    padding: 10px;\n    border-radius: 8px;\r\n    flex-direction: row;\n    justify-content: space-between;\n\t\t/* #ifdef H5 */\n\t\tcursor: pointer;\n\t\t/* #endif */\n    .file-msg-info {\n\t\t\tposition: relative;\n      flex: 1;\n      flex-direction: column;\n      justify-content: space-around;\n\t\t\t.progress {\n\t\t\t\tposition: absolute;\n\t\t\t\tfont-size: 14px;\n\t\t\t\theight: 100%;\n\t\t\t\twidth: 100%;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\n\t\t\t\tbackground-color: #FFF;\n\t\t\t\topacity: 0.8;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t}\n      .name {\n        word-break: break-all;\n        font-size: 16px;\n      }\n      .size {\n        font-size: 12px;\n        color: #666;\n      }\n    }\n    .file-icon {\n    }\n  }\r\n</style>","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg/types/file.vue'\nwx.createComponent(Component)"],"names":["uniIm","uni","res"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAeE,MAAK,YAAU;AAAA,EACb,OAAO;AAAA,IACL,KAAK;AAAA,MACH,MAAM;AAAA,MACN,UAAW;AACT,eAAO;AAAA,UACL,MAAM;AAAA,QACR;AAAA,MACF;AAAA,IACD;AAAA,EACF;AAAA,EACD,UAAU;AAAA,IACX,cAAc;AACb,aAAO,KAAK,oBAAoB,KAAK,KAAK,oBAAoB;AAAA,IAC9D;AAAA,IACE,WAAW;AACT,UAAI,KAAK,IAAI,QAAQ,QAAQ;AAC3B,YAAI,OAAO,KAAK,IAAI,KAAK;AACzB,YAAI,OAAO,KAAK,IAAI,MAAM,CAAC,GAAG;AAC5B,iBAAO,SAAS,OAAO,EAAE,IAAI,KAAK;AAAA,QACpC,WAAW,OAAO,KAAK,IAAI,MAAM,CAAC,GAAG;AACnC,iBAAO,SAAS,OAAO,KAAK,IAAI,MAAM,CAAC,IAAI,EAAE,IAAI,KAAK;AAAA,QACxD,WAAW,OAAO,KAAK,IAAI,MAAM,CAAC,GAAG;AACnC,iBAAO,SAAS,OAAO,KAAK,IAAI,MAAM,CAAC,IAAI,EAAE,IAAI,KAAK;AAAA,eACjD;AACL,iBAAO;AAAA,QACT;AAAA,MACF;AACA,aAAO;AAAA,IACR;AAAA,IACD,WAAW;AACT,UAAI,KAAK,IAAI,QAAQ,QAAQ;AAC3B,YAAI,OAAO,KAAK,IAAI,KAAK;AACzB,YAAI,KAAK,SAAS,IAAI;AACpB,iBAAO;AAAA,eACF;AACL,iBAAO,KAAK,MAAM,GAAG,EAAE,IAAI,QAAQ,KAAK,MAAM,GAAG;AAAA,QACnD;AAAA,MACF;AACA,aAAO;AAAA,IACT;AAAA,EACD;AAAA,EACD,OAAO;AACL,WAAO;AAAA,MACT,kBAAkB;AAAA,IAChB;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACD,eAAe;AAAA;AACnB,cAAM,MAAM,MAAMA,4BAAAA,MAAM,MAAM,eAAe,KAAK,IAAI,KAAK,GAAG;AAC9D,cAAM,eAAeC,cAAG,MAAC,aAAa;AAAA,UACpC;AAAA,UACA,SAAS,CAAC,QAAQ;AAChB,gBAAI,IAAI,eAAe,KAAK;AAiB1BA,4BAAAA,MAAI,SAAS;AAAA,gBACX,cAAc,IAAI;AAAA,gBAClB,SAAS,CAACC,SAAQ;AAEhBD,gCAAAA,MAAI,aAAa;AAAA,oBACf,UAAUC,KAAI;AAAA,mBACf;AAAA,gBACH;AAAA,cACF,CAAC;AAAA,YAEH;AAAA,UACF;AAAA,QACF,CAAC;AAEL,qBAAa,iBAAiB,CAAC,QAAQ;AACtCD,wBAAA,MAAA,MAAA,OAAA,kEAAY,SAAS,IAAI,QAAQ;AACjCA,wBAAY,MAAA,MAAA,OAAA,kEAAA,cAAc,IAAI,iBAAiB;AAC/CA,wBAAA,MAAA,MAAA,OAAA,kEAAY,iBAAiB,IAAI,yBAAyB;AAC1D,eAAK,mBAAmB,SAAS,IAAI,oBAAoB,KAAK,IAAI,KAAK,OAAO,GAAG;AAAA,SACjF;AAAA,MAEC;AAAA;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3GF,GAAG,gBAAgB,SAAS;"}