{"version":3,"file":"uni-im-img.js","sources":["uni_modules/uni-im/components/uni-im-img/uni-im-img.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-img/uni-im-img.vue?type=component"],"sourcesContent":["<template>\n  <image @load=\"load\" :src=\"url\" :mode=\"mode\" :style='{\"width\":viewWidth,\"height\":viewHeight,borderRadius}' @click=\"handleClick\"></image>\n</template>\n\n<script>\nimport uniIm from '@/uni_modules/uni-im/sdk/index.js';\nimport config from '@/uni_modules/uni-im/common/config.js';\n  export default {\n    emits: ['click'],\n    props: {\n      src: {\n        type: String,\n        default: ''\n      },\n      mode: {\n        type: String,\n        default: ''\n      },\n      maxWidth: {\n        type: [String,Number,Boolean],\n        default: false\n      },\n      maxHeight: {\n        type: [String,Number],\n        default: ''\n      },\n      width: {\n        type: [String,Number],\n        default: ''\n      },\n      height: {\n        type: [String,Number],\n        default: ''\n      },\n      borderRadius: {\n        type: [String,Number],\n        default: ''\n      }\n    },\n    data() {\n      return {\n        url: '',\n        viewWidth: '',\n        viewHeight: ''\n      }\n    },\n    mounted() {\n      // console.log('beforeCreate')\n      if( this.width && this.height){\n        // 根据maxWidth 和 maxWidth，在保持宽高比例不变的情况下 计算viewWidth 和 viewHeight\n        const maxWidth = this.toPx(this.maxWidth)\n        const maxHeight = this.toPx(this.maxHeight)\n        let width = this.toPx(this.width)\n        let height = this.toPx(this.height)\n        \n        // 如果宽超过最大宽度，高度按比例缩小\n        if(width > maxWidth){\n          height = height * maxWidth / width\n          width = maxWidth\n        }\n        // 如果高超过最大高度，宽度按比例缩小\n        if(height > maxHeight){\n          width = width * maxHeight / height\n          height = maxHeight\n        }\n        this.viewWidth = width + 'px'\n        this.viewHeight = height + 'px'\n      }\n    },\n    watch: {\n       src:{\n        async handler(src) {\n          if(src){\n            // 判断是否为base64 blob ./ / @/开头的本地图片\n            if(src.indexOf('blob:') === 0 || src.indexOf('./') === 0 || src.indexOf('/') === 0 || src.indexOf('@/') === 0){\n              this.url = src\n              return\n            }\n            \n            this.url = await uniIm.utils.getTempFileURL(src)\n            // 文件存储的服务商\n            const {provider} = config.cloudFile\n\t\t\t\t\t\tconst maxWidth = this.maxWidth ? this.toPx(this.maxWidth) : '400'\n            switch(provider){\n              case 'aliyun':\n                this.url += `?x-oss-process=image/resize,w_${maxWidth}/quality,q_80`\n                break\n              case 'tencent':\n                this.url += `?imageMogr2/thumbnail/${maxWidth}x${maxWidth}>`\n                break\n              case 'qiniu':\n                this.url += `?imageMogr2/thumbnail/${maxWidth}x${maxWidth}>`\n                break\n            }\n            \n          }\n        },\n        immediate: true\n      }\n    },\n    methods: {\n      load(e){\n        // console.log('img load',e)\n        // TODO：渲染后再设置宽高，为兼容旧版系统，图片消息中没有带宽高的情况\n        if(!this.width || !this.height){\n          let width = e.detail.width\n          let maxWidth = this.toPx(this.maxWidth)\n          if(maxWidth && width > maxWidth){\n            this.viewWidth = maxWidth + 'px'\n            this.viewHeight = maxWidth * e.detail.height / e.detail.width + 'px'\n            // console.error('超了',this.width,this.height)\n          }else{\n            this.viewWidth = e.detail.width + 'px'\n            this.viewHeight = e.detail.height + 'px'\n          }\n        }\n      },\n      handleClick(event){\n        this.$emit('click',event)\n      },\n      // 如果是rpx单位，转换为px\n      toPx(val){\n        if(typeof val === 'string' && val.indexOf('rpx') > -1){\n          return parseInt(val) * uniIm.systemInfo.windowWidth / 750\n        }\n        return parseInt(val)\n      }\n    }\n  }\n</script>\n\n<style>\n</style>\n","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-img/uni-im-img.vue'\nwx.createComponent(Component)"],"names":["uniIm","config"],"mappings":"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"}