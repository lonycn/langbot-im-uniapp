{"version":3,"file":"uni-im-group-notice-popup.js","sources":["uni_modules/uni-im/components/uni-im-group-notice-popup/uni-im-group-notice-popup.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-group-notice-popup/uni-im-group-notice-popup.vue?type=component"],"sourcesContent":["<template>\n\t<uni-popup ref=\"group-notice-popup\" type=\"center\" :mask-click=\"false\">\n\t\t<view class=\"uni-im-group-notice-popup\">\n\t\t\t<group-notice :msg=\"{ body: { content: this.notice.content }, create_time: notice.create_time }\">\n\t\t\t\t<template v-slot>\n\t\t\t\t\t<view class=\"btn-box\">\n\t\t\t\t\t\t<button class=\"btn\" type=\"primary\" plain size=\"mini\" @click=\"close\">知道了</button>\n\t\t\t\t\t</view>\n\t\t\t\t</template>\n\t\t\t</group-notice>\n\t\t</view>\n\t</uni-popup>\n</template>\n\n<script>\n  import uniIm from '@/uni_modules/uni-im/sdk/index.js';\n\timport groupNotice from '@/uni_modules/uni-im/components/uni-im-msg/types/group-notice.vue'\n  export default {\n\t\toptions: {\n\t\t\tstyleIsolation: 'shared' // 解除样式隔离\n\t\t},\n\t\tcomponents: {\n\t\t\tgroupNotice\n\t\t},\n    data() {\n      return {\n        notice:{},\n\t\t\t\tisOpened: false\n      }\n    },\n\t\twatch: {\n\t\t\tisOpened(val){\n\t\t\t\tif(val){\n\t\t\t\t\tuniIm.onMsg(this.hasNewMsg)\n\t\t\t\t} else {\n\t\t\t\t\tuniIm.offMsg(this.hasNewMsg)\n\t\t\t\t\tthis.notice = {}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\thasNewMsg(res){\n\t\t\t\t// console.log('hasNewMsg-----------------',res)\n\t\t\t\tconst msg = res.data.payload.data\n\t\t\t\tif (msg.action == 'setUnreadGroupNoticeId') {\n\t\t\t\t\tif(msg.body.type === 'delete' && this.notice._id === msg.body.notice_id){\n\t\t\t\t\t\tconsole.log('删除群公告')\n\t\t\t\t\t\tthis.isOpened = false\n\t\t\t\t\t\tthis.$refs['group-notice-popup'].close();\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '此群公告已被删除',\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync open({group_id,notice_id}) {\n\t\t\t\t\n\t\t\t\tif( this.isOpened ){\n\t\t\t\t\tthis.$refs['group-notice-popup'].close();\n\t\t\t\t\topen.call(this)\n\t\t\t\t} else {\n\t\t\t\t\topen.call(this)\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tasync function open(){\n\t\t\t\t\tthis.isOpened = true\n\t\t\t\t\tconst dbJQL = uniCloud.databaseForJQL()\n\t\t\t\t\tconst res = await dbJQL.collection('uni-im-group-notice').where({group_id,_id: notice_id})\n\t\t\t\t\t.orderBy('create_time', 'desc')\n\t\t\t\t\t.limit(1)\n\t\t\t\t\t.get()\n\t\t\t\t\tthis.notice = res.data[0]\n\t\t\t\t\tconsole.log('群公告', res,'this.notice',this.notice)\n\t\t\t\t\tthis.conversation = await uniIm.conversation.get('group_' + this.notice.group_id)\n\t\t\t\t\tthis.$refs['group-notice-popup'].open();\n\t\t\t\t}\n\t\t\t},\n\t\t\tclose() {\n\t\t\t\tthis.isOpened = false\n\t\t\t\tthis.$refs['group-notice-popup'].close();\n\t\t\t\tconst db = uniCloud.database();\n\t\t\t\tdb.collection('uni-im-conversation')\n\t\t\t\t.where({\n\t\t\t\t  id:this.conversation.id,\n\t\t\t\t  user_id: uniIm.currentUser._id\n\t\t\t\t})\n\t\t\t\t.update({\n\t\t\t\t  unread_group_notice_id: ''\n\t\t\t\t}).then(res => {\n\t\t\t\t  this.conversation.unread_group_notice_id = ''\n\t\t\t\t  console.log('群公告设为已读，成功', res)\n\t\t\t\t}).catch(err => {\n\t\t\t\t  console.error('群公告设为已读，失败', err)\n\t\t\t\t})\n\t\t\t},\n\t\t}\n  }\n</script>\n\n<style lang=\"scss\">\n  .uni-im-group-notice-popup {\n\t\tbackground-color: #FFF;\n\t\tborder-radius: 8px;\n\t\t::v-deep .group-notice-box .group-notice{\n\t\t\tmargin: 0;\n\t\t\t.content {\n\t\t\t\tmax-height: 750rpx;\n\t\t\t\toverflow: auto;\n\t\t\t\t/* #ifdef H5 */\n\t\t\t\t@media screen and (min-device-width:960px){\n\t\t\t\t\tmax-height: 80vh;\n\t\t\t\t}\n\t\t\t\t/* #endif */\n\t\t\t}\n\t\t}\n\t\t.btn-box {\n\t\t\tbackground-color: #FFF;\n\t\t\tpadding: 10px 0;\n\t\t\t.btn {\n\t\t\t\tmargin: 0 10px;\n\t\t\t}\n\t\t}\n\t}\n</style>","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-group-notice-popup/uni-im-group-notice-popup.vue'\nwx.createComponent(Component)"],"names":["uniIm","uni","uniCloud"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAgBC,MAAO,cAAa,MAAW;AAC9B,MAAK,YAAU;AAAA,EACf,SAAS;AAAA,IACR,gBAAgB;AAAA;AAAA,EAChB;AAAA,EACD,YAAY;AAAA,IACX;AAAA,EACA;AAAA,EACC,OAAO;AACL,WAAO;AAAA,MACL,QAAO,CAAE;AAAA,MACb,UAAU;AAAA,IACR;AAAA,EACD;AAAA,EACH,OAAO;AAAA,IACN,SAAS,KAAI;AACZ,UAAG,KAAI;AACNA,0CAAM,MAAM,KAAK,SAAS;AAAA,aACpB;AACNA,0CAAM,OAAO,KAAK,SAAS;AAC3B,aAAK,SAAS,CAAC;AAAA,MAChB;AAAA,IACD;AAAA,EACA;AAAA,EACD,SAAS;AAAA,IACR,UAAU,KAAI;AAEb,YAAM,MAAM,IAAI,KAAK,QAAQ;AAC7B,UAAI,IAAI,UAAU,0BAA0B;AAC3C,YAAG,IAAI,KAAK,SAAS,YAAY,KAAK,OAAO,QAAQ,IAAI,KAAK,WAAU;AACvEC,wBAAAA,MAAA,MAAA,OAAA,+FAAY,OAAO;AACnB,eAAK,WAAW;AAChB,eAAK,MAAM,oBAAoB,EAAE,MAAK;AACtCA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,UACP,CAAC;AAAA,QACF;AAAA,MACD;AAAA,IACA;AAAA,IACK,KAAK,IAAsB;AAAA,iDAAtB,EAAC,UAAS,UAAS,GAAG;AAEhC,YAAI,KAAK,UAAU;AAClB,eAAK,MAAM,oBAAoB,EAAE,MAAK;AACtC,eAAK,KAAK,IAAI;AAAA,eACR;AACN,eAAK,KAAK,IAAI;AAAA,QACf;AAEA,iBAAe,OAAM;AAAA;AACpB,iBAAK,WAAW;AAChB,kBAAM,QAAQC,cAAQ,GAAC,eAAe;AACtC,kBAAM,MAAM,MAAM,MAAM,WAAW,qBAAqB,EAAE,MAAM,EAAC,UAAS,KAAK,UAAS,CAAC,EACxF,QAAQ,eAAe,MAAM,EAC7B,MAAM,CAAC,EACP,IAAI;AACL,iBAAK,SAAS,IAAI,KAAK,CAAC;AACxBD,gCAAY,MAAA,OAAA,+FAAA,OAAO,KAAI,eAAc,KAAK,MAAM;AAChD,iBAAK,eAAe,MAAMD,4BAAAA,MAAM,aAAa,IAAI,WAAW,KAAK,OAAO,QAAQ;AAChF,iBAAK,MAAM,oBAAoB,EAAE,KAAI;AAAA,UACtC;AAAA;AAAA,MACA;AAAA;AAAA,IACD,QAAQ;AACP,WAAK,WAAW;AAChB,WAAK,MAAM,oBAAoB,EAAE,MAAK;AACtC,YAAM,KAAKE,iBAAS;AACpB,SAAG,WAAW,qBAAqB,EAClC,MAAM;AAAA,QACL,IAAG,KAAK,aAAa;AAAA,QACrB,SAASF,4BAAAA,MAAM,YAAY;AAAA,OAC5B,EACA,OAAO;AAAA,QACN,wBAAwB;AAAA,OACzB,EAAE,KAAK,SAAO;AACb,aAAK,aAAa,yBAAyB;AAC3CC,sBAAAA,MAAY,MAAA,OAAA,+FAAA,cAAc,GAAG;AAAA,MAC/B,CAAC,EAAE,MAAM,SAAO;AACdA,sBAAAA,MAAc,MAAA,SAAA,+FAAA,cAAc,GAAG;AAAA,OAChC;AAAA,IACD;AAAA,EACF;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChGF,GAAG,gBAAgB,SAAS;"}