{"version":3,"file":"text.js","sources":["uni_modules/uni-im/components/uni-im-msg/types/text.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg/types/text.vue?type=component"],"sourcesContent":["<template>\n  <view class=\"msg-text-box\" :class=\"{self}\">\n    <msgRichText v-if=\"htmlNodes.length\" :msg=\"{...msg,...{'body':htmlNodes}}\" />\n    <text v-else class=\"msg-text\" :decode=\"true\" space=\"ensp\">{{ trText(msg.body) }}</text>\n  </view>\n</template>\n\n<script>\n  import uniIm from '@/uni_modules/uni-im/sdk/index.js';\n  import msgRichText from './rich-text.vue'\n  export default {\n    components: {\n      msgRichText,\n    },\n    props: {\n      msg: {\n        type: Object,\n        default () {\n          return {\n            body: \"\"\n          }\n        }\n      }\n    },\n    data() {\n      return {\n        htmlNodes: []\n      }\n    },\n    computed: {\n      self() {\n        return this.msg.from_uid === uniIm.currentUser._id\n      },\n    },\n    methods: {\n      trText(str) {\n        // TODO：临时方案，解决 \\n 被转义的问题\n        return str.replace(/\\\\n/g, \"\\\\\\\\n\")\n      },\n    },\n    watch: {\n      \"msg.body\": {\n        handler() {\n          let htmlString = this.msg.body.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\")\n          // 将字符串的url转换为链接\n          htmlString = uniIm.utils.replaceUrlToLink(htmlString)\n          \n          /* 如需要自己补：\n          // 手机号正则\n          const regPhone = /(13[0-9]|14[5-9]|15[012356789]|166|17[0-8]|18[0-9]|19[8-9])[0-9]{8}/g;\n          htmlString = htmlString.replace(regPhone, \" <a href='tel:$&'>$&</a>\")\n          // 固定电话正则\n          const regTel = /(([0\\+]\\d{2,3}-)?(0\\d{2,3})-)(\\d{7,8})(-(\\d{3,}))?/g;\n          htmlString = htmlString.replace(regTel, \" <a href='tel:$&'>$&</a>\")\n          // 邮箱正则\n          const regMail = /([a-z0-9._-]+@[a-z0-9.-]+\\.[a-z]{2,4})/ig;\n          htmlString = htmlString.replace(regMail, \" <a href='mailto:$&'>$&</a>\")\n          */\n          \n          if (this.msg.body != htmlString) {\n            try {\n              let htmlNodes = uniIm.utils.parseHtml(htmlString)\n              // console.log('htmlNodes',htmlNodes);\n              htmlNodes.map(item => {\n                // console.log('item',item);\n                if (item.attrs && item.attrs.class) {\n                  item.attrs.class += \" msg-text\"\n                } else {\n                  item.attrs = {\n                    class: \"msg-text\"\n                  }\n                }\n                return item\n              })\n              this.htmlNodes = htmlNodes\n            } catch (e) {\n              console.error('htmlString error：', e);\n            }\n          }\n        },\n        immediate: true\n      }\n    },\n    mounted() {},\n  }\n</script>\n\n<style lang=\"scss\">\n  .msg-text-box {\n    border-radius: 10px;\n    background-color: #FFFFFF;\n    min-width: 30px;\n    flex-shrink: 1;\n    &.self{\n      background-color: #c9e7ff;\n    }\n    .msg-text {\n      padding:5px 10px;\n      font-size: 15px;\n      word-break: break-all;\n      cursor: text;\n      /* #ifdef H5 */\n      @media screen and (min-device-width:960px){\n        user-select: text;\n      }\n      /* #endif */\n    }\n  }\n  \n</style>","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg/types/text.vue'\nwx.createComponent(Component)"],"names":["uniIm","uni"],"mappings":";;;;;;;;;;;;;;;;;;;AASE,oBAAoB,MAAW;AAC/B,MAAK,YAAU;AAAA,EACb,YAAY;AAAA,IACV;AAAA,EACD;AAAA,EACD,OAAO;AAAA,IACL,KAAK;AAAA,MACH,MAAM;AAAA,MACN,UAAW;AACT,eAAO;AAAA,UACL,MAAM;AAAA,QACR;AAAA,MACF;AAAA,IACF;AAAA,EACD;AAAA,EACD,OAAO;AACL,WAAO;AAAA,MACL,WAAW,CAAC;AAAA,IACd;AAAA,EACD;AAAA,EACD,UAAU;AAAA,IACR,OAAO;AACL,aAAO,KAAK,IAAI,aAAaA,4BAAK,MAAC,YAAY;AAAA,IAChD;AAAA,EACF;AAAA,EACD,SAAS;AAAA,IACP,OAAO,KAAK;AAEV,aAAO,IAAI,QAAQ,QAAQ,OAAO;AAAA,IACnC;AAAA,EACF;AAAA,EACD,OAAO;AAAA,IACL,YAAY;AAAA,MACV,UAAU;AACR,YAAI,aAAa,KAAK,IAAI,KAAK,QAAQ,MAAM,MAAM,EAAE,QAAQ,MAAM,MAAM;AAEzE,qBAAaA,4BAAK,MAAC,MAAM,iBAAiB,UAAU;AAcpD,YAAI,KAAK,IAAI,QAAQ,YAAY;AAC/B,cAAI;AACF,gBAAI,YAAYA,4BAAK,MAAC,MAAM,UAAU,UAAU;AAEhD,sBAAU,IAAI,UAAQ;AAEpB,kBAAI,KAAK,SAAS,KAAK,MAAM,OAAO;AAClC,qBAAK,MAAM,SAAS;AAAA,qBACf;AACL,qBAAK,QAAQ;AAAA,kBACX,OAAO;AAAA,gBACT;AAAA,cACF;AACA,qBAAO;AAAA,aACR;AACD,iBAAK,YAAY;AAAA,UACnB,SAAS,GAAG;AACVC,0BAAc,MAAA,MAAA,SAAA,iEAAA,qBAAqB,CAAC;AAAA,UACtC;AAAA,QACF;AAAA,MACD;AAAA,MACD,WAAW;AAAA,IACb;AAAA,EACD;AAAA,EACD,UAAU;AAAA,EAAE;AACd;;;;;;;;;;;;;;;;;;;;;ACnFF,GAAG,gBAAgB,SAAS;"}