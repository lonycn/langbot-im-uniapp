{"version":3,"file":"uni-im-contextmenu.js","sources":["uni_modules/uni-im/components/uni-im-contextmenu/uni-im-contextmenu.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-contextmenu/uni-im-contextmenu.vue?type=component"],"sourcesContent":["<template>\n  <view class=\"root\" v-if=\"isShow\" @contextmenu.prevent.native=\"isWidescreen?closeMe():''\">\n    <view class=\"uni-im-contextmenu-mark\" @touchstart.prevent=\"closeMe\" @click=\"closeMe\"></view>\n    <!-- 注意微信小程序下style不支持传obj -->\n    <view class=\"contextmenu\" ref=\"contextmenu\" :style=\"{'left':style.left,'top':style.top,'opacity':style.opacity}\">\n      <text class=\"item\" v-for=\"(item,index) in menuList\" :key=\"index\" @click=\"doAction(item.action)\">{{item.title}}</text>\n    </view>\n  </view>\n</template>\n\n<script>\n  // let funList = {}\n  let onCloseFnList = [];\n  import uniIm from '@/uni_modules/uni-im/sdk/index.js';\n  export default {\n    computed: {\n      ...uniIm.mapState(['isWidescreen']),\n    },\n    data() {\n      return {\n        \"isShow\":false,\n        \"style\":{\n          \"top\":\"\",\n          \"left\":\"\",\n          \"opacity\":1\n        },\n        \"menuList\":[\n          {\n            \"title\":\"title\",\n            \"action\":\"defaultAction\"\n          },\n          {\n            \"title\":\"title2\",\n            \"action\":\"defaultAction2\"\n          },\n          {\n            \"title\":\"测试其中一个特别长\",\n            \"action\":\"defaultAction2\"\n          }\n        ]\n      }\n    },\n    methods: {\n      onClose(fn){\n        onCloseFnList.push(fn)\n      },\n      doAction(actionName){\n        actionName()\n        this.closeMe()\n      },\n      show(position,menuList){\n        let {\n          top = '',\n          left = '',\n          estimateWidth = 150, // 预估尺寸应该不小于实际渲染尺寸\n          estimateHeight = 150,\n        } = position\n\n        // 根据给定的位置和尺寸，结合窗口大小，计算出 top/left 定位参数，\n        // 确保不超出窗口边界。\n        let calcPosition = (top, left, width, height) => {\n          let { windowWidth, windowHeight } = uni.getWindowInfo()\n          // console.log({windowWidth,windowHeight,top, left, width, height})\n          let style = {}\n          if (top) {\n            if (top > windowHeight - height) {\n              style.top = `${windowHeight - height}px`\n            } else {\n              style.top = `${top}px`\n            }\n          }\n          if (left) {\n            if (left > windowWidth - width) {\n              style.left = `${windowWidth - width}px`\n            } else {\n              style.left = `${left}px`\n            }\n          }\n          return style\n        }\n        \n        // 根据预估的组件大小初步设定组件的位置\n        this.style = calcPosition(top, left, estimateWidth, estimateHeight)\n        this.isShow = true\n        this.menuList = menuList\n        this.style.opacity = 0\n\n        setTimeout(() => {\n          // 根据实际渲染出的组件大小修正定位\n          const query = uni.createSelectorQuery().in(this)\n          query.select('.contextmenu').boundingClientRect(option => {\n            const { width, height } = option\n            this.style = calcPosition(top, left, width, height)\n            this.style.opacity = 1\n          }).exec()\n        }, 0)\n      },\n      closeMe(){\n        this.isShow = false\n        onCloseFnList.forEach(fn => {\n          if(typeof fn === 'function'){\n            fn()\n          }\n        })\n        onCloseFnList = []\n        // console.log('closeMe');\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\">\n.root{\n  \n}\n.contextmenu{\n  position: fixed;\n  background-color: #fff;\n  z-index: 99;\n  border-radius: 10px;\n  box-shadow: 0 0 10px #888;\n  background-color:#FFF;\n  // opacity: 0.98;\n  border: 1px solid #999;\n  padding: 3px;\n  flex-direction: column;\n}\n\n.item{\n  padding: 5px 10px;\n  font-size: 18px;\n  border-radius: 5px;\n  margin: 5px;\n  opacity: 0.9;\n  text-align: left;\n  height: 40px;\n  align-content: center;\n  /* #ifdef H5 */\n  cursor: pointer;\n  /* #endif */\n}\n\n.item:hover{\n  background-color: #1099ff;\n  color: #fff;\n}\n\n.uni-im-contextmenu-mark{\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\twidth: 100vw;\n\t\theight: 100vh;\n\t\tz-index:10;\n\t\tbackground-color: rgba(0,0,0,0.5);\n\t}\n</style>\n","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-contextmenu/uni-im-contextmenu.vue'\nwx.createComponent(Component)"],"names":["uniIm","top","left","uni"],"mappings":";;;;;;;;;;;;;;;;;;;AAYE,IAAI,gBAAgB,CAAA;AAEpB,MAAK,YAAU;AAAA,EACb,UAAU,mBACLA,kCAAM,SAAS,CAAC,cAAc,CAAC;AAAA,EAEpC,OAAO;AACL,WAAO;AAAA,MACL,UAAS;AAAA,MACT,SAAQ;AAAA,QACN,OAAM;AAAA,QACN,QAAO;AAAA,QACP,WAAU;AAAA,MACX;AAAA,MACD,YAAW;AAAA,QACT;AAAA,UACE,SAAQ;AAAA,UACR,UAAS;AAAA,QACV;AAAA,QACD;AAAA,UACE,SAAQ;AAAA,UACR,UAAS;AAAA,QACV;AAAA,QACD;AAAA,UACE,SAAQ;AAAA,UACR,UAAS;AAAA,QACX;AAAA,MACF;AAAA,IACF;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACP,QAAQ,IAAG;AACT,oBAAc,KAAK,EAAE;AAAA,IACtB;AAAA,IACD,SAAS,YAAW;AAClB,iBAAW;AACX,WAAK,QAAQ;AAAA,IACd;AAAA,IACD,KAAK,UAAS,UAAS;AACrB,UAAI;AAAA,QACF,MAAM;AAAA,QACN,OAAO;AAAA,QACP,gBAAgB;AAAA;AAAA,QAChB,iBAAiB;AAAA,MACnB,IAAI;AAIJ,UAAI,eAAe,CAACC,MAAKC,OAAM,OAAO,WAAW;AAC/C,YAAI,EAAE,aAAa,iBAAiBC,cAAAA,MAAI,cAAc;AAEtD,YAAI,QAAQ,CAAC;AACb,YAAIF,MAAK;AACP,cAAIA,OAAM,eAAe,QAAQ;AAC/B,kBAAM,MAAM,GAAG,eAAe,MAAM;AAAA,iBAC/B;AACL,kBAAM,MAAM,GAAGA,IAAG;AAAA,UACpB;AAAA,QACF;AACA,YAAIC,OAAM;AACR,cAAIA,QAAO,cAAc,OAAO;AAC9B,kBAAM,OAAO,GAAG,cAAc,KAAK;AAAA,iBAC9B;AACL,kBAAM,OAAO,GAAGA,KAAI;AAAA,UACtB;AAAA,QACF;AACA,eAAO;AAAA,MACT;AAGA,WAAK,QAAQ,aAAa,KAAK,MAAM,eAAe,cAAc;AAClE,WAAK,SAAS;AACd,WAAK,WAAW;AAChB,WAAK,MAAM,UAAU;AAErB,iBAAW,MAAM;AAEf,cAAM,QAAQC,cAAG,MAAC,oBAAmB,EAAG,GAAG,IAAI;AAC/C,cAAM,OAAO,cAAc,EAAE,mBAAmB,YAAU;AACxD,gBAAM,EAAE,OAAO,OAAO,IAAI;AAC1B,eAAK,QAAQ,aAAa,KAAK,MAAM,OAAO,MAAM;AAClD,eAAK,MAAM,UAAU;AAAA,QACtB,CAAA,EAAE,KAAK;AAAA,MACT,GAAE,CAAC;AAAA,IACL;AAAA,IACD,UAAS;AACP,WAAK,SAAS;AACd,oBAAc,QAAQ,QAAM;AAC1B,YAAG,OAAO,OAAO,YAAW;AAC1B,aAAG;AAAA,QACL;AAAA,OACD;AACD,sBAAgB,CAAC;AAAA,IAEnB;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;AC3GF,GAAG,gBAAgB,SAAS;"}