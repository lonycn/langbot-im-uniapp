{"version":3,"file":"uni-im-msg-list.js","sources":["uni_modules/uni-im/components/uni-im-msg-list/uni-im-msg-list.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg-list/uni-im-msg-list.vue?type=component"],"sourcesContent":["<template>\n  <view class=\"uni-im-msg-list-root\" :class=\"{'in-topic':filterAsUid.length}\">\n    <filter-contorl ref=\"filter-contorl\" class=\"filter-contorl\" @change=\"updateFilterUids\" :conversationId=\"conversationId\"></filter-contorl>\n    <uni-im-list class=\"uni-im-list\" :scrollTop=\"scrollTop\"\n      :scroll-into-view=\"scrollIntoView\" ref=\"uni-im-list\"\n      @scroll=\"onScroll\" @scrolltolower=\"onScrollToLower\"\n    >\n     <template v-for=\"(msg,index) in visibleMsgList\" :key=\"msg.unique_id || msg._id\">\n       <view class=\"uni-im-list-item\" :ref=\"'item-'+index\">\n         <view v-if=\"index === 0\" class=\"data-state-tip-box\">\n           <uni-im-load-state :status=\"loadStatus\" \n              :contentText='{\"contentrefresh\": \"正在加载历史消息\",\"contentnomore\": \"没有更多历史消息\"}'></uni-im-load-state>\n         </view>\n         <view :class=\"['item',msg.type]\" :id=\"'item-'+index\" @click=\"clickItem\">\n           <view class=\"msg-box\" :class=\"{'active-msg':msg._id === activeMsgId || msg.unique_id === activeMsgId,'pointer':chooseMore}\" @click=\"checkMsg(msg)\">\n             <template v-if=\"chooseMore && !msg.is_revoke\">\n              <checkbox :checked=\"checkedMsgList.find(i=>i._id == msg._id) != undefined\" class=\"checkbox\" />\n              <view class=\"mask\"></view>\n             </template>\n             <!-- <text style=\"width: 750rpx;text-align: center;border: 1px solid #000;\">{{'item-'+index}}</text> -->\n             <uni-im-msg :msg=\"msg\" :id=\"msg._id\" :self=\"currentUid == msg.from_uid\" :index=\"index\"\n             @putChatInputContent=\"putChatInputContent\" :equalPrevTime=\"equalPrevTime(index)\" \n             @showMsgById=\"showMsgById\" @showControl=\"showControl\" @intoTopic=\"intoTopic\"\n             @longpressMsgAvatar=\"longpressMsgAvatar\" @retriesSendMsg=\"retriesSendMsg\" \n             @viewMsg=\"viewMsg\" ref=\"uni-im-msg\" class=\"uni-im-msg\"\n             >\n             </uni-im-msg>\n           </view>\n         </view>\n       </view>\n     </template>\n     <uni-im-load-state v-if=\"visibleMsgList.length === 0\" :status=\"loadStatus\" class=\"uni-im-list-item\" :contentText='{\"contentrefresh\": \"加载中\",\"contentnomore\": \"- 没有聊天记录 -\"}'></uni-im-load-state>\n    </uni-im-list>\n    \n    <view v-if=\"hasNewMsg\" class=\"new-msg-bar\" @click=\"showLast\">\n      <uni-icons type=\"pulldown\" size=\"18\" color=\"#007fff\"></uni-icons>\n      <text>有新消息</text>\n    </view>\n    \n    <view style=\"position: fixed;top: 100px;width: 500rpx;\">\n      <!-- hasNewMsg:{{hasNewMsg}} -->\n      <!-- scrollTop：{{scrollTop}} -->\n      <!-- scrollIntoView:{{scrollIntoView}}\n\t\t\tvisibleMsgList.length:{{visibleMsgList.length}} -->\n\t\t\t<!-- <button @click=\"showLast\">showLast</button> -->\n\t\t</view>\n\n    <view v-if=\"remind_msg_ids.length\" class=\"showRemindMsg\" @click=\"showRemindMsg\">@回复我({{remind_msg_ids.length}})</view>\n\n    <uni-popup @change=\"$event.show?'':closeGroupNotification()\" ref=\"group-notification-popup\" type=\"center\" class=\"group-notification-popup\">\n      <uni-im-group-notification ref=\"group-notification\"></uni-im-group-notification>\n    </uni-popup>\n\t\t\n\t\t<uni-im-group-notice-popup ref=\"uni-im-group-notice-popup\"></uni-im-group-notice-popup>\n\n    <uni-im-view-msg ref=\"view-msg\"></uni-im-view-msg>\n  </view>\n</template>\n\n<script>\n/**\n * uni-im-msg-list 组件，渲染一个会话列表。\n * \n * 内部使用 {@link module:uni-im-list} 组件实现列表功能，使用 {@link module:uni-im-msg} 组件实现每条消息的渲染。\n * \n * @module\n * @see module:chat\n * @see module:uni-im-list\n */\n  import uniIm from '@/uni_modules/uni-im/sdk/index.js';\n  import uniImList from './components/uni-im-list/uni-im-list';\n  import filterContorl from './components/filter-contorl/filter-contorl';\n\n  // 当前页面滚动条高度\n  let currentScrollTop = 0\n  \n  let appearObj = {};\n\n  export default {\n    components: {\n      uniImList,\n      filterContorl\n    },\n    emits:['checkedMsgList','update:checkedMsgList','longpressMsgAvatar','showControl','clickItem','retriesSendMsg','putChatInputContent','showMenberList'],\n    computed: {\n      ...uniIm.mapState(['systemInfo', 'isWidescreen']),\n      loadStatus() {\n        return this.conversation.msg.hasMore ? 'loading' : 'noMore'\n      },\n      visibleMsgList() {\n        const visibleMsgList = this.conversation.msg.visibleDataList()\n        // console.log('visibleMsgList',visibleMsgList);\n        this.$nextTick(() => {\n          uniIm.utils.throttle(this.setIntersectionObserver, 1000);\n        })\n        \n        if(this.filterAsUid.length > 0){\n          return visibleMsgList.filter(i=>this.filterAsUid.includes(i.from_uid))\n        }\n        // console.log('visibleMsgList.l',visibleMsgList.length);\n        return visibleMsgList\n      },\n      //当前用户自己的uid\n      currentUid() {\n        return uniIm.currentUser._id;\n      }\n    },\n    data() {\n      return {\n        conversation: {\n          msg: {\n            hasMore: true,\n            visibleDataList: () => []\n          },\n          unread_group_notice_id: false,\n          group_info: {\n            notification: false\n          }\n        },\n\t\t\t\tlastMsgIsShow: true,\n        scrollIntoView: \"\",\n        scrollTop: 0,\n        hasNewMsg: false,\n        remind_msg_ids: [],\n        activeMsgId: \"\",\n        filterAsUid:[]\n      }\n    },\n    watch: {\n      'conversation.remind_msg_ids'(remind_msg_ids) {\n        this.remind_msg_ids = remind_msg_ids\n      },\n      'conversation.unread_group_notice_id': {\n        async handler(notice_id) {\n\t\t\t\t\t// 拿到新增的公告id\n\t\t\t\t\tif(notice_id){\n\t\t\t\t\t\tthis.$refs[\"uni-im-group-notice-popup\"].open({\n\t\t\t\t\t\t\tgroup_id: this.conversation.group_id,\n\t\t\t\t\t\t\tnotice_id\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n        },\n        immediate: true\n      },\n      filterAsUid(filterAsUid,old){\n        this.$refs['filter-contorl'].userIdList = filterAsUid\n\t\t\t\tconst {msg} = this.conversation\n\t\t\t\tmsg.reset()\n\t\t\t\tif(filterAsUid.length === 0){\n\t\t\t\t\tmsg.preWhere = false\n\t\t\t\t} else {\n\t\t\t\t\tmsg.preWhere = {\n\t\t\t\t\t\tfrom_uid: uniCloud.databaseForJQL().command.in(filterAsUid)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.loadMore(()=>{\n\t\t\t\t\tthis.showLast()\n\t\t\t\t})\n      }\n    },\n    props: {\n      conversationId: {\n        default () {\n          return false\n        }\n      },\n      chooseMore: {\n        default: false\n      },\n      checkedMsgList: {\n        default () {\n          return []\n        }\n      }\n    },\n    async mounted() {\n    },\n    destroyed() {\n      // console.log('destroyed')\n      if (this.intersectionObserver){\n        this.intersectionObserver.disconnect()\n      }\n    },\n    methods: {\n      async init() {\n        if (this.intersectionObserver){\n          this.intersectionObserver.disconnect()\n        }\n        this.conversation = uniIm.conversation.find(this.conversationId)\n        \n        // init data --start\n\t\t\t\tthis.lastMsgIsShow = true\n        this.scrollIntoView = ''\n        this.scrollTop = 0\n        currentScrollTop = 0\n\n        const showLast = ()=>{\n          // #ifdef H5\n          // 非web-pc端，list是颠倒的，所以默认显示最后一条。而web-pc端是正常的，所以需要滚动到底部\n          if(this.isWidescreen){\n            this.showLast()\n          }\n          // #endif\n        }\n        \n        if(this.visibleMsgList.length === 0){\n          await this.loadMore(showLast)\n        } else {\n          showLast()\n          setTimeout(async()=>{\n            const msgIsOverFlow = await this.msgIsOverFlow()\n            if(this.visibleMsgList.length === 0 || !msgIsOverFlow){\n             await this.loadMore(showLast)\n            }\n          },0)\n        }\n      },\n      async msgIsOverFlow(){\n        if(this.visibleMsgList.length > 0){\n          // 计时\n          // console.time('getElInfo')\n          let firstMsgTop = (await this.getElInfo('#item-0')).top\n          let lastMsgBottom = (await this.getElInfo('#item-' + (this.visibleMsgList.length - 1) )).bottom\n          const listElInfo = await this.getElInfo('.uni-im-list')\n          // console.timeEnd('getElInfo')\n          return firstMsgTop < listElInfo.top || lastMsgBottom > listElInfo.bottom\n        }else{\n          return true\n        }\n      },\n      async loadMore(callback) {\n        let datas = []\n        datas = await this.conversation.msg.getMore()\n        if(datas.length){\n          await this.insertMsg(datas)\n        }\n        if (typeof callback === 'function') {\n          // 为兼容 web pc端特殊场景 不能使用$nextTick\n          setTimeout(() => {\n            callback(datas)\n          }, 0)\n        }\n        return datas\n      },\n      msgOnAppear(msgId){\n        uniIm.utils.throttle(()=>{\n          let index = this.visibleMsgList.findIndex(i => i._id == msgId)\n          if (index == -1) {\n            return //因为是异步的，可能已经被销毁了替换了新对象\n          }\n          // console.log('msgOnAppear',index);\n        }, 1000);\n      },\n      async setIntersectionObserver() {\n        // console.log('setIntersectionObserver');\n        if (this.intersectionObserver) {\n          // console.log('this.intersectionObserver存在','执行销毁');\n          this.intersectionObserver.disconnect()\n          await uniIm.utils.sleep(1000)\n        }\n        \n        this.intersectionObserver = uni.createIntersectionObserver(this, { observeAll: true })\n          .relativeTo('.uni-im-list', {})\n          .observe('.uni-im-msg', (res) => {\n            const msgId = res.id\n            const msgRef = this.$refs['uni-im-msg'].find(item => item.msg._id == msgId)\n            if (!msgRef) {\n              // console.error('找不到msgRef，或会话已切走', msgId);\n              return\n            }\n            \n            // hasBeenDisplayed表示是否已经显示过了\n            const hasBeenDisplayed = appearObj[msgId] || false;\n            // 新显示的\n            const isAppear = res.intersectionRatio > 0 && !hasBeenDisplayed\n            \n            \n            // 是否为最后一条消息\n            const isLastMsg = [...this.visibleMsgList].pop()?._id === msgId\n            if(isLastMsg){\n              this.lastMsgIsShow = isAppear\n              if(this.lastMsgIsShow){\n                this.hasNewMsg = false\n              }\n            }\n            \n            if (isAppear) {\n              appearObj[msgId] = true;\n              msgRef.onAppear()\n              this.msgOnAppear(msgId)\n              \n              // console.error('出现了',msgRef.msg.body)\n              const isFirstMsg = this.visibleMsgList[0]?._id === msgId\n              // 是否为第一个消息\n              if (isFirstMsg) {\n                // console.log('第一个消息出现在视窗内，加载更多',this.visibleMsgList[0]?._id , msgId);\n                this.loadMore()\n              }\n              // 调用扩展点，通知消息列表某条消息进入显示区。\n              uniIm.extensions.invokeExts('msg-appear', msgRef.msg)\n            } else if (!res.intersectionRatio > 0 && hasBeenDisplayed) {\n              appearObj[msgId] = false;\n              msgRef.onDisappear()\n              // console.error('消失了',msgRef.msg.body)\n              // 调用扩展点，通知消息列表某条消息离开显示区。\n              uniIm.extensions.invokeExts('msg-disappear', msgRef.msg)\n            }\n          })\n      },\n      viewMsg(msgList) {\n        this.$refs['view-msg'].open(msgList);\n      },\n      async onScroll(e) {\n        // 记录当前滚动条高度\n        currentScrollTop = e.detail.scrollTop\n        // console.log('onScroll', e.detail.scrollTop)\n        \n        // TODO:滚动停止后，将end置为true\n        this.onScroll.end = false\n        if (this.onScroll.timeoutId) {\n          clearTimeout(this.onScroll.timeoutId)\n        }\n        this.onScroll.timeoutId = setTimeout(() => {\n          this.onScroll.end = true\n        }, 500)\n      },\n      async onScrollToLower() {\n      },\n      async canHoldScrollDo(fn){\n        /**\n         * 解决web-pc端，部分情况下插入消息滚动内容会跳动的问题\n         */\n        // #ifdef H5\n        if(this.isWidescreen){\n          if(window.chrome){\n            // console.error('currentScrollTop',currentScrollTop)\n            // console.error('this.visibleMsgList.length',this.visibleMsgList.length)\n            const msgIsOverFlow = await this.msgIsOverFlow()\n            if(msgIsOverFlow && currentScrollTop === 0 && this.visibleMsgList.length != 0){\n              this.scrollTop = currentScrollTop\n              await this.$nextTick(()=> this.scrollTop = (currentScrollTop + 1) )\n              if(!this.canHoldScrollDo.tryIndex){\n                this.canHoldScrollDo.tryIndex = 1\n              }else{\n                this.canHoldScrollDo.tryIndex ++\n              }\n              if(this.canHoldScrollDo.tryIndex > 10){\n                console.warn('canHoldScrollDo tryIndex > 10',this.canHoldScrollDo.tryIndex,currentScrollTop,this.visibleMsgList.length)\n                this.canHoldScrollDo.tryIndex = 0\n                fn()\n              }else{\n                setTimeout(()=>{\n                  this.canHoldScrollDo(fn)\n                },300)\n              }\n            }else{\n              fn()\n            }\n          }else{\n            const getScrollContentHeight = ()=>document.querySelector('.scroll-content').offsetHeight\n            let scrollContent = getScrollContentHeight()\n            fn()\n            // 下一个事件循环中，重新计算滚动条的高度\n            setTimeout(()=>{\n              const diff = getScrollContentHeight() - scrollContent\n              // console.error( 'diff', diff)\n              this.scrollTop = currentScrollTop\n              this.$nextTick(()=> this.scrollTop = currentScrollTop + diff)\n            },0)\n          }\n          return\n        }\n        // #endif\n        fn()\n      },\n      async insertMsg(data) {\n        return await new Promise((resolve) => {\n          this.canHoldScrollDo(async ()=>{\n            // 重新获取会话对象，防止web pc端 切换太快引起的会话对象指向错误\n            const conversation = await uniIm.conversation.get(data[0].conversation_id)\n            conversation.msg.add(data,{unshift:true})\n            resolve()\n          })\n        })\n      },\n      equalPrevTime(index) {\n        if (index === 0) {\n          return false\n        } else if (index == this.visibleMsgList.length - 1) {\n          return false\n        } else {\n          const getFriendlyTime = (msg) => {\n            return uniIm.utils.toFriendlyTime(msg.create_time || msg.client_create_time)\n          }\n          return getFriendlyTime(this.visibleMsgList[index]) == getFriendlyTime(this.visibleMsgList[index - 1])\n        }\n      },\n      async showRemindMsg() {\n        const msgId = this.conversation.readRemindMsg()\n        console.log('msgId', msgId)\n\t\t\t\tif (msgId) {\n          this.showMsgById(msgId)\n        }\n      },\n      showLast() {\n        let mLength = this.visibleMsgList.length\n        this.showMsgByIndex(mLength - 1)\n        this.hasNewMsg = false\n      },\n      notifyNewMsg() {\n        this.hasNewMsg = true\n        // 如果当前在底部，则自动显示最新消息\n        if (this.lastMsgIsShow) {\n          this.showLast()\n        }\n      },\n      async getElInfo(select){\n        return await new Promise((resolve, rejece) => {\n          const query = uni.createSelectorQuery().in(this);\n          query.select(select).boundingClientRect(data => {\n            if (!data) {\n              console.log('找不到 showMsgByIndex：' + select);\n              return rejece(false)\n            }\n            resolve(data)\n          }).exec()\n        })\n      },\n      async showMsgByIndex(index) {\n        if (index == -1) {\n          return\n        }\n        const listHeight = (await this.getElInfo('.uni-im-list')).height\n        const targetInfo = await this.getElInfo('#item-' + index)\n        const itemScrollTop = targetInfo.top\n        // console.error('currentScrollTop',currentScrollTop)\n        // console.error('itemScrollTop',itemScrollTop,listHeight,currentScrollTop,index)\n        let val = 0;\n        let m = listHeight - targetInfo.height\n        if(m < 0){\n          m = 10\n        }\n         if(this.isWidescreen){\n           val = itemScrollTop + currentScrollTop - 0.5 * m\n         }else{\n           val = itemScrollTop * -1 + currentScrollTop + 0.3 * m\n         }\n        \n        // console.error('val',val)\n        // 赋值为当前滚动条的高度\n        this.scrollTop = currentScrollTop\n        // 设置一个新值触发视图更新 -> 滚动\n        this.$nextTick(async () => {\n          this.scrollTop = val\n          // console.error('currentScrollTop',currentScrollTop)\n        })\n      },\n      // 进入话题\n      intoTopic(msgId) {\n        let currentMsg = this.conversation.msg.find(msgId)\n        const getAboutUser = msg => {\n          const aboutUid = [msg.from_uid];\n          const about_msg_id = msg.about_msg_id\n          if(!about_msg_id){\n            return aboutUid\n          }\n          const aboutMsg = this.conversation.msg.find(about_msg_id)\n          if(aboutMsg){\n            aboutUid.push(...getAboutUser(aboutMsg))\n          }\n          // 去重\n          return [...new Set(aboutUid)]\n        }\n        \n        this.filterAsUid = getAboutUser(currentMsg)\n      },\n      showMenberList(){\n        this.$emit('showMenberList',arguments[0])\n      },\n      async showMsgById(msgId) {\n\t\t\t\t// 话题中的消息，不支持定位到引用消息\n        if(this.filterAsUid.length > 0){\n          return uni.showToast({\n            title: '话题中的消息，不支持定位到引用消息',\n            icon: 'none'\n          });\n        }\n\t\t\t\t\n        // 找到消息的索引\n        let index = this.visibleMsgList.findIndex(i => i._id == msgId)\n        // 如果找不到，先加载更多，再找\n        if (index === -1) {\n          const {_findIndex} = this.showMsgById\n          if (!_findIndex) {\n            uni.showLoading();\n            this.showMsgById._findIndex = 0\n          } else if (_findIndex > 29) {\n            uni.hideLoading()\n            this.showMsgById._findIndex = false\n            console.error('防止特殊情况下死循环，不加载30屏以外的引用数据');\n            return uni.showToast({\n              title: '暂不支持，定向10屏以外的引用消息',\n              icon: 'none'\n            });\n          }\n          this.showMsgById._findIndex++\n          console.log('this.showMsgById._findIndex', this.showMsgById._findIndex);\n          await this.loadMore()\n          return await this.showMsgById(msgId)\n        }\n\t\t\t\t// todo:必须要用settmeout 0,此处$nextTick无效\n\t\t\t\tawait uniIm.utils.sleep(0)\n        uni.hideLoading()\n        this.activeMsgId = msgId\n        if(this.showMsgActiveColorActionT){\n          clearTimeout(this.showMsgActiveColorActionT)\n        }\n        this.showMsgActiveColorActionT = setTimeout(() => {\n          this.activeMsgId = ''\n        }, 2000);\n        this.showMsgByIndex(index)\n      },\n      isChecked(msg) {\n        return this.checkedMsgList.some(i => i._id === msg._id)\n      },\n      checkMsg(msg) {\n        if (!this.chooseMore) {\n          return\n        }\n        let checkedMsgList = this.checkedMsgList\n        if (this.isChecked(msg)) {\n          checkedMsgList.splice(checkedMsgList.findIndex(i => i._id === msg._id), 1)\n        } else {\n          checkedMsgList.push(msg)\n        }\n        this.$emit('update:checkedMsgList', checkedMsgList)\n      },\n      showControl(e) {\n        if (this.isWidescreen || this.onScroll.end !== false){\n          this.$emit('showControl', e)\n        }else{\n          // console.log('滚动中，不响应长按弹出菜单')\n        }\n      },\n      longpressMsgAvatar(e) {\n        this.$emit('longpressMsgAvatar', e)\n      },\n      retriesSendMsg(msg) {\n        if(msg.state === 0){\n          return console.error('消息发送中')\n        }\n        this.$emit('retriesSendMsg', msg)\n      },\n      clickItem() {\n        this.$emit('clickItem')\n      },\n      putChatInputContent(msgBody) {\n        this.$emit('putChatInputContent', msgBody)\n      },\n      updateFilterUids(uids){\n        this.filterAsUid = uids\n      }\n    }\n  }\n\n</script>\n\n<style lang=\"scss\">\n.uni-im-msg-list-root{\n\tposition: relative;\n  &.in-topic {\n    // 显示滚动条时，最外层增加描边\n    border: 2px #bee1ff solid;\n  }\n  &,.uni-im-list {\n    background-color: transparent;\n    height: 100%;\n  }\n  .uni-im-list-item {\n    transform: scale(1, -1);\n    .uni-im-msg {\n      width: 0;\n      flex-grow: 1;\n\t\t\tmargin-bottom: 10px;\n    }\n  }\n  /* #ifdef H5 */\n  @media screen and (min-device-width:960px) {\n    .uni-im-list-item {\n       // 关闭上下翻转\n       transform: scale(1, 1);\n     }\n  }\n  /* #endif */\n  \n  \n  .item {\n    // border: solid 1px #0055ff;\n  }\n  .uni-im-list-item .system .checkbox {\n    display: none;\n  }\n  \n  .data-state-tip-box {\n    // height: 35px;\n    align-items: center;\n    justify-content: center;\n    flex-direction: row;\n    color: #999999;\n    margin-bottom: -5px;\n    margin-top: 10px;\n  }\n  \n  .data-state-tip-text {\n    height: 36px;\n    line-height: 36px;\n    font-size: 12px;\n    margin: 0 5px;\n    color: #999999;\n  }\n  \n  /* #ifdef H5 */\n  .loadMore-btn {\n    font-size: 14px;\n    color: #666;\n  }\n  \n  .loadMore-btn::after {\n    display: none;\n  }\n  \n  /* #endif */\n  .msg-box {\n    position: relative;\n    transition-property: background-color;\n    transition-duration: 2s;\n    flex-direction: row;\n  }\n  \n  .msg-box .checkbox {\n    margin: 30px 0 0 10px;\n    // transform: translateX(20px);\n  }\n  \n  .msg-box .mask {\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 999;\n    width: 100%;\n    height: 100%;\n  }\n  \n  .active-msg {\n    background-color: #f9f9f9;\n  }\n  \n  .showRemindMsg {\n    background-color: #62caf8;\n    border-radius: 50px;\n    padding: 2px 15px;\n    font-size: 12px;\n    color: #FFF;\n    position: fixed;\n    right: 5px;\n    top: 10px;\n    /* #ifdef H5 */\n    top: 55px;\n    cursor: pointer;\n  \n    @media screen and (min-device-width:960px) {\n      top: calc(7vh + 20px);\n      right: 30px;\n      font-size: 16px;\n    }\n  \n    /* #endif */\n  }\n  \n  .group-notification-popup {\n    z-index: 9999;\n  }\n  \n  .new-msg-bar {\n    position: absolute;\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    right: 40px;\n    bottom: 10px;\n    font-size: 12px;\n    background-color: white;\n    color: #007fff;\n    padding: 5px 8px 5px 5px;\n    border-radius: 15px 15px 15px 15px;\n    /* #ifdef H5 */\n    pointer-events: auto;\n    cursor: pointer;\n    /* #endif */\n  }\n  /* #ifdef H5 */\n  .pointer {\n    cursor: pointer;\n  }\n  /* #endif */\n}\n</style>","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg-list/uni-im-msg-list.vue'\nwx.createComponent(Component)"],"names":["uniIm","uniCloud","uni"],"mappings":"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"}