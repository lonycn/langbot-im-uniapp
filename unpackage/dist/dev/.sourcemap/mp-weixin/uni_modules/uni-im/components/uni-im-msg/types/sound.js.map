{"version":3,"file":"sound.js","sources":["uni_modules/uni-im/components/uni-im-msg/types/sound.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg/types/sound.vue?type=component"],"sourcesContent":["<template>\n  <view class=\"text selfText sound-box\" :class=\"{reverse:!self}\" :style=\"{width:soundBoxWidth}\" @click=\"playSound\">\n    <text class=\"sound-time\">\n      {{ msg.body.time }}''\n    </text>\n    <view class=\"sound-icon-box\" :class=\"{rotate:!self}\">\n      <image v-if=\"soundPlayState\" src=\"@/uni_modules/uni-im/static/sound-ing.gif\" style=\"width: 18px;height: 18px;\"\n        mode=\"widthFix\" />\n      <uni-im-icons v-else :class=\"{'sound-icon-active':soundPlayState}\" code=\"e6f5\" size=\"18px\" color=\"#000000\" />\n    </view>\n  </view>\n</template>\n\n<script>\n  import uniIm from '@/uni_modules/uni-im/sdk/index.js';\n  export default {\n    data() {\n      return {\n        soundPlayState: 0\n      }\n    },\n    props: {\n      msg: {\n        type: Object,\n        default () {\n          return {\n            from_uid: '',\n            body: {\n              time: 0\n            }\n          }\n        }\n      },\n      soundBoxWidth: {\n        type: String,\n        default: '100px'\n      }\n    },\n    computed: {\n      self() {\n        return this.msg.from_uid === uniIm.currentUser._id\n      }\n    },\n    destroyed() {\n      // console.log('unmounted');\n\t\t\tif(this.isInit){\n\t\t\t\tconst audioContext = uniIm.audioContext\n\t\t\t\taudioContext.offPlay(this.onPlay);\n\t\t\t\taudioContext.offPause(this.soundPlayEnd);\n\t\t\t\taudioContext.offStop(this.soundPlayEnd);\n\t\t\t\taudioContext.offEnded(this.soundPlayEnd);\n\t\t\t\taudioContext.offError(this.soundPlayEnd);\n\t\t\t}\n    },\n    methods: {\n\t\t\tinit(){\n\t\t\t\tif (this.isInit) {\n\t\t\t\t  return\n\t\t\t\t}\n\t\t\t\t// console.log('----init');\n\t\t\t\tconst audioContext = uniIm.audioContext\n\t\t\t\tthis.onPlay = async () => {\n\t\t\t\t  // console.log('soundPlayStart------------------',this.msg.body);\n\t\t\t\t  const currentAudioUrl = await uniIm.utils.getTempFileURL(this.msg.body.url)\n\t\t\t\t  if (audioContext.src == currentAudioUrl) {\n\t\t\t\t    this.soundPlayState = 1\n\t\t\t\t  } else {\n\t\t\t\t    this.soundPlayState = 0\n\t\t\t\t  }\n\t\t\t\t}\n\t\t\t\taudioContext.onPlay(this.onPlay);\n\t\t\t\tthis.soundPlayEnd = () => {\n\t\t\t\t  // console.log('soundPlayEnd------------------');\n\t\t\t\t  this.soundPlayState = 0\n\t\t\t\t}\n\t\t\t\taudioContext.onPause(this.soundPlayEnd);\n\t\t\t\taudioContext.onStop(this.soundPlayEnd);\n\t\t\t\taudioContext.onEnded(this.soundPlayEnd);\n\t\t\t\taudioContext.onError(this.soundPlayEnd);\n\t\t\t\tthis.isInit = true\n\t\t\t},\n      async playSound() {\n\t\t\t\tthis.init()\n\t\t\t\tconst audioContext = uniIm.audioContext\n        audioContext.src = await uniIm.utils.getTempFileURL(this.msg.body.url)\n        // 下一个事件循环执行\n        setTimeout(() => {\n          // console.log(78998797,audioContext);\n          if (this.soundPlayState === 1) {\n            // console.log('播放中，执行关闭');\n            audioContext.stop()\n          } else {\n\t\t\t\t\t\t// console.log('未播放中，执行播放');\n            audioContext.stop()\n            audioContext.play();\n          }\n        }, 0)\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\">\n.sound-box {\n  /* #ifdef H5 */\n  cursor: pointer !important;\n  /* #endif */\n  flex-direction: row;\n  background-color: #94EB6A;\n  height: 44px;\n  padding: 10px;\n  width: 66px;\n  border-radius: 5px;\n  justify-content: flex-end;\n  align-items: center;\n  \n  &.reverse {\n    flex-direction: row-reverse;\n  }\n  \n  .sound-time {\n    font-size: 14px;\n    margin: 0 4px;\n  }\n  \n  .sound-icon-box {\n    width: 18px;\n    height: 18px;\n    justify-content: center;\n  }\n  .rotate {\n    transform: rotate(180deg);\n  }\n  .sound-icon-active {\n    transform: option;\n    opacity: 10;\n    background-color: #007AFF;\n    transition-property: background-color;\n    transition-duration: 0.3s;\n    transition-delay: 0.1s;\n    transition-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1.0);\n  }\n}\n</style>","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg/types/sound.vue'\nwx.createComponent(Component)"],"names":["uniIm"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAeE,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,gBAAgB;AAAA,IAClB;AAAA,EACD;AAAA,EACD,OAAO;AAAA,IACL,KAAK;AAAA,MACH,MAAM;AAAA,MACN,UAAW;AACT,eAAO;AAAA,UACL,UAAU;AAAA,UACV,MAAM;AAAA,YACJ,MAAM;AAAA,UACR;AAAA,QACF;AAAA,MACF;AAAA,IACD;AAAA,IACD,eAAe;AAAA,MACb,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,EACD;AAAA,EACD,UAAU;AAAA,IACR,OAAO;AACL,aAAO,KAAK,IAAI,aAAaA,4BAAK,MAAC,YAAY;AAAA,IACjD;AAAA,EACD;AAAA,EACD,YAAY;AAEb,QAAG,KAAK,QAAO;AACd,YAAM,eAAeA,4BAAAA,MAAM;AAC3B,mBAAa,QAAQ,KAAK,MAAM;AAChC,mBAAa,SAAS,KAAK,YAAY;AACvC,mBAAa,QAAQ,KAAK,YAAY;AACtC,mBAAa,SAAS,KAAK,YAAY;AACvC,mBAAa,SAAS,KAAK,YAAY;AAAA,IACxC;AAAA,EACE;AAAA,EACD,SAAS;AAAA,IACV,OAAM;AACL,UAAI,KAAK,QAAQ;AACf;AAAA,MACF;AAEA,YAAM,eAAeA,4BAAAA,MAAM;AAC3B,WAAK,SAAS,MAAY;AAExB,cAAM,kBAAkB,MAAMA,4BAAAA,MAAM,MAAM,eAAe,KAAK,IAAI,KAAK,GAAG;AAC1E,YAAI,aAAa,OAAO,iBAAiB;AACvC,eAAK,iBAAiB;AAAA,eACjB;AACL,eAAK,iBAAiB;AAAA,QACxB;AAAA,MACF;AACA,mBAAa,OAAO,KAAK,MAAM;AAC/B,WAAK,eAAe,MAAM;AAExB,aAAK,iBAAiB;AAAA,MACxB;AACA,mBAAa,QAAQ,KAAK,YAAY;AACtC,mBAAa,OAAO,KAAK,YAAY;AACrC,mBAAa,QAAQ,KAAK,YAAY;AACtC,mBAAa,QAAQ,KAAK,YAAY;AACtC,WAAK,SAAS;AAAA,IACd;AAAA,IACQ,YAAY;AAAA;AACpB,aAAK,KAAK;AACV,cAAM,eAAeA,4BAAAA,MAAM;AACvB,qBAAa,MAAM,MAAMA,4BAAAA,MAAM,MAAM,eAAe,KAAK,IAAI,KAAK,GAAG;AAErE,mBAAW,MAAM;AAEf,cAAI,KAAK,mBAAmB,GAAG;AAE7B,yBAAa,KAAK;AAAA,iBACb;AAEL,yBAAa,KAAK;AAClB,yBAAa,KAAI;AAAA,UACnB;AAAA,QACD,GAAE,CAAC;AAAA,MACN;AAAA;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClGF,GAAG,gBAAgB,SAAS;"}