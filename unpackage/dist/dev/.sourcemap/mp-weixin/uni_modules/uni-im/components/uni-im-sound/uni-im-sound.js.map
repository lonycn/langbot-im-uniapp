{"version":3,"file":"uni-im-sound.js","sources":["uni_modules/uni-im/components/uni-im-sound/uni-im-sound.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-sound/uni-im-sound.vue?type=component"],"sourcesContent":["<template>\n\t<view class=\"sound-buttom-box\">\n\t\t<view @touchmove=\"touchmove\" @touchstart=\"recordStart\" @touchend=\"recordEnd\" @touchcancel=\"recordEnd\"\n\t\t\tclass=\"sound-buttom\" :class=\"{recordState}\">\n\t\t\t<view v-if=\"soundProgress\" class=\"sound-progress\" :style=\"{'width':soundProgress}\"></view>\n\t\t\t<text class=\"sound-text\">{{recordState?'录音中（'+time+'s）':'按住 说话'}}</text>\n\t\t\t<view class=\"sound-tip\" v-if=\"recordState\">\n\t\t\t\t<text class=\"sound-tip-text\" :style=\"{color:cancel?'#f70000':'#FFFFFF'}\">{{cancel?'松手取消':'松手发送，上划取消'}}</text>\n\t\t\t\t<view class=\"closeIcon\" :style=\"{'background-color':cancel?'#f70000':'#EEEEEE'}\">\n\t\t\t\t\t<uni-im-icons class=\"icon\" code=\"e61a\" size=\"10px\" color=\"#FFFFFF\"></uni-im-icons>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n    <view v-if=\"recordState\" :style=\"{bottom:markBottom}\" class=\"mark\"></view>\n\t</view>\n</template>\n\n<script>\n\t// #ifndef H5\n\tconst recorderManager = uni.getRecorderManager();\n\t// #endif\n\n\timport uniIm from '@/uni_modules/uni-im/sdk/index.js';\n\tlet soundInterval,soundPath,startTime;\n\texport default {\n\t\temits: ['sendSoundMsg'],\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\trecordState:0,\n\t\t\t\tsoundProgress:0,\n\t\t\t\tcancel:false,\n\t\t\t\ttime:0,\n\t\t\t\tphoneBH:0\n\t\t\t}\n\t\t},\n\t\tcomputed:{\n      ...uniIm.mapState(['systemInfo']),\n\t\t\tmarkBottom(){\n\t\t\t\tlet markBottom = 67;\n\t\t\t\t// #ifndef H5\n\t\t\t\tmarkBottom += this.systemInfo.safeAreaInsets.bottom/2\n\t\t\t\t// #endif\n        console.log('markBottom',markBottom);\n\t\t\t\treturn markBottom  + 'px'\n\t\t\t},\n\t\t},\n\t\tcreated() {\n\t\t\t// #ifndef H5\n\t\t\trecorderManager.onStop((res)=> {\n\t\t\t\tconsole.log('recorderManager.onStop',{res});\n\t\t\t\tif(!this.cancel){\n\t\t\t\t\tif(this.time < 2){\n\t\t\t\t\t\treturn uni.showToast({\n\t\t\t\t\t\t\ttitle: '语音时间过短',\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tuni.showLoading({\n\t\t\t\t\t\ttitle: '上传中',\n\t\t\t\t\t\tmask: false\n\t\t\t\t\t});\n\t\t\t\t\tuniCloud.uploadFile({\n\t\t\t\t\t\tfilePath:res.tempFilePath,\n\t\t\t\t\t\tcloudPath:'uni-im/' + uniIm.currentUser._id + '/sound/' + Date.now() + '.mp3',\n\t\t\t\t\t\t// fileType:\"audio\",\n\t\t\t\t\t\tsuccess: (e) => {\n\t\t\t\t\t\t\t// console.log('uniCloud.uploadFile-sendSoundMsg',e,'sendSoundMsg',{\"url\":e.fileID,time:this.time});\n\t\t\t\t\t\t\ttry{\n\t\t\t\t\t\t\t\tthis.$emit('sendSoundMsg',{\"url\":e.fileID,time:this.time})\n\t\t\t\t\t\t\t}catch(e){\n\t\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfail: (e) =>{\n\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\t\t\tcontent: JSON.stringify(e),\n\t\t\t\t\t\t\t\tshowCancel: false,\n\t\t\t\t\t\t\t\tconfirmText: '知道了'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcomplete: (e) =>{\n\t\t\t\t\t\t\tconsole.log('complete',e);\n\t\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}else{\n\t\t\t\t\tconsole.log('用户取消了录音功能','this.time:'+this.time);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\trecorderManager.onStart(e=>{\n\t\t\t\t// console.log(e);\n\t\t\t})\n\t\t\trecorderManager.onPause(e=>{\n\t\t\t\t// console.log(e);\n\t\t\t})\n\t\t\trecorderManager.onError(e=>{\n\t\t\t\tconsole.error(e);\n\t\t\t})\n\t\t\t// #endif\n\t\t},\n\t\tmethods: {\n\t\t\ttouchmove(e){\n        let touchY = e.touches[0].clientY + this.systemInfo.statusBarHeight + this.systemInfo.safeArea.top\n        // #ifdef H5\n        touchY += 44\n        // #endif\n        this.cancel = this.systemInfo.safeArea.bottom - touchY > 66\n\t\t\t},\n\t\t\trecordStart(e){\n\t\t\t\t// 关闭正在播放的sound\n\t\t\t\tuniIm.audioContext.stop()\n\t\t\t\tthis.time = 0\n\t\t\t\t\n\t\t\t\t// #ifdef H5\n\t\t\t\t// 防止H5端 调试出现鼠标右键菜单\n\t\t\t\twindow.oncontextmenu = function () { return false; }\n\t\t\t\t// #endif\n\n\t\t\t\t// #ifdef H5\n\t\t\t\t// return uni.showToast({\n\t\t\t\t// \ttitle: 'h5端不支持语音功能',\n\t\t\t\t// \ticon: 'none'\n\t\t\t\t// });\n\t\t\t\t// #endif\n\n\t\t\t\t// #ifndef H5\n\t\t\t\trecorderManager.start({\n\t\t\t\t\tsampleRate:16000,\n\t\t\t\t\tnumberOfChannels:2,\n\t\t\t\t\tformat:\"mp3\"\n\t\t\t\t});\n\t\t\t\t// #endif\n\n\t\t\t\tstartTime = Date.now()\n\n\t\t\t\tconsole.log('recordStart');\n\n\t\t\t\t//进度条\n\t\t\t\tthis.recordState = 1\n\t\t\t\tsoundInterval = setInterval(()=>{\n\t\t\t\t\tthis.soundProgress = parseInt(this.soundProgress) + uni.upx2px(450/60) +'px'\n\t\t\t\t\t// console.log('this.soundProgress',this.soundProgress);\n\t\t\t\t\tthis.time = parseInt((Date.now() - startTime) / 1000)\n\t\t\t\t},1000)\n\t\t\t\t// e.preventDefault();\n\t\t\t},\n\t\t\trecordEnd(){\n\t\t\t\t// #ifndef H5\n\t\t\t\trecorderManager.stop();\n\t\t\t\t// #endif\n\t\t\t\tconsole.log('recordEnd');\n\t\t\t\tclearInterval(soundInterval)\n\t\t\t\tsetTimeout(()=> {\n\t\t\t\t\tthis.recordState = 0\n\t\t\t\t\tthis.soundProgress = 0\n\t\t\t\t\tthis.cancel = false\n\t\t\t\t}, 300);\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n  .sound-buttom-box {\n    height: 100%;\n  }\n\t.sound-buttom {\n\t\tbackground-color: #ffffff;\n\t\tpadding: 10px;\n\t\twidth: 100%;\n    flex: 1;\n\t\t// border-radius: 10px;\n\t\tfont-size: 16px;\n\t\talign-items: flex-start;\n\t\tjustify-content: center;\n\t\toverflow:hidden;\n\t}\n\t.sound-text{\n\t\tposition: relative;\n\t\tleft: -20rpx;\n\t\twidth: 450rpx;\n\t\tfont-size: 14px;\n\t\ttext-align: center;\n\t}\n\t.sound-tip{\n\t\tposition: fixed;\n\t\tleft: 0;\n\t\tbottom: 110px;\n    z-index: 9;\n\t\twidth: 750rpx;\n\t\ttext-align: center;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t}\n\t.sound-tip-text{\n\t\tmargin-bottom: 10px;\n\t\tcolor: #999999;\n\t\tfont-size: 14px;\n\t}\n\t.closeIcon{\n\t\twidth: 30px;\n\t\theight: 30px;\n\t\tbackground-color: #DDDDDD;\n\t\tborder-radius: 100px;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t}\n  /* #ifdef MP-WEIXIN */\n  // 纠正微信小程序的icon位置\n  .closeIcon .icon{\n    position: relative;\n    top: -2px;\n  }\n  /* #endif */\n\t.sound-progress {\n\t\t// border-radius: 10px;\n\t\theight: 44px;\n\t\tposition: absolute;\n\t\tleft: 0;\n\t\ttop: 0;\n\t\tpadding: 0;\n\t\ttransition: width 0.2s linear;\n\t\tbackground-color: #2faf4c;\n\t\topacity: 0.3;\n\t}\n\t\n\t.recordState{\n\t\tbackground-color: #efefef;\n\t}\n\t\n\t.mark{\n\t\twidth: 750rpx;\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tbottom: 57px;\n\t\tright: 0;\n\t\tbackground:rgba(0,0,0,0.7);\n\t\tflex: 1;\n\t}\n</style>\n","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-sound/uni-im-sound.vue'\nwx.createComponent(Component)"],"names":["uni","uniIm","uniCloud","e"],"mappings":"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"}