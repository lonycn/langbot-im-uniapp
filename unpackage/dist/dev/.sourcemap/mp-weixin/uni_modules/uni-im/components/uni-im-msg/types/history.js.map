{"version":3,"file":"history.js","sources":["uni_modules/uni-im/components/uni-im-msg/types/history.vue","/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg/types/history.vue?type=component"],"sourcesContent":["<template>\n  <view class=\"history-msg\" @click=\"viewMsg\">\n    <view class=\"title\">{{title}}</view>\n    <view class=\"item-text-list\">\n      <view class=\"item-text\" v-for=\"(item,index) in msgList.slice(0,3)\" :key=\"index\">\n        {{item.nickname}}：{{item.content}}\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\n  import uniIm from '@/uni_modules/uni-im/sdk/index.js';\n  export default {\n    emits: ['viewMsg'],\n    props: {\n      msg: {\n        type: Object,\n        default: {}\n      },\n    },\n    data() {\n      return {\n        msgList: [],\n      }\n    },\n\t\tcomputed: {\n\t\t\ttitle(){\n\t\t\t\tconst {to_uid,from_uid,group_id} = this.msg.body.msgList[0] || {}\n\t\t\t\tif(group_id){\n\t\t\t\t\treturn this.msg.body.title\n\t\t\t\t}else{\n\t\t\t\t  let nickname1 = uniIm.users.getNickname(to_uid)\n\t\t\t\t\tlet nickname2 = uniIm.users.getNickname(from_uid)\n\t\t\t\t\treturn `${nickname1} 与 ${nickname2} 的聊天记录`;\n\t\t\t\t  // console.log(this.title)\n\t\t\t\t}\n\t\t\t}\n\t\t},\n    mounted() {\n      const msg = this.msg\n      // console.log(msg)\n      this.msgList = msg.body.msgList || []\n      for (let i = 0; i < this.msgList.length; i++) {\n        let msg = this.msgList[i]\n        this.setNickname(msg)\n        // 获取body 去掉所有 html 标签\n        msg.content = typeof(msg.body) === 'string' ? msg.body.replace(/<[^>]+>/g, \"\") : '[多媒体类型]'\n      }\n      \n    },\n    methods: {\n      viewMsg(){\n        this.$emit('viewMsg',this.msgList)\n      },\n      setNickname(msg) {\n        let users = uniIm.users[msg.from_uid]\n        if (users) {\n          msg.nickname = users.nickname;\n        } else {\n          const dbJQL = uniCloud.databaseForJQL();\n          dbJQL.collection('uni-id-users').doc(msg.from_uid).field('nickname').get().then(res => {\n            msg.nickname = res.data[0].nickname;\n          })\n        }\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\">\n  /* #ifdef H5 */\n  .history-msg,.history-msg * {\n    cursor: pointer;\n  }\n  /* #endif */\n  .history-msg {\n    padding: 10px;\n    border-radius: 5px;\n    background-color: #fff;\n    width: 600rpx;\n    .title {\n      text-align: left;\n      font-size: 16px;\n      color: #333;\n      border-bottom: 1px solid #eee;\n      padding-bottom: 5px;\n      margin-bottom: 5px;\n    }\n    .item-text-list{\n      max-height: 150px !important;\n      overflow: hidden;\n      .item-text {\n        color: #999;\n        font-size: 14px;\n      }\n    }\n  }\n</style>","import Component from '/Users/orange/aicode/langbot/web_client/langbot-im-uniapp/uni_modules/uni-im/components/uni-im-msg/types/history.vue'\nwx.createComponent(Component)"],"names":["uniIm","msg","uniCloud"],"mappings":";;;AAaE,MAAK,YAAU;AAAA,EACb,OAAO,CAAC,SAAS;AAAA,EACjB,OAAO;AAAA,IACL,KAAK;AAAA,MACH,MAAM;AAAA,MACN,SAAS,CAAC;AAAA,IACX;AAAA,EACF;AAAA,EACD,OAAO;AACL,WAAO;AAAA,MACL,SAAS,CAAE;AAAA,IACb;AAAA,EACD;AAAA,EACH,UAAU;AAAA,IACT,QAAO;AACN,YAAM,EAAC,QAAO,UAAS,SAAQ,IAAI,KAAK,IAAI,KAAK,QAAQ,CAAC,KAAK,CAAC;AAChE,UAAG,UAAS;AACX,eAAO,KAAK,IAAI,KAAK;AAAA,aACjB;AACH,YAAI,YAAYA,4BAAK,MAAC,MAAM,YAAY,MAAM;AAC/C,YAAI,YAAYA,4BAAK,MAAC,MAAM,YAAY,QAAQ;AAChD,eAAO,GAAG,SAAS,MAAM,SAAS;AAAA,MAEnC;AAAA,IACD;AAAA,EACA;AAAA,EACC,UAAU;AACR,UAAM,MAAM,KAAK;AAEjB,SAAK,UAAU,IAAI,KAAK,WAAW,CAAC;AACpC,aAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,QAAQ,KAAK;AAC5C,UAAIC,OAAM,KAAK,QAAQ,CAAC;AACxB,WAAK,YAAYA,IAAG;AAEpB,MAAAA,KAAI,UAAU,OAAOA,KAAI,SAAU,WAAWA,KAAI,KAAK,QAAQ,YAAY,EAAE,IAAI;AAAA,IACnF;AAAA,EAED;AAAA,EACD,SAAS;AAAA,IACP,UAAS;AACP,WAAK,MAAM,WAAU,KAAK,OAAO;AAAA,IAClC;AAAA,IACD,YAAY,KAAK;AACf,UAAI,QAAQD,4BAAK,MAAC,MAAM,IAAI,QAAQ;AACpC,UAAI,OAAO;AACT,YAAI,WAAW,MAAM;AAAA,aAChB;AACL,cAAM,QAAQE,iBAAS;AACvB,cAAM,WAAW,cAAc,EAAE,IAAI,IAAI,QAAQ,EAAE,MAAM,UAAU,EAAE,IAAG,EAAG,KAAK,SAAO;AACrF,cAAI,WAAW,IAAI,KAAK,CAAC,EAAE;AAAA,SAC5B;AAAA,MACH;AAAA,IACF;AAAA,EACF;AACF;;;;;;;;;;;;;;;AClEF,GAAG,gBAAgB,SAAS;"}